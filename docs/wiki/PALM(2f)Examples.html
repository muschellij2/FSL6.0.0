<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>PALM/Examples</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">PALM/Examples</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./PALM.html">Introduction</a></li><li><a href="./PALM(2f)UserGuide.html">User Guide</a></li><li><a href="./PALM(2f)ExchangeabilityBlocks.html">Exchangeability Blocks</a></li><li><a href="./PALM(2f)JointInference.html">Joint Inference</a></li><li><a href="./PALM(2f)MasksAndVoxelwiseRegressors.html">Masks And Voxelwise Regressors</a></li><li><a href="./PALM(2f)FasterInference.html">Faster Inference</a></li><li>Examples<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Example_1:_Single_modality">Example 1: Single modality</a></li><li>
<a href="#Example_2:_Permutations_with_sign-flipping">Example 2: Permutations with sign-flipping</a></li><li>
<a href="#Example_3:_Multiple_modalities.2C_corrected_across">Example 3: Multiple modalities, corrected across</a></li><li>
<a href="#Example_4:_Multiple_designs">Example 4: Multiple designs</a></li><li>
<a href="#Example_5:_Using_multi-level_block_definitions">Example 5: Using multi-level block definitions</a></li><li>
<a href="#Example_6:_Multiple_modalities.2C_joint_inference_with_NPC">Example 6: Multiple modalities, joint inference with NPC</a></li><li>
<a href="#Example_7:_MANOVA_and_MANCOVA_.28simple.29">Example 7: MANOVA and MANCOVA (simple)</a></li><li>
<a href="#Example_8:_MANOVA_and_MANCOVA_.28with_contrasts_of_response_variables.29">Example 8: MANOVA and MANCOVA (with contrasts of response variables)</a></li><li>
<a href="#Example_9:_Faster_inference">Example 9: Faster inference</a></li><li>
<a href="#Example_10:_Using_CIFTI_files">Example 10: Using CIFTI files</a></li><li>
<a href="#Example_11:_Using_a_log_and.2For_configuration_file">Example 11: Using a log and/or configuration file</a></li></ol></div></div></li><li><a href="./PALM(2f)FAQ.html">FAQ</a></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-4"></span>Some simple examples to get started are below. Note that by default, PALM saves the actual p-values, rather than 1-p. To have 1-p, use the option -save1-p. Alternatively, use the option -savelogp, which is good for visualisation. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h1 id="Example_1:_Single_modality">Example 1: Single modality</h1>
<span class="anchor" id="line-7"></span><p class="line874">To run PALM for a single modality, use use something as: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867"><span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-1-1"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ba15637766c59f48a3ce16d8da612ae2ad8adfc0" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span>palm -i dataset4D.nii -d design.mat -t design.con -m mask.nii -f design.fts -T -C 3.1 -n <span class="Number">5000</span> -corrcon -o myresults</span>
</pre></div></div><span class="anchor" id="line-12"></span><p class="line862">Note that for these simple cases, the calls are nearly identical to what would be used in randomise. There are a few differences, though: the cluster forming threshold is supplied as the equivalent z-score for the <em>t</em> or <em>F</em> statistics (or whatever other statistic that will be computed internally, such as <em>v</em>, <em>G</em>, <em>r</em> or <em>R</em><sup>2</sup>), and the value given with the option -c or -C applies to all these statistics (not just t). Also, while .nii.gz can be loaded directly, the current version prefers .nii (uncompressed), because it's faster to load but mainly, because for large datasets it doesn't risk occupying all the memory and making the system unstable. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line874">The design.mat, design.con and design.fts can be replaced for csv files. The extension for these files needs to be .csv then. Likewise, the input doesn't need to be an image. It can be any csv file in which each row is a subject and each column is a measurement. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line874">The option -corrcon does FWER-correction across all contrasts, taking into account any dependency that may exist between these contrasts. <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line874">If the design and contrast files are both omitted, a 1-sample t-test will be performed, with sign-flipping. If only the contrast files are omitted, and if there is a single EV in the design, it will be a 1-sample t-test; if there are more than one EV, it will run an F-test testing whether any EV has its regression coefficient different than zero. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line874">If -n 0 is used, the permutations are performed exhaustively. If the number of permutations is omitted, the default is 10000. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line874">The option -o is to specify the output prefix (and it may include a path). If not given, the default output prefix is simply &quot;palm&quot;. <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line867">
<h1 id="Example_2:_Permutations_with_sign-flipping">Example 2: Permutations with sign-flipping</h1>
<span class="anchor" id="line-25"></span><p class="line874">The example above, as shown, will be executed with permutations by default. To replace permutations for sign-flippings, the option -ise is included (this specifies that the errors are independent and symmetric, ISE) <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line867"><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-1-3"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-3128255645e06b532fa28de2a35a18b9527dbf93" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span>palm -i dataset4D.nii -d design.mat -t design.con -m mask.nii -f design.fts -T -C 3.1 -n <span class="Number">5000</span> -corrcon -o myresults -ise</span>
</pre></div></div><span class="anchor" id="line-30"></span><p class="line874">To run permutations together with sign-flippings, use the option -ise together with the option -ee, meaning that the errors are exchangeable (EE) and also independent and symmetric (ISE) <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line867"><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-1-5"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-eb460e39faeffe6c2e8864752b550907815d635d" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span>palm -i dataset4D.nii -d design.mat -t design.con -m mask.nii -f design.fts -T -C 3.1 -n <span class="Number">5000</span> -corrcon -o myresults -ee -ise</span>
</pre></div></div><span class="anchor" id="line-35"></span><p class="line867">
<h1 id="Example_3:_Multiple_modalities.2C_corrected_across">Example 3: Multiple modalities, corrected across</h1>
<span class="anchor" id="line-36"></span><p class="line874">To run PALM for multiple modalities, use something as: <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line867"><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-1-7"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-86375beef5f433b3d76532754a20c4d805e0b00c" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span>palm -i modality1_4d.nii -i modality2_4d.nii -i modality3_4d.nii -d design.mat -t design.con -n <span class="Number">2000</span> -corrcon -corrmod</span>
</pre></div></div><span class="anchor" id="line-41"></span><p class="line874">Each modality will be tested separately, and the option -corrmod will do FWER-correction across all of them, taking into account the dependence structure that may exist between them. These modalities don't need to be in the same resolution, don't need to be imaging, and can mix voxel-based with surface-based measurements. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867">
<h1 id="Example_4:_Multiple_designs">Example 4: Multiple designs</h1>
<span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line874">To run PALM with multiple designs use: <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line867"><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-1-9"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-68061a2b7dd550b345dd6ef3e6f381b6ea677cbe" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span>palm -i data_4d.nii -d design1.mat -t design1.con -d design2.mat -t design2.con -d design3.mat -t design3.con [...] -n <span class="Number">2000</span> -corrcon</span>
</pre></div></div><span class="anchor" id="line-50"></span><p class="line874">Each contrast for each design will be tested separately, and the option -corrcon will do FWER-correction across all of them, taking into account the dependence structure that may exist between them. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line867">
<h1 id="Example_5:_Using_multi-level_block_definitions">Example 5: Using multi-level block definitions</h1>
<span class="anchor" id="line-54"></span><p class="line874">The file with the multi-level blocks is supplied with the option -eb. If the variances cannot be assumed to be the same for all observations, a file with variance groups can be supplied with the option -vg, or a conservative estimate for the groups can be defined, from the blocks, with -vg auto. If the option -vg is not used, all data is assumed as having the same variance. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line862">If the file supplied with -eb has just one column, the options -whole and/or -within can be used to indicate how shuffling should happen. If he file has multiple columns, the information on how the blocks should be shuffled is extracted from the blocks themselves. More details <a href="./PALM(2f)ExchangeabilityBlocks.html">here</a> <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line867"><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-1-11"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-88b2bb91441597f3fe8bb947f6d6928f2b1d52a6" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span>palm -i modality1_4d.nii -d design.mat -t design.con -eb blocks.csv</span>
</pre></div></div><span class="anchor" id="line-61"></span><p class="line867">
<h1 id="Example_6:_Multiple_modalities.2C_joint_inference_with_NPC">Example 6: Multiple modalities, joint inference with NPC</h1>
<span class="anchor" id="line-62"></span><p class="line874">If the modalities have the same spatial resolution or geometry (for surfaces), it's possible to combine them and perform joint inference involving all of them. There are two methods available: one is NPC (Non-Parametric Combination), the other is MV (classic MANOVA/MANCOVA; next example). <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line874">For the NPC, the call is something as this: <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line867"><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-1-13"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-1c0c7dcd4c96eb37c9cf4f4a616f620b8d31b62a" lang="en"><span class="line"><span class="anchor" id="line-1-14"></span>palm -i modality1_4d.nii -i modality2_4d.nii -i modality3_4d.nii -d design.mat -t design.con -f design.fts -n <span class="Number">5000</span> -npc</span>
</pre></div></div><span class="anchor" id="line-69"></span><p class="line862">This will combine the modalities using the Fisher method (default). There are various others available, and Fisher is probably the best, and it's also quite fast. The significance after the combination is assessed via permutations. More details <a href="./PALM(2f)JointInference.html">here</a> <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867">
<h1 id="Example_7:_MANOVA_and_MANCOVA_.28simple.29">Example 7: MANOVA and MANCOVA (simple)</h1>
<span class="anchor" id="line-72"></span><p class="line874">For the MV, the call is something as this: <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line867"><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-1-15"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-56853037d592f9cdc3bd5717aed1ee5d9ebdf9b4" lang="en"><span class="line"><span class="anchor" id="line-1-16"></span>palm -i modality1_4d.nii -i modality2_4d.nii -i modality3_4d.nii -d design.mat -t design.con -f design.fts -n <span class="Number">5000</span> -mv</span>
</pre></div></div><span class="anchor" id="line-77"></span><p class="line862">For the F-contrasts, this runs the equivalent to a MANOVA/MANCOVA, computing the Wilks' Lambda (default for F-tests), and assessing its significance through permutations. Other multivariate statistics are also available (Roy, Lawley-Hotelling, Pillai). For the t-contrasts, the default Hotelling's <em>T</em><sup>2</sup>. More details <a href="./PALM(2f)JointInference.html">here</a>. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line867">
<h1 id="Example_8:_MANOVA_and_MANCOVA_.28with_contrasts_of_response_variables.29">Example 8: MANOVA and MANCOVA (with contrasts of response variables)</h1>
<span class="anchor" id="line-80"></span><p class="line874">It is possible to further refine MANOVA/MANCOVA by providing contrasts of response variables. The null hypothesis is H0 : C'*psi*D, where psi are the estimated regression coefficients, C are contrasts as usual, and D are contrasts of response variables. These are supplied with the option &quot;-con&quot;: <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867"><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-1-17"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-10391d21a24c0039a4be0b913bafbcd73ca47160" lang="en"><span class="line"><span class="anchor" id="line-1-18"></span>palm -i modality1_4d.nii -i modality2_4d.nii -i modality3_4d.nii -d design.mat -con C.mset D.mset -n <span class="Number">5000</span> -mv</span>
</pre></div></div><span class="anchor" id="line-85"></span><p class="line862">Each *.mset file contains multiple C and D contrasts, pairwise, that is, if C.mset contains 4 contrasts, the D.mset needs to contain also 4 contrasts, so that 4 different null hypotheses are tested, the first using the first contrast of each file, the second using the second of each file, and so on. More details <a href="./PALM(2f)JointInference.html">here</a> and <a href="./PALM(2f)UserGuide.html#Support_for_MSET_files">here</a>. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line867">
<h1 id="Example_9:_Faster_inference">Example 9: Faster inference</h1>
<span class="anchor" id="line-88"></span><p class="line862">The most general acceleration method, that can be used in a wide variety of situations, is the tail approximation. A typical use is for FWER-corrected outputs, such that the uncorrected can be skipped. In the example below, 500 permutations are used. More details are <a href="./PALM(2f)FasterInference.html">here</a>. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867"><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-1-19"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-5eaf9d66f35abb77eab2473730ff8e2cda62287f" lang="en"><span class="line"><span class="anchor" id="line-1-20"></span>palm [...] -n <span class="Number">500</span> -accel tail -nouncorrected</span>
</pre></div></div><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line867">
<h1 id="Example_10:_Using_CIFTI_files">Example 10: Using CIFTI files</h1>
<span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867"><strong>Case 1: Without spatial statistics (i.e., no TFCE or cluster-level inference):</strong> If no spatial statistics will be used, i.e., no TFCE and no cluster-level inference, then CIFTI files are supported as any other input file, i.e., same as with NIFTI, CSV, <a href="./FreeSurfer.html">FreeSurfer</a>, or any other format. <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line862">Note that you can use <strong>wb_shortcuts -cifti-concatenate</strong> (from the Workbench tools) to conveniently merge/concatenate CIFTI files (e.g., dtseries.nii, dscalar.nii, ptseries.nii, and pscalar.nii) from individual subjects into a single combined file to serve as input to PALM. Similarly, <strong>wb_shortcuts -metric-concatenate</strong> can be used if you need to merge func.gii files. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867"><strong>Case 2: With spatial statistics (i.e., TFCE or cluster-level inference):</strong> <span class="anchor" id="line-101"></span>Inference using TFCE and cluster-inference with dense CIFTI files that include both cortical surfaces and subcortical volumes are a bit more elaborate. These spatial statistics depend on the size, shape, and topology of the particular type of representation of the brain (surface or volume), such that a correction across these structures based on the distribution of the maximum statistic would lead to very conservative results for some of them. Instead, the CIFTI file needs to be broken down into its components, i.e., surface-based (GIFTI) and volume-based (NIFTI) structures, and PALM is then run separately for each, with the results only then corrected for the multiplicity of tests using either Bonferroni or Šidák methods. Moreover, for the analysis of the cortex, it is also necessary to supply a mesh indicating how the vertices are connected to each other, and optionally (but ideally) a file with the average area per vertex should also be provided. <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line862">To separate a CIFTI file into GIFTI (with the cortex of each cerebral hemisphere) and NIFTI (with subcortical structures) components, use the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-cifti-separate">-cifti-separate</a> of the <strong>wb_command</strong> (this assumes that the dscalar.nii file has already been concatenated across subjects, using e.g., <strong>wb_shortcuts -cifti-concatenate</strong>): <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line867"><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-1-21"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-b943c26234f9f07410f508e504b9b2c464d01cf0" lang="en"><span class="line"><span class="anchor" id="line-1-22"></span>wb_command -cifti-separate data.dscalar.nii COLUMN -volume-all data_sub.nii -metric CORTEX_LEFT data_L.func.gii -metric CORTEX_RIGHT data_R.func.gii</span>
</pre></div></div><span class="anchor" id="line-108"></span><p class="line862">The above will produce three files that are used below as inputs in separate calls to PALM: data_L.func.gii, data_R.func.gii, and data_sub.nii. The two .gii files (GIFTI) are internally compressed (GZIP_BASE64_BINARY), but currently Octave (as of version 4.0.0) cannot do the uncompression. Thus we need to convert to uncompressed BASE64_BINARY. The <strong>wb_command</strong> has the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-gifti-convert">-gifti-convert</a> that can be used for conversions as these (do it for both L and R): <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line867"><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-1-23"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-7edfb27614e259ce791788b6780c2f6be78d1f28" lang="en"><span class="line"><span class="anchor" id="line-1-24"></span>wb_command -gifti-convert BASE64_BINARY data_L.func.gii data_L.func.gii</span>
</pre></div></div><span class="anchor" id="line-113"></span><p class="line862">The surfaces (meshes) for the left and right are also necessary, so that the adjacency (neighbourhood) information between vertices can be computed. Use preferably a <em>midthickness</em>, <em>white</em>, or <em>pial</em> surface. Although the <em>sphere</em> can be used (the adjacency information is the same), it has severe areal distortions that make the use of average areas as input mandatory. The average areas are optional if the midthickness surfaces are used, but still recommended for better representing the sizes of clusters and of the support regions of TFCE. To obtain such areas, use the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-surface-vertex-areas">-surface-vertex-areas</a> of the <strong>wb_command</strong> for each subject, then merge all into a single file with the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-metric-merge">-metric-merge</a>, then finally compute the mean with the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-metric-reduce">-metric-reduce</a>. That is, something as below (make the necessary changes to your file names and directory structure): <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867"><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-1-25"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-8115d3bd343a61a2e09a3f3105f85582efae7577" lang="en"><span class="line"><span class="anchor" id="line-1-26"></span><span class="ResWord">for</span> subj in <span class="String">${</span><span class="ID">LIST_SUBJECTS</span><span class="String">}</span> ; <span class="ResWord">do</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span>   wb_command -surface-vertex-areas <span class="String">${</span><span class="ID">subj</span><span class="String">}</span>/L_midthick.surf.gii <span class="String">${</span><span class="ID">subj</span><span class="String">}</span>/L_midthick_va.shape.gii</span>
<span class="line"><span class="anchor" id="line-3-1"></span><span class="ResWord">done</span></span>
</pre></div></div><span class="anchor" id="line-120"></span><p class="line867"><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-1-27"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-e73b8eceb6693f0595c343da7f8c68df80eb82f7" lang="en"><span class="line"><span class="anchor" id="line-1-28"></span><span class="ID">L_MERGELIST</span>=<span class="String">&quot;&quot;</span></span>
<span class="line"><span class="anchor" id="line-2-2"></span><span class="ResWord">for</span> subj in <span class="String">${</span><span class="ID">LIST_SUBJECTS</span><span class="String">}</span> ; <span class="ResWord">do</span></span>
<span class="line"><span class="anchor" id="line-3-2"></span>   <span class="ID">L_MERGELIST</span>=<span class="String">&quot;</span><span class="String">${</span><span class="ID">L_MERGELIST</span><span class="String">}</span><span class="String"> -metric </span><span class="String">${</span><span class="ID">subj</span><span class="String">}</span><span class="String">/L_midthick_va.shape.gii</span><span class="String">&quot;</span></span>
<span class="line"><span class="anchor" id="line-4-1"></span>end</span>
<span class="line"><span class="anchor" id="line-5-1"></span>wb_command -metric-merge L_midthick_va.func.gii <span class="String">${</span><span class="ID">L_MERGELIST</span><span class="String">}</span></span>
</pre></div></div><span class="anchor" id="line-127"></span><p class="line867"><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-1-29"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-2c04e4a16e35d2a88202e98861929ca85cd64189" lang="en"><span class="line"><span class="anchor" id="line-1-30"></span>wb_command -metric-reduce L_midthick_va.func.gii MEAN L_area.func.gii</span>
</pre></div></div><span class="anchor" id="line-130"></span><p class="line862">Repeat all steps for the right hemisphere. For details of these options, syntax and examples, consult the <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php">Workbench Command documentation</a>. Alternatively, if for any reason the average areas cannot be produced, consider using the <em>sphere</em> surface and the vertex-area average files available <a class="https" href="https://github.com/Washington-University/Pipelines/tree/master/global/templates/standard_mesh_atlases/resample_fsaverage">here</a>; these areas were produced from the S900 HCP release. <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line874">Once the input files, surfaces and their average areas have been produced, PALM can be run three separate times as: <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line867"><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-1-31"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ce58c9e4624917bc32ce46a3be4ae055c6ee9b00" lang="en"><span class="line"><span class="anchor" id="line-1-32"></span>palm -i data_sub.nii -d design.mat -t design.con -o results_sub -T -logp [...]</span>
<span class="line"><span class="anchor" id="line-2-3"></span>palm -i data_L.func.gii -d design.mat -t design.con -o results_L_cort -T -tfce2D -s L_midthickness.surf.gii L_area.func.gii -logp [...]</span>
<span class="line"><span class="anchor" id="line-3-3"></span>palm -i data_R.func.gii -d design.mat -t design.con -o results_R_cort -T -tfce2D -s R_midthickness.surf.gii R_area.func.gii -logp [...]</span>
</pre></div></div><span class="anchor" id="line-139"></span><p class="line862">The results are merged with the option <a class="http" href="http://www.humanconnectome.org/software/workbench-command.php?function=-cifti-create-dense-from-template">-cifti-create-dense-from-template</a> of <strong>wb_command</strong>, creating a new CIFTI file for each matching set of p-value maps. For example: <span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line867"><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-1-33"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-3ca7224cc8c4d2d8fcbdcf143cecd8fbf57d6f9f" lang="en"><span class="line"><span class="anchor" id="line-1-34"></span>wb_command -cifti-create-dense-from-template data.dscalar.nii results_merged_tfce_tstat_fwep_c1.dscalar.nii -volume-all results_sub_tfce_tstat_fwep_c1.nii -metric CORTEX_LEFT results_L_cort_tfce_tstat_fwep_c1.gii -metric CORTEX_RIGHT results_R_cort_tfce_tstat_fwep_c1.gii</span>
</pre></div></div><span class="anchor" id="line-144"></span><p class="line862">These new CIFTI files can be opened with <strong>wb_view</strong>. The corrected significance threshold can be determined via Bonferroni, i.e., -log10(alpha/N) = -log10(0.05/3) = 1.7782, or with Šidák, i.e., -log10(1-(1-alpha)<sup>1/N</sup>) = -log10(1-(1-0.05)<sup>1/3</sup>) = 1.7708, the latter being therefore slightly more powerful. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line862">As in the previous example, if the input data are subjects from the Human Connectome Project, it's also necessary to supply the exchangeability blocks file (-eb EB.csv). More details <a href="./PALM(2f)ExchangeabilityBlocks.html#EBs_for_data_of_the_Human_Connectome_Project">here</a>. <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><p class="line867">
<h1 id="Example_11:_Using_a_log_and.2For_configuration_file">Example 11: Using a log and/or configuration file</h1>
<span class="anchor" id="line-149"></span><p class="line874">The various options available can make it difficult to keep track of which were used for any call of the command. To help with this, PALM saves a small text file with all the options used, which works as a log-file. This file is named {outputprefix}_palmconfig.txt. For the Example 1 above, the file would be like this: <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line867"><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-1-35"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a7035a886e2215af710e46043b4335a1075638ce" lang="en"><span class="line"><span class="anchor" id="line-1-36"></span><span class="Comment"># Configuration file for PALM.</span></span>
<span class="line"><span class="anchor" id="line-2-4"></span><span class="Comment"></span><span class="Comment"># 12-Mar-2014 11:29:47</span></span>
<span class="line"><span class="anchor" id="line-3-4"></span><span class="Comment"></span></span>
<span class="line"><span class="anchor" id="line-4-2"></span>-i dataset4D.nii</span>
<span class="line"><span class="anchor" id="line-5-2"></span>-d design.mat</span>
<span class="line"><span class="anchor" id="line-6-1"></span>-t design.con</span>
<span class="line"><span class="anchor" id="line-7-1"></span>-m mask.nii</span>
<span class="line"><span class="anchor" id="line-8-1"></span>-f design.fts</span>
<span class="line"><span class="anchor" id="line-9-1"></span>-T</span>
<span class="line"><span class="anchor" id="line-10-1"></span>-C 3.1</span>
<span class="line"><span class="anchor" id="line-11-1"></span>-n 5000</span>
<span class="line"><span class="anchor" id="line-12-1"></span>-corrcon</span>
<span class="line"><span class="anchor" id="line-13-1"></span>-o myresults</span>
</pre></div></div><span class="anchor" id="line-166"></span><p class="line874">The same log-file can also be used as the input for a second run. In this case, PALM should be called with the file name as the sole input argument: <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line867"><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-1-37"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-5bde9a58848cbee67ed71356522b6cb095cb03b2" lang="en"><span class="line"><span class="anchor" id="line-1-38"></span>palm myresults_palmconfig.txt</span>
</pre></div></div><span class="anchor" id="line-171"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
