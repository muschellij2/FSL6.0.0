<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>FslSge</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">FslSge</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Conventions">Conventions</a></li><li>
<a href="#Prerequisites">Prerequisites</a><ol><li>
<a href="#NFS">NFS</a></li><li>
<a href="#Name_services">Name services</a></li><li>
<a href="#User_accounts">User accounts</a><ol><li>
<a href="#Admin_account">Admin account</a></li></ol></li><li>
<a href="#Service_ports">Service ports</a></li></ol></li><li>
<a href="#Obtaining_Son_of_Grid_Engine">Obtaining Son of Grid Engine</a></li><li>
<a href="#Installation">Installation</a><ol><li>
<a href="#QMaster">QMaster</a><ol><li>
<a href="#Red_Hat_Enterprise_etc">Red Hat Enterprise etc</a></li><li>
<a href="#Debian.2FUbuntu">Debian/Ubuntu</a></li></ol></li><li>
<a href="#Execution_Host">Execution Host</a><ol><li>
<a href="#Red_Hat_Enterprise_etc-1">Red Hat Enterprise etc</a></li><li>
<a href="#Debian.2FUbuntu-1">Debian/Ubuntu</a></li></ol></li></ol></li><li>
<a href="#Configuration">Configuration</a><ol><li>
<a href="#QMaster-1">QMaster</a></li><li>
<a href="#Exec_Host">Exec Host</a></li></ol></li><li>
<a href="#Queue_Configuration">Queue Configuration</a><ol><li>
<a href="#FSL_Queues">FSL Queues</a></li></ol></li></ol></div> <span class="anchor" id="line-2"></span>
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-3"></span><p class="line862">This is a quick walk through to get Grid Engine going on Linux for those who would like to use it for something like FSL. This documentation is a little old, being written when the Grid Engine software was owned by Sun and often referred to as <em>SGE</em> (Sun Grid Engine). However, this covers the basic requirements. A quick start guide for Ubuntu/Debian is available <a class="http" href="http://chrisfilo.tumblr.com/post/579493955/how-to-configure-sun-grid-engine-for-fsl-under-ubuntu">here</a>, but more detailed setup can be found on this page. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line862">Since the demise of the open source (Sun) Grid Engine, various ports have sprung up. Ubuntu/Debian package the last publicly available release (6.2u5), but users of Red Hat variants (CentOS, Scientific Linux) or Debian/Ubuntu users wishing to use a more modern release should look to installing <a class="https" href="https://arc.liv.ac.uk/trac/SGE/wiki">Son of Grid Engine</a> which makes available RPM and DEB packages and is still actively maintained (last update November 2013).  <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">Grid Engine generally consists of one master (qmaster) and a number of execute (exec) hosts, note that the qmaster machine can also be an exec host which is fine for small deployments, but large clusters should look to keeping these functions separate. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">This documentation was originally produced by A. Janke (<a class="mailto" href="mailto:a.janke@gmail.com">a.janke@gmail.com</a>) and is now maintained by the FSL team. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867">
<h1 id="Conventions">Conventions</h1>
<span class="anchor" id="line-12"></span><p class="line862">All the below must be done as root so either <tt class="backtick">su&nbsp;-</tt> or use <tt class="backtick">sudo&nbsp;-s</tt> (if your account is <em>sudo</em> enabled). <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line867">
<h1 id="Prerequisites">Prerequisites</h1>
<span class="anchor" id="line-15"></span><p class="line874">Where the following talk about shared resources, you can ignore the details if you are setting up a single machine qmaster/execution host. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h2 id="NFS">NFS</h2>
<span class="anchor" id="line-18"></span><p class="line862">Although Grid Engine can be configured such that all machines are self contained, the instructions here assume that at least some of the Grid Engine folders are shared amongst the controller (qmaster) and clients (exec hosts). To achieve this you will typically need to setup one or more NFS shares, typically <em>at least</em> the configuration files (see <a class="http" href="http://arc.liv.ac.uk/SGE/howto/nfsreduce.html">http://arc.liv.ac.uk/SGE/howto/nfsreduce.html</a>). <span class="anchor" id="line-19"></span>Further, the FSL binaries and datasets to be operated on should be made available to all exec hosts in the <strong>same</strong> filesystem location. In the case of the FSL software, you could install this to the same location on all execution hosts or install to one location and NFS mount this to the same location on all hosts. In the case of datasets, the instructions here assume you are using NFS mounts, but through <em>prolog</em> and <em>epilog</em> scripts it is possible to setup Grid Engine to copy data to/from exec hosts. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line874">Setting up NFS shares is beyond the scope of this document. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Name_services">Name services</h2>
<span class="anchor" id="line-24"></span><p class="line862">Grid Engine needs to be able to locate exec hosts/qmasters based on host name. Assuming all of your hosts are known to your DNS service then you will have to do no work to set this up. If you don't have a DNS zone then you may need to configure the local <em>/etc/hosts</em> file to resolve hostnames or look into host aliases (<tt class="backtick">man&nbsp;host_aliases</tt>) configuration <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867">
<h2 id="User_accounts">User accounts</h2>
<span class="anchor" id="line-27"></span><p class="line874">Grid Engine runs the scheduled job as the user who submitted it, using the textual name form (not numeric ID). Consequently, all exec hosts need to know about all users who are going to submit jobs. In a very small scale setup you may wish to add the required users directly to each exec host, but this quickly becomes unmanageable, so we would recommend setting up some kind of centralised user database, e.g. LDAP, Active Directory. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">Setting this up shared user accounts is beyond the scope of this document. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867">
<h3 id="Admin_account">Admin account</h3>
<span class="anchor" id="line-32"></span><p class="line862">The Grid Engine software has to run as a privileged user in order to be able to run jobs as the submitting user. However, as this is a potential security issue, the grid software that communicates with the network can be run under an <em>admin</em> account that doesn't have root access. This account needs to be available on all cluster hosts, so either set this up locally, or add it to your central LDAP/user account system. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line862">If you decide to have a locally defined daemon account then set this up as follows (run as the root user) (this is Red Hat dialect, for Ubuntu/Debian use the interactive <tt class="backtick">adduser</tt> command). <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><pre><span class="anchor" id="line-1"></span>useradd --home /opt/sge --system sgeadmin</pre><span class="anchor" id="line-38"></span><p class="line874">which will add a system account (e.g. no home folder creation, no ageing of the account etc). This should be run on the qmaster and all exec hosts. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867">
<h2 id="Service_ports">Service ports</h2>
<span class="anchor" id="line-41"></span><p class="line862">Grid Engine communicates over two statically configured <em>ports</em>. These ports have to be the same on all computers, and can be configured in the file <tt class="backtick">/etc/services</tt> <strong>or</strong> by changing the Grid Engine configuration setup files that all users need to source to be able to use the software. The latter option is best where you need to have more than one cluster in a location, as each qmaster/exec host has to communicate with the different clusters on different ports. Modern Linux distributions are already setup with entries for Grid Engine (use <tt class="backtick">grep&nbsp;sge_qmaster&nbsp;/etc/services</tt> to confirm). If your distribution does not include entries, then you need to add the following to this file: <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867"><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><pre><span class="anchor" id="line-1-1"></span>sge_qmaster     6444/tcp                # Grid Engine Qmaster Service
<span class="anchor" id="line-2"></span>sge_qmaster     6444/udp                # Grid Engine Qmaster Service
<span class="anchor" id="line-3"></span>sge_execd       6445/tcp                # Grid Engine Execution Service
<span class="anchor" id="line-4"></span>sge_execd       6445/udp                # Grid Engine Execution Service</pre><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line874">commenting out any prior definitions for the ports 6444 and 6445. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867">
<h1 id="Obtaining_Son_of_Grid_Engine">Obtaining Son of Grid Engine</h1>
<span class="anchor" id="line-53"></span><p class="line862">The Grid Engine distribution is available from the University of Liverpool <a class="http" href="http://arc.liv.ac.uk/downloads/SGE/releases/">http://arc.liv.ac.uk/downloads/SGE/releases/</a>. These instructions are based upon version 8.1.6 (latest release as of April 2014). <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line874">For Red Hat Enterprise 6 variants, download the following packages: <span class="anchor" id="line-56"></span><ul><li>gridengine-8.1.6-1.el6.x86_64.rpm <span class="anchor" id="line-57"></span></li><li>gridengine-qmaster-8.1.6-1.el6.x86_64.rpm <span class="anchor" id="line-58"></span></li><li>gridengine-qmon-8.1.6-1.el6.x86_64.rpm <span class="anchor" id="line-59"></span></li><li>gridengine-execd-8.1.6-1.el6.x86_64.rpm <span class="anchor" id="line-60"></span></li><li>gridengine-guiinst-8.1.6-1.el6.noarch.rpm <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></li></ul><p class="line862">(replace <em>8.1.6-1</em> with the appropriate version number should a new release be available.) <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line867"><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><pre><span class="anchor" id="line-1-2"></span>baseurl=http://arc.liv.ac.uk/downloads/SGE/releases/
<span class="anchor" id="line-2-1"></span>version=8.1.6
<span class="anchor" id="line-3-1"></span>subversion=1
<span class="anchor" id="line-4-1"></span>for i in - -qmaster- -qmon- -execd-; do
<span class="anchor" id="line-5"></span>wget ${baseurl}${version}/gridengine${i}${version}-${subversion}.el6.x86_64.rpm
<span class="anchor" id="line-6"></span>done
<span class="anchor" id="line-7"></span>wget ${baseurl}/${version}/gridengine-guiinst-${version}-${subversion}.el6.noarch.rpm</pre><span class="anchor" id="line-73"></span><p class="line862">For the 8.1.6 release <strong>only</strong> also download the following: <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><pre><span class="anchor" id="line-1-3"></span>wget http://arc.liv.ac.uk/downloads/SGE/releases/8.1.6/installer.jar</pre><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line874">Debian platforms should get these files: <span class="anchor" id="line-79"></span><ul><li>sge-common_8.1.6_all.deb <span class="anchor" id="line-80"></span></li><li>sge-doc_8.1.6_all.deb <span class="anchor" id="line-81"></span></li><li>sge_8.1.6_amd64.deb   <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span></li></ul><p class="line867">
<h1 id="Installation">Installation</h1>
<span class="anchor" id="line-84"></span><p class="line862">Where we refer to $SGE_ROOT, when using the Son Of Grid Engine packages, this will be <em>/opt/sge</em>. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line867">
<h2 id="QMaster">QMaster</h2>
<span class="anchor" id="line-87"></span><p class="line867">
<h3 id="Red_Hat_Enterprise_etc">Red Hat Enterprise etc</h3>
<span class="anchor" id="line-88"></span><p class="line874">Installation of the RPMs should be carried out using YUM as any additional software dependancies will be automatically resolved. A Grid master can be installed using: <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><pre><span class="anchor" id="line-1-4"></span>yum install gridengine-8.1.6-1.el6.x86_64.rpm gridengine-qmaster-8.1.6-1.el6.x86_64.rpm gridengine-execd-8.1.6-1.el6.x86_64.rpm gridengine-qmon-8.1.6-1.el6.x86_64.rpm gridengine-guiinst-8.1.6-1.el6.noarch.rpm</pre><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line867"><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><div class="note"><span class="anchor" id="line-1-1"></span><p class="line867"><strong>8.1.6 Release only</strong> <span class="anchor" id="line-2-1"></span>The installer shipped in the RPM has a mistake in it which prevents it from running, this can be repaired by copying the <em>installer.jar</em> file available on the web pages into <em>$SGE_ROOT/util/gui-installer/</em> e.g. <span class="anchor" id="line-3-1"></span><tt class="backtick">cp&nbsp;installer.jar&nbsp;$SGE_ROOT/util/gui-installer</tt> </div><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line867">
<h3 id="Debian.2FUbuntu">Debian/Ubuntu</h3>
<span class="anchor" id="line-100"></span><p class="line867"><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><pre><span class="anchor" id="line-1-5"></span>dpkg --install sge-common_8.1.6_all.deb sge-doc_8.1.6_all.deb sge_8.1.6_amd64.deb </pre><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line867"><span class="anchor" id="execdinstall"></span> <span class="anchor" id="line-105"></span>
<h2 id="Execution_Host">Execution Host</h2>
<span class="anchor" id="line-106"></span><p class="line867">
<h3 id="Red_Hat_Enterprise_etc-1">Red Hat Enterprise etc</h3>
<span class="anchor" id="line-107"></span><p class="line874">Installation of the RPMs should be carried out using YUM as any additional software dependancies will be automatically resolved. A Grid exec host can be installed using: <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><pre><span class="anchor" id="line-1-6"></span>yum install gridengine-8.1.6-1.el6.x86_64.rpm gridengine-execd-8.1.6-1.el6.x86_64.rpm gridengine-guiinst-8.1.6-1.el6.noarch.rpm</pre><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line867"><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><div class="note"><span class="anchor" id="line-1-2"></span><p class="line867"><strong>8.1.6 Release only</strong> <span class="anchor" id="line-2-2"></span>The installer shipped in the RPM has a mistake in it which prevents it from running, this can be repaired by copying the <em>installer.jar</em> file available on the web pages into <em>$SGE_ROOT/util/gui-installer/</em> e.g. <span class="anchor" id="line-3-2"></span><tt class="backtick">cp&nbsp;installer.jar&nbsp;$SGE_ROOT/util/gui-installer/</tt> </div><span class="anchor" id="line-117"></span><p class="line867"><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><div class="note"><span class="anchor" id="line-1-3"></span><p class="line867"><strong>8.1.7 Release</strong> <span class="anchor" id="line-2-3"></span>The text-based installer script will refuse to install unless you have all the RPMs installed. Edit the <tt class="backtick">install_execd</tt> script so that the final line reads: <span class="anchor" id="line-3-3"></span><tt class="backtick">SGE_CHECK_BINARIES=false&nbsp;exec&nbsp;./inst_sge&nbsp;-x&nbsp;&quot;$@&quot;</tt> </div><p class="line874"> <span class="anchor" id="line-122"></span>
<h3 id="Debian.2FUbuntu-1">Debian/Ubuntu</h3>
<span class="anchor" id="line-123"></span><p class="line874">The Debian packages aren't as fine grained as the Red Hat versions, so an exec host requires the same packages as the master. <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><pre><span class="anchor" id="line-1-7"></span>dpkg --install sge-common_8.1.6_all.deb sge-doc_8.1.6_all.deb sge_8.1.6_amd64.deb </pre><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line867">
<h1 id="Configuration">Configuration</h1>
<span class="anchor" id="line-129"></span><p class="line862">The packages ship with a graphical installer and text-based installers (if you wish to use the graphical installer, make sure you are able to run X11 programs, e.g. <tt class="backtick">ssh&nbsp;-Y</tt> has been used when connecting and you are running X11 locally). The instructions here detail how to run the text based installers. <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line867">
<h2 id="QMaster-1">QMaster</h2>
<span class="anchor" id="line-132"></span><p class="line874">Set an environment variable and then install the qmaster as such: <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><pre><span class="anchor" id="line-1-8"></span>export SGE_ROOT=/opt/sge
<span class="anchor" id="line-2-2"></span>cd $SGE_ROOT
<span class="anchor" id="line-3-2"></span>./install_qmaster</pre><span class="anchor" id="line-138"></span><p class="line874">Now go through the interactive install process: <span class="anchor" id="line-139"></span><ul><li>press enter at the intro screen <span class="anchor" id="line-140"></span></li><li>press &quot;y&quot; and then specify sgeadmin as the user id <span class="anchor" id="line-141"></span></li><li>leave the install dir as /opt/sge <span class="anchor" id="line-142"></span></li><li><p class="line862">You will now be asked about port configuration for the master, normally you would choose the default (2) which uses the <em>/etc/services</em> file <span class="anchor" id="line-143"></span></li><li>accept the sge_qmaster info <span class="anchor" id="line-144"></span></li><li><p class="line862">You will now be asked about port configuration for the master, normally you would choose the default (2) which uses the <em>/etc/services</em> file <span class="anchor" id="line-145"></span></li><li>accept the sge_execd info <span class="anchor" id="line-146"></span></li><li>leave the cell name as &quot;default&quot; <span class="anchor" id="line-147"></span></li><li>Enter an appropriate cluster name when requested <span class="anchor" id="line-148"></span></li><li>leave the spool dir as is <span class="anchor" id="line-149"></span></li><li>press &quot;n&quot; for no windows hosts! <span class="anchor" id="line-150"></span></li><li>press &quot;y&quot; (permissions are set correctly) <span class="anchor" id="line-151"></span></li><li>press &quot;y&quot; for all hosts in one domain <span class="anchor" id="line-152"></span></li><li>If you have Java available on your Qmaster and wish to use SGE Inspect or SDM then enable the JMX MBean server and provide the requested information - probably answer &quot;n&quot; at this point! <span class="anchor" id="line-153"></span></li><li>press enter to accept the directory creation notification <span class="anchor" id="line-154"></span></li><li><p class="line862">enter &quot;classic&quot; for classic spooling (<em>berkeleydb</em> may be more appropriate for large clusters) <span class="anchor" id="line-155"></span></li><li>press enter to accept the next notice <span class="anchor" id="line-156"></span></li><li>enter &quot;20000-20100&quot; as the GID range (increase this range if you have execution nodes capable of running more than 100 concurrent jobs) <span class="anchor" id="line-157"></span></li><li><p class="line862">accept the default spool dir <em>or</em> specify a different folder (for example if you wish to use a shared or local folder outside of SGE_ROOT <span class="anchor" id="line-158"></span></li><li>enter an email address that will be sent problem reports <span class="anchor" id="line-159"></span></li><li>press &quot;n&quot; to refuse to change the parameters you have just configured <span class="anchor" id="line-160"></span></li><li>press enter to accept the next notice <span class="anchor" id="line-161"></span></li><li>press &quot;y&quot; to install the startup scripts <span class="anchor" id="line-162"></span></li><li>press enter twice to confirm the following messages <span class="anchor" id="line-163"></span></li><li>press &quot;n&quot; for a file with a list of hosts <span class="anchor" id="line-164"></span></li><li>enter the names of your hosts who will be able to administer and submit jobs (enter alone to finish adding hosts) <span class="anchor" id="line-165"></span></li><li>skip shadow hosts for now (press &quot;n&quot;) <span class="anchor" id="line-166"></span></li><li>choose &quot;1&quot; for normal configuration and agree with &quot;y&quot; <span class="anchor" id="line-167"></span></li><li>press enter to accept the next message and &quot;n&quot; to refuse to see the previous screen again and then finally enter to exit the installer <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span></li></ul><p class="line874">Now that we are back to a shell (finally) we need to add a few things to our root .bashrc so that we can access the SGE binaries. Add the following lines to /root/.bashrc <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><pre><span class="anchor" id="line-1-9"></span>   # SGE settings
<span class="anchor" id="line-2-3"></span>   export SGE_ROOT=/usr/sge
<span class="anchor" id="line-3-3"></span>   export SGE_CELL=default
<span class="anchor" id="line-4-2"></span>   if [ -e $SGE_ROOT/$SGE_CELL ]
<span class="anchor" id="line-5-1"></span>   then
<span class="anchor" id="line-6-1"></span>      . $SGE_ROOT/$SGE_CELL/common/settings.sh
<span class="anchor" id="line-7-1"></span>   fi</pre><span class="anchor" id="line-179"></span><p class="line874">And then be sure to re-source your .bashrc <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><pre><span class="anchor" id="line-1-10"></span>. /root/.bashrc</pre><span class="anchor" id="line-183"></span><p class="line874">Now we can add our own username as an admin so that we can manage the system without becoming root. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><pre><span class="anchor" id="line-1-11"></span>qconf -am &lt;myusername&gt;</pre><span class="anchor" id="line-187"></span><p class="line862">e.g <tt class="backtick">qconf&nbsp;-am&nbsp;jbloggs</tt> if your username is <em>jbloggs</em>. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><p class="line867">
<h2 id="Exec_Host">Exec Host</h2>
<span class="anchor" id="line-190"></span><p class="line874">The process for installing exec hosts is as follows <span class="anchor" id="line-191"></span><ol type="1"><li>Add the exec host to the master host as an admin host. If your exec host is called client.foo.com then run this on your master host: <span class="anchor" id="line-192"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><pre><span class="anchor" id="line-1-12"></span>qconf -ah client.foo.com</pre><span class="anchor" id="line-195"></span></li></ul></li><li>On the client (client.foo.com) <span class="anchor" id="line-196"></span><ol type="1"><li>Add the sgeadmin username as per above <span class="anchor" id="line-197"></span></li><li><p class="line862">Add the lines to /etc/services <strong>if required</strong> <span class="anchor" id="line-198"></span></li><li>Add the SGE bits to /root/.bashrc and re-source it (. /.bashrc) <span class="anchor" id="line-199"></span></li><li><p class="line862">Ensure the binaries have been <a href="./FslSge.html#execdinstall">installed</a> <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span></li></ol></li><li class="gap">Set an environment variable and then install the exec host (this might be the same machine as the queue master, for example if you only have one computer) <span class="anchor" id="line-202"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><pre><span class="anchor" id="line-1-13"></span>export SGE_ROOT=/opt/sge
<span class="anchor" id="line-2-4"></span>cd $SGE_ROOT
<span class="anchor" id="line-3-4"></span>./install_execd</pre><span class="anchor" id="line-207"></span></li></ul></li><li>Now go through the interactive install process: <span class="anchor" id="line-208"></span></li><li><p class="line862">The installer will ask that you check that this host has been added as an administrative host with the <tt class="backtick">qconf&nbsp;-ah&nbsp;&lt;hostname&gt;</tt> command. Ensure this is the case (you can remove it as an admin host after the install if you wish), then press enter to continue <span class="anchor" id="line-209"></span></li><li><p class="line862">Make sure the Grid Engine root matches that configured on the Qmaster (<em>/opt/sge</em>) <span class="anchor" id="line-210"></span></li><li>Ensure the cell name matches that configured on the master (default is usually fine &quot;default&quot;) <span class="anchor" id="line-211"></span></li><li>Accept the age_execd port setting <span class="anchor" id="line-212"></span></li><li>Accept the message about the host being known as an admin host <span class="anchor" id="line-213"></span></li><li><p class="line862">Make a decision about the spool directory. For medium to large clusters local spool directories are the best option, for small (this should be an NFS mount) or stand-alone installs the default is fine. An appropriate local spool folder name might be <em>/var/spool/sge</em>. If you choose to have a local spool folder you will now receive a warning that the change of 'execd_spool_dir' not being effective before execd has been restarted - you will have to stop/start the execd after completing the install for this to take effect. <span class="anchor" id="line-214"></span></li><li>press &quot;y&quot; to install the startup scripts <span class="anchor" id="line-215"></span></li><li>confirm you have read the following messages <span class="anchor" id="line-216"></span></li><li>When asked about adding a default queue instance for this host answer &quot;n&quot; - FSL requires specific queues, so it is better to define these rather than the default queue. <span class="anchor" id="line-217"></span></li><li>press enter to accept the next message and &quot;n&quot; to refuse to see the previous screen again and then finally enter to exit the installer <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span></li></ol><p class="line874">Repeat this installation procedure on all of the execution hosts... <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><p class="line867">
<h1 id="Queue_Configuration">Queue Configuration</h1>
<span class="anchor" id="line-222"></span><p class="line862">Now we can configure our compute queues. By default Grid Engine has one queue defined <em>all.q</em>. Lets make some changes to this to show how you would configure a queue. Assuming you have added your own username as an admin you can do this from your account, alternatively you will have to become the sgeadmin user. <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><p class="line862">Configuration of queues is via the command <tt class="backtick">qconf</tt> which will use whatever you have set in your <em>EDITOR</em> environment variable to edit the settings. The default if EDITOR is unset is to use vi. If you are not sure how to use vi, be sure to set the EDITOR variable before executing qconf to, for example, gedit. <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><pre><span class="anchor" id="line-1-14"></span>export EDITOR=gedit</pre><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line874">Envoke the queue configuration with <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><pre><span class="anchor" id="line-1-15"></span>qconf -mq all.q</pre><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line874">Change the following settings: <span class="anchor" id="line-235"></span><ul><li><p class="line862">priority =&gt; 20   (this is the lowest priority) <span class="anchor" id="line-236"></span></li><li><p class="line862">shell =&gt; /bin/sh <span class="anchor" id="line-237"></span></li><li><p class="line862">shell_start_mode =&gt; unix_behavior <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span></li></ul><p class="line862">Now check that your install has worked with <tt class="backtick">qstat&nbsp;-f</tt> or with <tt class="backtick">qhost&nbsp;-q</tt>. You should get some output regarding all.q <span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line862">Alternatively, if you have installed the <em>qmon</em> package you can configure this with the X11 based graphical tool <tt class="backtick">qmon</tt>. <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line867">
<h2 id="FSL_Queues">FSL Queues</h2>
<span class="anchor" id="line-244"></span><p class="line862">FSL uses 4 queues by default (see $FSLDIR/bin/fsl_sub), these are <em>verylong.q</em>, <em>long.q</em>, <em>short.q</em> and <em>veryshort.q</em>, the idea being that you can submit jobs to each of these based upon how long you expect the job to run. Thus if you submit a long running job to <em>verylong.q</em> and then want to also run 10 short jobs you can submit them to <em>short.q</em> and they will be run before the <em>verylong.q</em> jobs (or perhaps even in parallel with these jobs). <span class="anchor" id="line-245"></span>One way to configure a fair share of resources is via nice values. For example in the previous section we set the nice value of the <em>all.q</em> to 20. This is the lowest priority so we will use the following scheme for the 4 FSL queues. What this means is that the queue with the lowest nice value (<em>veryshort.q</em>) will get priority for its jobs. <span class="anchor" id="line-246"></span><ul><li><p class="line862">verylong.q   - priority =&gt; 20 <span class="anchor" id="line-247"></span></li><li><p class="line862">long.q   - priority =&gt; 15 <span class="anchor" id="line-248"></span></li><li><p class="line862">short.q   - priority =&gt; 10 <span class="anchor" id="line-249"></span></li><li><p class="line862">veryshort.q   - priority =&gt; 5 <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span></li></ul><p class="line862">But before we do this be must first make our new 4 queues. The easiest way to do this is to copy the configuration from our default queue (<em>all.q</em>). For the brave there is a shell script below that will do this all in one foul swoop. <span class="anchor" id="line-252"></span>The manual method (for those who want to know what is going on). <span class="anchor" id="line-253"></span>First we dump the values from the <em>all.q</em>: <span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><pre><span class="anchor" id="line-1-16"></span>qconf -sq all.q &gt; /tmp/q.temp</pre><span class="anchor" id="line-257"></span><p class="line862">Then modify the qname entry using any editor you choose in the file <em>/tmp/q.tmp</em>, for example, change it to <em>verylong.q</em>. You can now use this new config to create the <em>verylong.q</em> queue <span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><pre><span class="anchor" id="line-1-17"></span>qconf -Aq /tmp/q.tmp</pre><span class="anchor" id="line-261"></span><p class="line862">Change the file again for the <em>long.q</em>: <span class="anchor" id="line-262"></span><ul><li><p class="line862">qname =&gt; long.q <span class="anchor" id="line-263"></span></li><li><p class="line862">priority =&gt; 15 <span class="anchor" id="line-264"></span></li></ul><p class="line874">and make this queue <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><pre><span class="anchor" id="line-1-18"></span>qconf -Aq /tmp/q.tmp</pre><span class="anchor" id="line-268"></span><p class="line862">The repeat these steps for the <em>short.q</em> and <em>veryshort.q</em> varying the priority value appropriately. When you are all done you can check the new queues with: <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><pre><span class="anchor" id="line-1-19"></span>qhost -q</pre><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><p class="line874">Alternatively, this can be scripted as follows: <span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><pre><span class="anchor" id="line-1-20"></span># change defaults for all.q
<span class="anchor" id="line-2-5"></span>qconf -sq all.q |\
<span class="anchor" id="line-3-5"></span>    sed -e 's/bin\/csh/bin\/sh/' |\
<span class="anchor" id="line-4-3"></span>    sed -e 's/posix_compliant/unix_behavior/' |\
<span class="anchor" id="line-5-2"></span>    sed -e 's/priority              0/priority 20/' &gt;\
<span class="anchor" id="line-6-2"></span>    /tmp/q.tmp
<span class="anchor" id="line-7-2"></span>qconf -Mq /tmp/q.tmp
<span class="anchor" id="line-8"></span>
<span class="anchor" id="line-9"></span># add other queues
<span class="anchor" id="line-10"></span>sed -e 's/all.q/verylong.q/' /tmp/q.tmp &gt;\
<span class="anchor" id="line-11"></span>   /tmp/verylong.q
<span class="anchor" id="line-12"></span>qconf -Aq /tmp/verylong.q
<span class="anchor" id="line-13"></span>
<span class="anchor" id="line-14"></span>sed -e 's/all.q/long.q/' /tmp/q.tmp |\
<span class="anchor" id="line-15"></span>   sed -e 's/priority *20/priority 15/' &gt;\
<span class="anchor" id="line-16"></span>   /tmp/long.q
<span class="anchor" id="line-17"></span>qconf -Aq /tmp/long.q
<span class="anchor" id="line-18"></span>
<span class="anchor" id="line-19"></span>sed -e 's/all.q/short.q/' /tmp/q.tmp |\
<span class="anchor" id="line-20"></span>   sed -e 's/priority *20/priority 10/' &gt;\
<span class="anchor" id="line-21"></span>   /tmp/short.q
<span class="anchor" id="line-22"></span>qconf -Aq /tmp/short.q
<span class="anchor" id="line-23"></span>
<span class="anchor" id="line-24"></span>sed -e 's/all.q/veryshort.q/' /tmp/q.tmp |\
<span class="anchor" id="line-25"></span>   sed -e 's/priority *20/priority 5/' &gt;\
<span class="anchor" id="line-26"></span>   /tmp/veryshort.q
<span class="anchor" id="line-27"></span>qconf -Aq /tmp/veryshort.q</pre><span class="anchor" id="line-303"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
