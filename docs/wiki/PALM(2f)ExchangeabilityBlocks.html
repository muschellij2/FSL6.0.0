<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>PALM/ExchangeabilityBlocks</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">PALM/ExchangeabilityBlocks</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./PALM.html">Introduction</a></li><li><a href="./PALM(2f)UserGuide.html">User Guide</a></li><li>Exchangeability Blocks<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Freely_exchangeable_data">Freely exchangeable data</a></li><li>
<a href="#Data_exchangeable_within_block">Data exchangeable within block</a></li><li>
<a href="#Blocks_of_data_exchangeable_as_a_whole">Blocks of data exchangeable as a whole</a></li><li>
<a href="#Simultaneous_whole-_and_within-block_permutation">Simultaneous whole- and within-block permutation</a></li><li>
<a href="#Complex_dependence_between_data">Complex dependence between data</a></li><li>
<a href="#Visualisation_of_the_block_structure">Visualisation of the block structure</a></li><li>
<a href="#EBs_for_data_of_the_Human_Connectome_Project">EBs for data of the Human Connectome Project</a></li><li>
<a href="#Generating_the_set_of_permutations_only">Generating the set of permutations only</a></li><li>
<a href="#References">References</a></li></ol></div></div></li><li><a href="./PALM(2f)JointInference.html">Joint Inference</a></li><li><a href="./PALM(2f)MasksAndVoxelwiseRegressors.html">Masks And Voxelwise Regressors</a></li><li><a href="./PALM(2f)FasterInference.html">Faster Inference</a></li><li><a href="./PALM(2f)Examples.html">Examples</a></li><li><a href="./PALM(2f)FAQ.html">FAQ</a></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Freely_exchangeable_data">Freely exchangeable data</h1>
<span class="anchor" id="line-6"></span><p class="line862">For designs in which the data can be shuffled freely, there is no need to specify exchangeability blocks, and all observations are implicitly be assigned to the same large block. This also implies that the data is homoscedastic, i.e., same variance for all observations, and as a consequence, there is just one variance group (VG) for all data. The statistic that is computed by default is either <em>t</em> or <em>F</em>, depending on the rank of the contrast. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-9"></span>
<h1 id="Data_exchangeable_within_block">Data exchangeable within block</h1>
<span class="anchor" id="line-10"></span><p class="line874">If there are restrictions on exchangeability, blocks of data can be defined such that shuffling happens within block only. The exchangeability blocks file contains a single column vector with integer indices, each specifying a block. This file is supplied with the option -eb. An example is: <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867"><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><pre><span class="anchor" id="line-1"></span>1
<span class="anchor" id="line-2"></span>1
<span class="anchor" id="line-3"></span>1
<span class="anchor" id="line-4"></span>1
<span class="anchor" id="line-5"></span>2
<span class="anchor" id="line-6"></span>2
<span class="anchor" id="line-7"></span>2</pre><span class="anchor" id="line-21"></span><p class="line862">Permutations happen only between the observations that share the same index, i.e., within block only. For this kind of permutation, the blocks are not required to be of the same size. Moreover, it is no longer necessary to assume homoscedasticity, and by using the option <strong>-vg auto</strong>, each block is considered a variance group (VG). For the example above, this means that the automatic variance groups are: <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867"><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><pre><span class="anchor" id="line-1-1"></span>1
<span class="anchor" id="line-2-1"></span>1
<span class="anchor" id="line-3-1"></span>1
<span class="anchor" id="line-4-1"></span>1
<span class="anchor" id="line-5-1"></span>2
<span class="anchor" id="line-6-1"></span>2
<span class="anchor" id="line-7-1"></span>2</pre><span class="anchor" id="line-32"></span><p class="line862">Variances are estimated for each block, and statistics that are robust to heteroscedasticity are computed. In this case, instead of <em>t</em>, the Aspin-Welch <em>v</em> is calculated, and instead of <em>F</em>, the <em>G</em> statistic, which is a generalisation of all these common statistics. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line874">However, if the user wants to group the observations differently based on other variance assumptions, irrespectively to the specification of exchangeability blocks, a file with variance groups indices can be supplied with the option -vg. The file format for the variance groups is always column vector with integer indices, similar as the example above. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-37"></span>
<h1 id="Blocks_of_data_exchangeable_as_a_whole">Blocks of data exchangeable as a whole</h1>
<span class="anchor" id="line-38"></span><p class="line862">If there are restrictions on exchangeability, and if instead of shuffling within block, the blocks as a whole can be shuffled while keeping the observations inside the block in the same order, the exchangeability blocks file is supplied with the option -eb, exactly as above, and the flag <strong>-whole</strong> (whole-block shuffling) is supplied. An example of such file is: <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867"><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><pre><span class="anchor" id="line-1-2"></span>1
<span class="anchor" id="line-2-2"></span>1
<span class="anchor" id="line-3-2"></span>1
<span class="anchor" id="line-4-2"></span>2
<span class="anchor" id="line-5-2"></span>2
<span class="anchor" id="line-6-2"></span>2</pre><span class="anchor" id="line-48"></span><p class="line862">Permutations and/or sign-flips, as applicable, will rearrange the blocks as a whole, not each observation individually. All blocks must be of the same size. Moreover, it is no longer necessary to assume homoscedasticity, and by using the option <strong>-vg auto</strong>, variance groups are defined such that the first group includes all the first observations in each block, the second group all the second observations in each block, and so on. For the example above, the automatic variance groups are: <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line867"><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><pre><span class="anchor" id="line-1-3"></span>1
<span class="anchor" id="line-2-3"></span>2
<span class="anchor" id="line-3-3"></span>3
<span class="anchor" id="line-4-3"></span>1
<span class="anchor" id="line-5-3"></span>2
<span class="anchor" id="line-6-3"></span>3</pre><span class="anchor" id="line-58"></span><p class="line862">Variances are then estimated within group, and statistics that are robust to heteroscedasticity are computed, i.e., instead of <em>t</em>, <em>v</em> is calculated, and instead of <em>F</em>, the <em>G</em> statistic is calculated. As in the within block case, the default definition of variance groups can be overridden with the specification of a variance groups file with the option -vg. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867">
<h1 id="Simultaneous_whole-_and_within-block_permutation">Simultaneous whole- and within-block permutation</h1>
<span class="anchor" id="line-63"></span><p class="line862">If the file supplied with the exchangeability blocks has just 1 column, the options <strong>-within</strong> and <strong>-whole</strong> can be used together to indicate that blocks can be shuffled as a whole, and that the observations can be further shuffled within-block. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867">
<h1 id="Complex_dependence_between_data">Complex dependence between data</h1>
<span class="anchor" id="line-68"></span><p class="line874">It is possible to have multiple levels of complexity, each encompassing within-block and whole-block shuffling, which are then nested into each other. This can be done by supplying an exchangeability blocks file not with one, but with multiple columns. Each column indicates a deeper level of dependence. Indices on one level indicate how the unique sub-indices of the next level should be shuffled: <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><ul><li>Positive indices at a given level indicate that the sub-indices of the next level should be shuffled as a whole, akin to whole-block shuffling described above. <span class="anchor" id="line-71"></span></li><li>Negative indices at given level indicate that the corresponding sub-indices in the next level should remain fixed and their own sub-sub-indices should be shuffled, akin to within block permutation described above. <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span></li></ul><p class="line874">With this more complex structure, the option -whole and -within, even if supplied, are ignored, as this information is embedded, at the multiple levels, in the file with the block definitions. In fact, even in the simpler cases of no blocks, within and whole block permutation, discussed above, can be fully specified using a multi-column exchangeability blocks file, regardless of these options. <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line867"><strong>Example 1:</strong> Freely exchangeable data. This is equivalent to having all observations in a single block, with no restrictions. <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line867"><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><pre><span class="anchor" id="line-1-4"></span>1 1
<span class="anchor" id="line-2-4"></span>1 2
<span class="anchor" id="line-3-4"></span>1 3
<span class="anchor" id="line-4-4"></span>1 4
<span class="anchor" id="line-5-4"></span>1 5
<span class="anchor" id="line-6-4"></span>1 6</pre><span class="anchor" id="line-85"></span><p class="line874">The 1st column indicates that all indices in the next level (1,...,6) can be shuffled with each other. This also implies a single large variance group that encompasses all observations. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line867"><strong>Example 2:</strong> Three blocks of data that are exchangeable within block only. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line867"><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><pre><span class="anchor" id="line-1-5"></span>-1 1
<span class="anchor" id="line-2-5"></span>-1 1
<span class="anchor" id="line-3-5"></span>-1 2
<span class="anchor" id="line-4-5"></span>-1 2
<span class="anchor" id="line-5-5"></span>-1 3
<span class="anchor" id="line-6-5"></span>-1 3</pre><span class="anchor" id="line-97"></span><p class="line874">The negative indices in the 1st column indicate that the sub-indices in the next column cannot be shuffled. The indices for each individual observation here were omitted, but could equivalently have been specified as: <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line867"><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><pre><span class="anchor" id="line-1-6"></span>-1 1 1
<span class="anchor" id="line-2-6"></span>-1 1 2
<span class="anchor" id="line-3-6"></span>-1 2 1
<span class="anchor" id="line-4-6"></span>-1 2 2
<span class="anchor" id="line-5-6"></span>-1 3 1
<span class="anchor" id="line-6-6"></span>-1 3 2</pre><span class="anchor" id="line-107"></span><p class="line874">The automatic VG looks like this <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line867"><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><pre><span class="anchor" id="line-1-7"></span>1
<span class="anchor" id="line-2-7"></span>1
<span class="anchor" id="line-3-7"></span>2
<span class="anchor" id="line-4-7"></span>2
<span class="anchor" id="line-5-7"></span>3
<span class="anchor" id="line-6-7"></span>3</pre><span class="anchor" id="line-117"></span><p class="line874">The positive indices in the 2nd column indicate that the respective sub-indices in the next column can be shuffled. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><strong>Example 3:</strong> Three blocks of data that are exchangeable as a whole. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line867"><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><pre><span class="anchor" id="line-1-8"></span>1 1
<span class="anchor" id="line-2-8"></span>1 1
<span class="anchor" id="line-3-8"></span>1 2
<span class="anchor" id="line-4-8"></span>1 2
<span class="anchor" id="line-5-8"></span>1 3
<span class="anchor" id="line-6-8"></span>1 3</pre><span class="anchor" id="line-129"></span><p class="line874">The positive index in the 1st column indicates that the respective sub-indices in the next column (level) are exchangeable as a whole. The same could equivalently have been specified as: <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line867"><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><pre><span class="anchor" id="line-1-9"></span>1 -1 1
<span class="anchor" id="line-2-9"></span>1 -1 2
<span class="anchor" id="line-3-9"></span>1 -2 1
<span class="anchor" id="line-4-9"></span>1 -2 2
<span class="anchor" id="line-5-9"></span>1 -3 1
<span class="anchor" id="line-6-9"></span>1 -3 2</pre><span class="anchor" id="line-139"></span><p class="line874">The 1st column indicates that the sub-indices in the next level (2nd column) are exchangeable as a whole. The negative indices in the 2nd level indicate that each respective sub-index, now in the 3rd column is exchangeable with each other, i.e., within the blocks specified in the previous level. <span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line874">The automatic VG looks like this <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line867"><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><pre><span class="anchor" id="line-1-10"></span>1
<span class="anchor" id="line-2-10"></span>2
<span class="anchor" id="line-3-10"></span>1
<span class="anchor" id="line-4-10"></span>2
<span class="anchor" id="line-5-10"></span>1
<span class="anchor" id="line-6-10"></span>2</pre><span class="anchor" id="line-151"></span><p class="line874">These same basic rules apply to hierarchies of blocks that can become far more complex. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line867">
<h1 id="Visualisation_of_the_block_structure">Visualisation of the block structure</h1>
<span class="anchor" id="line-156"></span><p class="line862">A pictorial representation of the block structure can be produced using commands distributed with PALM and with the freely available <a class="http" href="http://www.graphviz.org">GraphViz</a> software package. The steps are: <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><p class="line874">1. Load the exchangeability blocks file: <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><p class="line867"><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-1-1"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-37c2ef871e7ba644e6a5a9327642265537e6ab46" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span><span class="ID">EB</span> = <span class="ID">csvread</span>(<span class="String">'</span><span class="String">EB.csv'</span>);</span>
</pre></div></div><span class="anchor" id="line-163"></span><p class="line874">2. Load the design matrix, using either palm_vestread or csvread: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line867"><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-1-3"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ce7396fccdd73a38a6b58de2e543edc428e3bb9b" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="ID">M</span> = <span class="ID">palm_vestread</span>(<span class="String">'</span><span class="String">design.mat'</span>);</span>
</pre></div></div><span class="anchor" id="line-168"></span><p class="line874">or <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line867"><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-1-5"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-31df3eacd01ae71322ddfd1b64dfeda33c70ecaa" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span><span class="ID">M</span> = <span class="ID">csvread</span>(<span class="String">'</span><span class="String">design.csv'</span>);</span>
</pre></div></div><span class="anchor" id="line-173"></span><p class="line874">Alternatively, if you don't have a design matrix, but know that it would contain only continuous regressors, use simply: <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line867"><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-1-7"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-b3f1e263c52e5d414e97c9d99de5e62c1deca58e" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span><span class="ID">M</span> = (<span class="Number">1</span>:<span class="ResWord">size</span>(<span class="ID">EB</span>,<span class="Number">1</span>))';</span>
</pre></div></div><span class="anchor" id="line-178"></span><p class="line874">3. Generate the permutation tree with: <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line867"><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-1-9"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f97446b7e5cc57cf1586cd65cfdbdc0370a2f14b" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span><span class="ID">EB</span> = <span class="ID">palm_reindex</span>(<span class="ID">EB</span>,<span class="String">'</span><span class="String">fixleaves'</span>);</span>
<span class="line"><span class="anchor" id="line-2-1"></span><span class="ID">Ptree</span> = <span class="ID">palm_tree</span>(<span class="ID">EB</span>,<span class="ID">M</span>);</span>
</pre></div></div><span class="anchor" id="line-184"></span><p class="line874">4. Create a .dot file with: <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><p class="line867"><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-1-11"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-88676ecf8d011f44b502669a1500023d640a055a" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span><span class="ID">palm_ptree2dot</span>(<span class="ID">Ptree</span>,<span class="String">'</span><span class="String">ptree.dot'</span>);</span>
</pre></div></div><span class="anchor" id="line-189"></span><p class="line874">5. Outside Matlab/Octave, run: <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><p class="line867"><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-1-13"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a0b24334f692884f0097316ab6f71c4b2b8881bb" lang="en"><span class="line"><span class="anchor" id="line-1-14"></span>circo ptree.dot -Tsvg -o ptree.svg</span>
</pre></div></div><span class="anchor" id="line-194"></span><p class="line862">The resulting .svg file can be opened in <a class="https" href="https://inkscape.org">Inkscape</a> or other vector-based imaging application, and edited for different colours and line styles and thicknesses as needed. <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line862">An example is shown below. At each permutation, branches beginning at blue dots can be permuted; those beginning in red dots cannot. Other examples and details are discussed in the respective <a class="http" href="http://www.sciencedirect.com/science/article/pii/S105381191500508X">paper</a>: <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><p class="line867"><img align="center" alt="ptree.png" class="attachment" src="attachments/PALM(2f)ExchangeabilityBlocks/ptree.png" title="ptree.png" /> <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><p class="line867">
<h1 id="EBs_for_data_of_the_Human_Connectome_Project">EBs for data of the Human Connectome Project</h1>
<span class="anchor" id="line-203"></span><p class="line874">To do permutation tests with HCP data, the EB file follows a multi-column format, defining blocks for each family that can be shuffled as a whole, and within these, subjects that can be permuted within family. To create this file considering the kinship of hundreds of HCP subjects would be laborious and error prone. Here we provide a Matlab/Octave script to automate this task. To use it, use the following steps: <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><ol type="1"><li><p class="line862">Make sure you have been granted permission to use restricted HCP data. If not, apply for such permission following the instructions in the <a class="http" href="http://www.humanconnectome.org">HCP website</a> (see also the note below). <span class="anchor" id="line-206"></span></li><li>Once you have permission, download the most recent version of the file containing the restricted data. It's a CSV file that, once downloaded, is named something as &quot;RESTRICTED_yourname_MM_DD_YY_HH_MM_SS.csv&quot;. <span class="anchor" id="line-207"></span></li><li><p class="line862">Download the functions <strong><a class="https" href="https://raw.githubusercontent.com/andersonwinkler/HCP/master/share/hcp2blocks.m">hcp2blocks.m</a></strong> and also its requisite <strong><a class="https" href="https://raw.githubusercontent.com/andersonwinkler/HCP/master/share/strcsvread.m">strcsvread.m</a></strong>, and put both into a directory where Matlab/Octave can find them (or add the location to the path with <strong>addpath</strong>). <span class="anchor" id="line-208"></span></li><li><p class="line862">Inside Matlab/Octave, run <strong>hcp2blocks</strong>. The simplest call is just: <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span></li></ol><p class="line867"><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-1-15"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-68ddf0db28ef3734c31bd483ae879c8738ce8ee5" lang="en"><span class="line"><span class="anchor" id="line-1-16"></span><span class="ID">hcp2blocks</span>(<span class="String">'</span><span class="String">RESTRICTED_yourname_MM_DD_YY_HH_MM_SS.csv'</span>, <span class="String">'</span><span class="String">EB.csv'</span>);</span>
</pre></div></div><span class="anchor" id="line-213"></span><p class="line862">The above will create a file named 'EB.csv' containing the block definitions for all subjects that have complete family information in the restricted file (that is, those with both father ID and mother ID, and with zygosity information), in the same order as in the restricted file, and ready to be used with the option <strong>-eb</strong> in PALM. The last column of the EB.csv file is the subject ID; it could have been any unique number, but the actual ID is used for convenience, and you can use this column to make sure that the order that the subjects are entered in the input files (supplied to PALM with <strong>-i</strong>) match the order as in this file. Alternatively, you can also swap the rows of EV.csv as needed to match the order of the inputs. However, you must not delete or include extra rows (see below how to select specific subjects). Also, don't delete any of the columns, not even the last one that has the subject IDs. <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><p class="line862">For permutation purposes, dizygotic twins (DZ) are treated differently than non-twins (NT), that is, DZ are by default not allowed to be shuffled with non-twin subjects, even in the same family. However, given that DZ pairs have the same kinship as NT siblings, you may consider allowing them so be swapped in permutations. You can give a 3rd argument to hcp2blocks as <strong>true</strong> to indicate that: <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line867"><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-1-17"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-1f4d882b2c1ab29a7a1686b9ac539cc65718e399" lang="en"><span class="line"><span class="anchor" id="line-1-18"></span><span class="ID">hcp2blocks</span>(<span class="String">'</span><span class="String">RESTRICTED_yourname_MM_DD_YY_HH_MM_SS.csv'</span>, <span class="String">'</span><span class="String">EB.csv'</span>, <span class="ID">true</span>);</span>
</pre></div></div><span class="anchor" id="line-220"></span><p class="line862">The above will treat DZ as NT, and allow these to be mixed freely as the shufflings are performed. If this 3rd argument is omitted, or marked as <strong>false</strong>, DZ will be treated as a category on their own. <span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><p class="line874">To select only some specific subjects, you can provide a 4th argument, that is just a vector of subject IDs. For example: <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><p class="line867"><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-1-19"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-8f854475c1efc9dea17d3e0cfa673a766918024f" lang="en"><span class="line"><span class="anchor" id="line-1-20"></span><span class="ID">hcp2blocks</span>(<span class="String">'</span><span class="String">RESTRICTED_yourname_MM_DD_YY_HH_MM_SS.csv'</span>, <span class="String">'</span><span class="String">EB.csv'</span>, <span class="ID">false</span>, <span class="Comment">...</span></span>
<span class="line"><span class="anchor" id="line-2-2"></span>   [<span class="Number">100307</span> <span class="Number">100408</span> <span class="Number">101006</span> <span class="Number">101107</span> <span class="Number">101309</span> <span class="Number">101410</span> <span class="Number">101915</span> <span class="Number">102008</span> <span class="Number">102311</span> <span class="Number">102816</span>]');</span>
</pre></div></div><span class="anchor" id="line-228"></span><p class="line874">The output will file will contain the EBs considering just these subjects, with each row in the same order as these subject IDs are indicated. <span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><p class="line862">Once the EB.csv has been generated, it can be supplied to PALM with the option <strong>-eb</strong>. <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><p class="line874">If, for whatever reason, you'd like to have the definitions of the EBs in the Matlab/Octave workspace, it can be stored into a variable without the need to read the EV.csv from the disk: <span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line867"><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-1-21"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-4c165c2bda8e319e3a815ccb4efd8f565fba8139" lang="en"><span class="line"><span class="anchor" id="line-1-22"></span><span class="ID">EB</span> = <span class="ID">hcp2blocks</span>(<span class="Comment">...);</span></span>
</pre></div></div><span class="anchor" id="line-237"></span><p class="line862">All subjects are treated as part of the same large variance group, unless a custom file is supplied to PALM with <strong>-vg</strong>, or if <strong>-vg auto</strong> is used, in which case, the most restrictive possible variance group configuration will automatically be created, using the information from the exchangeability blocks file. Typically you won't want to do this with HCP data, so that the option <strong>-vg</strong> can be omitted. <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line867"><strong>Note:</strong> The restricted HCP file is used (as opposed to the unrestricted) because the field &quot;age in years&quot; is necessary to disambiguate a few (rare) cases, ruling out the possibility of twins if the ages are different. The full restricted file isn't actually needed, just the columns &quot;Subject&quot;, &quot;Mother_ID&quot;, &quot;Father_ID&quot;, &quot;ZygositySR&quot;, &quot;ZygosityGT&quot; and &quot;Age_in_Yrs&quot;. The fields &quot;ZygositySR&quot; and &quot;ZygosityGT&quot; may be replaced by a single field &quot;Zygosity&quot;. <span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line867">
<h1 id="Generating_the_set_of_permutations_only">Generating the set of permutations only</h1>
<span class="anchor" id="line-244"></span><p class="line862">If all that you need are the set of permutations and/or sign-flippings that respect restrictions on exchangeability, so that you can apply to your own algorithms, perhaps even in other programs, open Octave or Matlab and use the command <strong>palm_quickperms</strong>, that comes with PALM: <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line867"><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-1-23"></span><div class="highlight matlab"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-c7e97240e213bb1e238d94b0cfa881948929b9e0" lang="en"><span class="line"><span class="anchor" id="line-1-24"></span>[<span class="ID">Pset</span>, <span class="ID">VG</span>] = <span class="ID">palm_quickperms</span>(<span class="ID">M</span>, <span class="ID">EB</span>, <span class="ID">P</span>, <span class="ID">EE</span>, <span class="ID">ISE</span>, <span class="ID">CMCx</span>, <span class="ID">CMCp</span>);</span>
</pre></div></div><span class="anchor" id="line-249"></span><p class="line874">The inputs are: <span class="anchor" id="line-250"></span><div><table><tbody><tr>  <td><p class="line862">M </td>
  <td><p class="line862">Design matrix. It can be the full, unpartitioned design, or if there are nuisance, simply the part that contains the EVs of interest. This distinction is only relevant if there are discrete EVs of interest and nuisance variables that are continuous. You may consider a partitioning as in the function <strong>palm_partition</strong>. If you have no idea what to use, it is in general safe to use as M simply a vector (1:N)', where N is the number of rows in the design. This will not affect any regression and will only be used to define the permutations. You can also simply leave it empty (i.e., [ ]) if EB is supplied, and by default it will then be (1:N)'. If an EB isn't supplied, you can simply enter the value N in the place of M and by default it will be (1:N)'. </td>
</tr>
<tr>  <td><span class="anchor" id="line-251"></span><p class="line862">EB </td>
  <td><p class="line862">Exchangeability blocks. It can be multi-level. For freely exchangeable data, leave empty (i.e., [ ]), or use ones(N,1). If empty, a valid, non-empty M must be supplied, and the data will be shuffled freely. You can also simply enter N to the same effect. </td>
</tr>
<tr>  <td><span class="anchor" id="line-252"></span><p class="line862">P </td>
  <td><p class="line862">Optional. The requested number of permutations. The actual number may be smaller if N is too small. Default is 5000. </td>
</tr>
<tr>  <td><span class="anchor" id="line-253"></span><p class="line862">EE </td>
  <td><p class="line862">Optional. True/False indicating whether to assume exchangeable errors, which allow permutations. Default is true. </td>
</tr>
<tr>  <td><span class="anchor" id="line-254"></span><p class="line862">ISE </td>
  <td><p class="line862">Optional. True/False indicating whether to assume independent and symmetric errors, which allow sign-flippings. Default is false. </td>
</tr>
<tr>  <td><span class="anchor" id="line-255"></span><p class="line862">CMCx </td>
  <td><p class="line862">Optional. True/False indicating whether repeated rows in the design should be be ignored. Default is false. </td>
</tr>
<tr>  <td><span class="anchor" id="line-256"></span><p class="line862">CMCp </td>
  <td><p class="line862">Optional. True/False indicating whether repeated permutations should be ignored. Default is false. For large N and large P, consider using &quot;true&quot; as it makes the generation of the permutation set much faster, with no practical difference at the end. </td>
</tr>
</tbody></table></div><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><p class="line874">All inputs are optional, but at least one of M or EB must be supplied. <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><p class="line874">The outputs are: <span class="anchor" id="line-264"></span><div><table><tbody><tr>  <td><p class="line862">Pset </td>
  <td><p class="line862">Permutation set. It is a N by P matrix, thus having one permutation per column. Sign-flippings are represented with negative indices. To convert this to a cell array of permutation matrices, that can be used for matrix multiplication, see the command <strong>palm_idx2perm</strong>. </td>
</tr>
<tr>  <td><span class="anchor" id="line-265"></span><p class="line862">VG </td>
  <td><p class="line862">Variance groups (VGs), to be used with a statistic that is robust to heteroscedasticity if needed. </td>
</tr>
</tbody></table></div><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line874">If you need to export Pset, use dlmwrite to save as a text file that can be imported elsewhere. <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><p class="line862">To generate the permutation set for HCP data, follow the instructions in the previous section (<a href="./PALM(2f)ExchangeabilityBlocks.html#EBs_for_data_of_the_Human_Connectome_Project">above</a>) to generate the EB variable, then supply it to palm_quickperms. <span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><p class="line874">Note that all this is only necessary if you need the set of permutations, which can be difficult to generate otherwise, e.g., in lexicographic order if exhaustive, or permutations with sign-flippings (sometimes called &quot;wild bootstrap&quot;), or shufflings that respect complex exchangeability, so that these permutations can be used with your own algorithms. It is not necessary to use palm_quickperms in any situation in which you can use PALM directly, since it is all done internally. <span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><p class="line874">If you use the set of permutations in your algorithms, please cite the two papers below. <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-279"></span>
<h1 id="References">References</h1>
<span class="anchor" id="line-280"></span><p class="line874">The methods used in PALM to handle exchangeability blocks are described in: <span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><p class="line867"><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><div class="references"><span class="anchor" id="line-1-25"></span><p class="line862">* Winkler AM, Webster MA, Vidaurre D, Nichols TE, Smith SM. <a class="http" href="http://www.sciencedirect.com/science/article/pii/S105381191500508X">Multi-level block permutation.</a> Neuroimage. 2015;123:253-68. (Open Access) <span class="anchor" id="line-2-3"></span><span class="anchor" id="line-3-1"></span><p class="line862">* Winkler AM, Ridgway GR, Webster MA, Smith SM, Nichols TE. <a class="http" href="http://www.sciencedirect.com/science/article/pii/S1053811914000913">Permutation inference for the general linear model.</a> <a class="nonexistent" href="./NeuroImage.html">NeuroImage</a>, 2014;92:381-397. (Open Access) </div><span class="anchor" id="line-287"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
