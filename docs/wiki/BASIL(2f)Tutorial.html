<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>BASIL/Tutorial</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">BASIL/Tutorial</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./BASIL.html">Introduction</a></li><li><a href="./BASIL(2f)UserGuide.html">User Guide</a></li><li>Tutorial<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Single-delay_ASL">Single-delay ASL</a><ol><li>
<a href="#Dataset_1:_pcASL">Dataset 1: pcASL</a><ol><li>
<a href="#Exercise_1.1:_Tag-control_subtraction">Exercise 1.1: Tag-control subtraction</a></li><li>
<a href="#Exercise_1.2:_Kinetic_model_inversion">Exercise 1.2: Kinetic model inversion</a></li><li>
<a href="#Exercise_1.3:_Calibration">Exercise 1.3: Calibration</a></li><li>
<a href="#Exercise_1.4:_Improving_the_registration_and_other_options">Exercise 1.4: Improving the registration and other options</a></li></ol></li></ol></li><li>
<a href="#Multi-delay_ASL">Multi-delay ASL</a><ol><li>
<a href="#DATASET_1:_pulsed_ASL">DATASET 1: pulsed ASL</a><ol><li>
<a href="#Exercise_1.1:_CBF_estimation">Exercise 1.1: CBF estimation</a></li><li>
<a href="#Exercise_1.2:_CBF_estimation_with_a_macro_vascular_component">Exercise 1.2: CBF estimation with a macro vascular component</a></li></ol></li><li>
<a href="#DATASET_2:_pseudo_continuous_ASL">DATASET 2: pseudo continuous ASL</a><ol><li>
<a href="#Exercise_2.1:_Tag-control_subtraction">Exercise 2.1: Tag-control subtraction</a></li><li>
<a href="#Exercise_2.2:_CBF_estimation">Exercise 2.2: CBF estimation</a></li></ol></li><li>
<a href="#DATASET_3:_QUASAR">DATASET 3: QUASAR</a><ol><li>
<a href="#Exercise_3.1:_Model-based_analysis">Exercise 3.1: Model-based analysis</a></li><li>
<a href="#Exercise_3.2:_Model-free_analysis">Exercise 3.2: Model-free analysis</a></li></ol></li></ol></li><li>
<a href="#Acknowledgments">Acknowledgments</a></li></ol></div></div></li><li><a href="./BASIL(2f)FurtherInformation.html">Further Information</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-6"></span><p class="line874">In this section you will find a number of tutorials on the analysis of ASL data using the BASIL tools. If you are trying to use BASIL on your own data then a good place to begin is to find an example here that is as close to the data you have as a guide on how to proceed. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line867">
<h1 id="Single-delay_ASL">Single-delay ASL</h1>
<span class="anchor" id="line-11"></span><p class="line867">
<h2 id="Dataset_1:_pcASL">Dataset 1: pcASL</h2>
<span class="anchor" id="line-12"></span><p class="line874">This tutorial runs through the use of the BASIL command line tools on single-delay ASL data, the example data uses pcASL labelling and can be found here (~35 MB): <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><ul><li><p class="line891"><a class="attachment" href="attachments/BASIL(2f)Tutorial/data_singledelay.zip" title="">data_singledelay.zip</a> <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span></li></ul><p class="line874">Please note that the data is only provided for training purposes and should not be used for research without permission. <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line867">
<h3 id="Exercise_1.1:_Tag-control_subtraction">Exercise 1.1: Tag-control subtraction</h3>
<span class="anchor" id="line-19"></span><p class="line862">The first (and simplest) thing to do with the data is tag-control subtraction to get a perfusion weighted image. This can be achieved with <tt class="backtick">asl_file</tt>: <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line867"><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><pre><span class="anchor" id="line-1"></span>asl_file --data=data --ntis=1 --iaf=tc --diff --out=diffdata --mean=diffdata_mean</pre><span class="anchor" id="line-24"></span><p class="line862">Note that we have told <tt class="backtick">asl_file</tt> that the data contains only a single delay (<tt class="backtick">--ntis=1</tt>), that we have tag and control pairs (<tt class="backtick">--iaf=tc</tt> - standing for input ASL format). We have asked asl_file to perform tag control differencing (<tt class="backtick">--diff</tt>) and then output to a file called <tt class="backtick">diffdata</tt>, we have also asked for a second output in mean the mean has been taken across all the repeats in the data (<tt class="backtick">--mean=diffdata_mean</tt>).  If you examine the <tt class="backtick">diffdata_mean</tt> image you should see something that looks like an image of perfusion. In fact if we were happy with relative perfusion values we could stop here. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867">
<h3 id="Exercise_1.2:_Kinetic_model_inversion">Exercise 1.2: Kinetic model inversion</h3>
<span class="anchor" id="line-27"></span><p class="line862">If we want to quantify perfusion in absolute units (ml/100g/min) then the next step is to invert the kinetic model - the model describes how the rate of delivery of labeled blood (and thus perfusion) is related to the measured signal. This can be achieved using <tt class="backtick">oxford_asl</tt> (that makes a call to the <tt class="backtick">basil</tt> command line tool to do the actual model inversion). To do this we now need to know some information about the data, namely: <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><ul><li><p class="line862">Labeling was performed using pcASL (thus we need the <tt class="backtick">--casl</tt> option). <span class="anchor" id="line-30"></span></li><li><p class="line862">Labelling was performed for 1.4 seconds (<tt class="backtick">--bolus&nbsp;1.4</tt>). <span class="anchor" id="line-31"></span></li><li>The post-labeling delay was 1.5 seconds. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></li></ul><p class="line862">The post-labelling delay corresponds to an 'inversion time' of 2.9 seconds, i.e. 1.4 + 1.5. Thus we set <tt class="backtick">--tis&nbsp;2.9</tt> - this is the list of TIs, where we only have one in this case). Here we have data with only a single delay (and BASIL includes various features for multi-delay data) - <tt class="backtick">oxford_asl</tt> sets a number of other options that are appropriate for single delay data (<tt class="backtick">--artoff&nbsp;--fixbolus</tt>). Note that before FSL 5.0.6 you would need to add the <tt class="backtick">--singleti</tt> option. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><pre><span class="anchor" id="line-1-1"></span>oxford_asl -i diffdata -o ex1_2 --tis 2.9 --bolus 1.4 --casl</pre><span class="anchor" id="line-38"></span><p class="line862">In the <tt class="backtick">ex1_2/native_space</tt> directory you will find the results: a <tt class="backtick">perfusion</tt> image that will look very similar to the one derived in the first exercise, but the magnitude scale will be different. However, this is still only in relative units, we have yet to complete the final step needed to get perfusion in absolute units. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line862">You may also notice an <tt class="backtick">arrival</tt> image, this gives the arterial (bolus) arrival time (in seconds) in every voxel. Since this cannot be estimated from single delay data the image will be uniform and default to 0.7 seconds (or whatever value you choose with the <tt class="backtick">--bat</tt> option). <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line867">
<h3 id="Exercise_1.3:_Calibration">Exercise 1.3: Calibration</h3>
<span class="anchor" id="line-43"></span><p class="line874">To finally get perfusion in absolute units we also need to calculate the equilibrium magnetization of arterial blood and include that in the calculations. Now we need to know some more information about our data. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><ul><li>Background suppression was ON. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></li></ul><p class="line862">This should have improved our perfusion contrast by removing as much static tissue signal as possible. However, we with this cannot use the control images to estimate equilibrium magnetization values. Instead there is a separate dataset, called <tt class="backtick">calib</tt>, which is a series of control images with BGS OFF. We also have <tt class="backtick">calib_body</tt> data in which control images were acquired with the same parameters but using the body coil. We will assume that the latter has a relatively flat sensitivity and use this to correct for sensitivity variation in the coil we used for the main acquisition. At this stage we also supply a structural image - this will be used to segment out the ventricles which will form the basis of our magnetization estimation, plus the perfusion image will also be transformed into the same resolution as the structural image via registration. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><pre><span class="anchor" id="line-1-2"></span>bet data_singleti/struct struct_brain
<span class="anchor" id="line-2"></span>oxford_asl -i diffdata -o ex1_3 --tis 2.9 --bolus 1.4 --casl -c calib --cref calib_body -s struct_brain</pre><span class="anchor" id="line-53"></span><p class="line862">In <tt class="backtick">ex1_3/native_space</tt> you should find <tt class="backtick">perfusion</tt> which is the same image as in Ex 1.2, but now it will have been joined by <tt class="backtick">perfusion_calib</tt>, which is perfusion in ml/100g/min. You should also find <tt class="backtick">ex1_3/structural_space</tt> that has the same results but in a resolution that matches the structural image, the transformation for this process can be found in <tt class="backtick">ex1_3/native_space/asl2struct.mat</tt>. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line862">The results of the calibration process will be saved in <tt class="backtick">ex1_3/calib</tt>, here you should find <tt class="backtick">M0.txt</tt> which is the estimated M0 value needed to get the perfusion image into absolute units as well as <tt class="backtick">refmask</tt> that you should inspect to check that it looks like the CSF in the ventricles has been selected. For this data it should have worked fine, but if you find data for which this has failed you might need to manually mask a region of CSF in the ventricles and supply that to <tt class="backtick">oxford_asl</tt> using the <tt class="backtick">--csf</tt> option (see the next exercise). <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line862">Note that oxford_asl always uses CSF as a reference for calibration. Other regions and alternative methods are possible and can be accessed through <tt class="backtick">asl_calib</tt>, which can be used to calculate an M0 value that can then be applied to the <tt class="backtick">perfusion</tt> image. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line867">
<h3 id="Exercise_1.4:_Improving_the_registration_and_other_options">Exercise 1.4: Improving the registration and other options</h3>
<span class="anchor" id="line-60"></span><p class="line874">In the previous example registration was carried out between the raw ASL data and structural image, it should have worked but we would probably like to do better. However, this is a tricky process (due to the low resultion of the ASL data) and is particularly prone to failure if you only have data in which tag-control subtraction has already been done. In the previous example oxford_asl used the calibration image as the basis for registration (if this had not been available it would have used the perfusion image), it is possible to supply another image as the basis for registration: here we will use the mean of the raw data. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867"><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><pre><span class="anchor" id="line-1-3"></span>fslmaths data -Tmean data mean
<span class="anchor" id="line-2-1"></span>bet datamean datamean_brain
<span class="anchor" id="line-3"></span>fslmaths data -Tmean datamean</pre><span class="anchor" id="line-67"></span><p class="line874">Like before we will carry out calibration, but to save repeating the identification of the ventricles we will re-use the mask from before. <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line874">Finally, this time we will apply a spatial smoothing prior to the perfusion image. This exploits spatial homogeneity in the perfusion image to improve the estimation, but in an adaptive manner. This is similar to spatially smoothing the data before analysis, but it applies it to the estimated perfusion image and not the data, whilst also estimating the correct degree of spatial smoothing from the data. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867"><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><pre><span class="anchor" id="line-1-4"></span>oxford_asl -i diffdata -o ex1_4 --tis 2.9 --bolus 1.4 --casl -c calib --cref calib_body -s struct_brain --csf ex1_3/calib/refmask --regfrom datamean_brain --spatial</pre><span class="anchor" id="line-74"></span><p class="line862">The structure of the results will be the same as in the previous exercise. Compare the two and see what difference the choice of registration basis has made  and the use of the <tt class="backtick">--spatial</tt> option, this should be most clear on the <tt class="backtick">native_space</tt> data. <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867">
<h1 id="Multi-delay_ASL">Multi-delay ASL</h1>
<span class="anchor" id="line-79"></span><p class="line862">This tutorial runs through the use of <tt class="backtick">oxford_asl</tt> (the command line tool) on a number of different multi-delay ASL datasets. Examples of pASL, pcASL and QUASAR data are included. The data can be found here (~50 MB): <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><ul><li><p class="line891"><a class="attachment" href="attachments/BASIL(2f)Tutorial/basildata.zip" title="">basildata.zip</a> <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span></li></ul><p class="line874">Please note that the data is only provided for training purposes and should not be used for research without permission. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-86"></span>
<h2 id="DATASET_1:_pulsed_ASL">DATASET 1: pulsed ASL</h2>
<span class="anchor" id="line-87"></span><p class="line862">This dataset is resting-state ASL data collected using a single-shot three-dimensional GRASE readout, TR/TE 3110/23 ms, 3.44x3.44x5mm, 22 slices using a matrix size 64x64, FAIR preparation, background suppression. Alternating control and tag pairs were acquired with 10 TIs (400, 620, 840, 1060, 1280, 1500, 1720, 1940, 2160, 2380 ms), each one repeated 10 times. The data is in the directory <tt class="backtick">data_pasl</tt>. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line862">In this case the tag-control subtraction has already been done and the multiple measurements at each TI have been averaged, this has been put in the file <tt class="backtick">diffdata.nii.gz</tt>. (In a later exercise we will see how that was done). Have a look at the differenced data using FSLview: <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867"><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><pre><span class="anchor" id="line-1-5"></span>fslview pasl_data/diffdata &amp;</pre><span class="anchor" id="line-94"></span><p class="line874">You might like to flick through the different volumes and see if you can spot the label washing in and then decaying away again. Notice that the label arrives in some regions later than others. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867">
<h3 id="Exercise_1.1:_CBF_estimation">Exercise 1.1: CBF estimation</h3>
<span class="anchor" id="line-97"></span><p class="line874">Firstly we are going to do the model-fitting. Try typing this in your terminal <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line867"><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><pre><span class="anchor" id="line-1-6"></span>oxford_asl</pre><span class="anchor" id="line-102"></span><p class="line862">If you call <tt class="backtick">oxford_asl</tt> without any options you get the usage information. There is a lot of functionality (and we do not want to use all of it now), the three main things it can do are: model-fitting, registration and calibration. We need to do model-fitting to get CBF from the multi-TI data, so we will need: <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><ul><li>The tag-control differenced ASL data - we have this already. <span class="anchor" id="line-105"></span></li><li>The TIs that were used to acquire the data - 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38. <span class="anchor" id="line-106"></span></li><li>The duration of the ASL bolus - the acquisition was FAIR, so the bolus duration is determined by the labelling coil (body). In fact the bolus duration for this data is around 1.1 s, so we will use that value, but allow the model fitting to refine that estimate (this is automatically done by oxford_asl unless we tell it otherwise). <span class="anchor" id="line-107"></span></li><li>A starting guess for the bolus arrival time - we will take the default of 0.7 s, we dont need to be very precise as the model-fitting should work this out for us. <span class="anchor" id="line-108"></span></li><li>Values of T1 and T1b for the field strength we used - data was aquired at 3T so use T1 of 1.3 s and T1b of 1.6 s. <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></li></ul><p class="line874">We have all the information we need so all we have to do is run this command (check you understand what each bit does): <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line867"><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><pre><span class="anchor" id="line-1-7"></span>oxford_asl -i data_pasl/diffdata --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_1 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --spatial</pre><span class="anchor" id="line-115"></span><p class="line862">Notice that we have turned off the estimation of the macrovascular component (<tt class="backtick">--artoff</tt>), we will come back to this. We are using the 'spatial' mode, which is recommened as it exploits the natural spatial smoothness of the estimated CBF image. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">In the results directory, <tt class="backtick">ex1_1</tt>, you will find a <tt class="backtick">native_space</tt> directory that contains all the estimated images at the same resolution as the original data. You should find in there (and look at using FSLview): <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><ul><li><p class="line891"><tt class="backtick">perfusion.nii.gz</tt> The estimated CBF image in the same (arbitrary) units as the original data. <span class="anchor" id="line-120"></span></li><li><p class="line891"><tt class="backtick">arrival.nii.gz</tt> The estimated bolus arrival time image (in seconds). <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></li></ul><p class="line874">Since we would like the estimated CBF in physiological units (ml/100g/min) we also need: <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><ul><li>Calibration data - we have aslcalib.nii.gz which was acquired using the same readout but no inversion and no background suppression. <span class="anchor" id="line-125"></span></li><li>A reference 'tissue' - in this case we are going to use CSF as our reference (yes it isn't actually a 'tissue'). <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></li></ul><p class="line867"><tt class="backtick">oxford_asl</tt> will, if given a structural image, try to automatically segment out the ventricles and use these as a CSF reference for calibration. We want a slightly quicker result, so there is a previously defined CSF mask, <tt class="backtick">csfmask.nii.gz</tt>, to use. In this case there was a difference in the gain of a factor of 10 used when acquiring the calibration data (no background suppression) and the main ASL data (with background suppression). <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line874">Run the command again but with the extra calibration information supplied: <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line867"><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><pre><span class="anchor" id="line-1-8"></span>oxford_asl -i data_pasl/diffdata --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_1 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --spatial -c pasl_data/aslcalib --csf pasl_data/csfmask --cgain 10</pre><span class="anchor" id="line-134"></span><p class="line862">You should now find in the results directory an extra image: <tt class="backtick">perfusion_calib.nii.gz</tt>, which is the estimated CBF image in ml/100g/min having used the separate calibration information. You should also find a <tt class="backtick">calib</tt> subdirectory that includes the results of the calibration process, the main one being <tt class="backtick">M0.txt</tt> that contains the estimated equilibrium magnetization of arterial blood (in scanner units). This M0 value was used to scale the perfusion image to get it into physiological units. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line867">
<h3 id="Exercise_1.2:_CBF_estimation_with_a_macro_vascular_component">Exercise 1.2: CBF estimation with a macro vascular component</h3>
<span class="anchor" id="line-137"></span><p class="line874">In the previous exercise we only fit a tissue based kinetic curve to the data. However, the data was not aquired with flow supression so there should be a substantial contirbution from ASL label still within larger vessels. What we should do, therefore, is to add a macro vascular component to account for this: <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line867"><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><pre><span class="anchor" id="line-1-9"></span>oxford_asl -i data_pasl/diffdata -c aslcalib --csf csfmask --tis 0.4,0.62,0.84,1.06,1.28,1.5,1.72,1.94,2.16,2.38 -o ex1_2 --bolus 1.1 --bat 0.7 --t1 1.3 --t1b 1.66 --spatial</pre><span class="anchor" id="line-142"></span><p class="line862">Notice that we have run exactly the same command as the previous exercise, we have just removed <tt class="backtick">--artoff</tt>. By default <tt class="backtick">oxford_asl</tt> always fits the macro vascualr component, even with flow suppression some arterial label can still be present. <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><p class="line862">In the results directory, <tt class="backtick">ex1_2</tt>, you will find the perfusion and arrival results again, along with an image called <tt class="backtick">aCBV.nii.gz</tt>, this is the estimated arterial cerebral blood volume image from the macro vascular component. Compare the images from this exercise with the previous one. Notice that the CBF is lower and arrival time is later where the magntiude of the aCBV image is large - around regions where large vessels would be expected. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><p class="line867">
<h2 id="DATASET_2:_pseudo_continuous_ASL">DATASET 2: pseudo continuous ASL</h2>
<span class="anchor" id="line-149"></span><p class="line874">This dataset is resting-state pcASL data collected using an EPI readout, TR/TE 3750/14 ms, 3.75x3.75x7.5mm, 24 slices using a matrix size 64x64. Alternating control and tag pairs were acquired after 1.4 s of labelling at 5 different post labelling delays (200, 400, 600, 800, 1000 ms), each one repeated 12 times. The data is in the directory pcasl_data <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line874">We are going to need to know what the inversion times were for each measurement. For pASL this was the time between labelling and readout. For cASL we need the time from the start of labelling to readout, so our TI = labelling duration + post labelling delay. Thus the TIs are: 1.6, 1.8, 2.0, 2.2, 2.4 s. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867">
<h3 id="Exercise_2.1:_Tag-control_subtraction">Exercise 2.1: Tag-control subtraction</h3>
<span class="anchor" id="line-154"></span><p class="line862">The first thing we need to do is take the raw ASL data and do tag-control subtraction to remove the static tissue contribution. We are also going to take the average of the multiple measurements at each TI to make the model-fitting faster (in practice would could skip this as <tt class="backtick">oxford_asl&nbsp;could&nbsp;do&nbsp;this&nbsp;for&nbsp;us</tt>). We could split the data into separate volumes and do subtraction and averaging of these images before re-assembling it all together, but that would be tedious! Instead we have a command that knows how to deal with ASL data, what we want to do is: <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><p class="line867"><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><pre><span class="anchor" id="line-1-10"></span>asl_file --data=data_pcasl/asl_raw_data --ntis=5 --ibf=rpt --iaf=tc --diff --mean=pcasl_diffdata</pre><span class="anchor" id="line-159"></span><p class="line862">The command tells <tt class="backtick">asl_file</tt>: <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><ul><li>Where to find the data. <span class="anchor" id="line-162"></span></li><li>How many TIs there are in the file. <span class="anchor" id="line-163"></span></li><li>That the data contains repeated measurements (where we have cycled through all the TIs each time). <span class="anchor" id="line-164"></span></li><li>That the data is in tag-control pairs. <span class="anchor" id="line-165"></span></li><li>That we want to do pairwise subtraction. <span class="anchor" id="line-166"></span></li><li><p class="line862">That it should take the mean of each TI and save that as the output file in the current directory: <tt class="backtick">pcasl_diffdata</tt>. <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span></li></ul><p class="line862">Have a look at the data (<tt class="backtick">pcasl_diffdata</tt>) in <tt class="backtick">FSLview</tt> as we did for the pASL data. This set will look a bit different as we only have 5 TIs and these are all placed so that they will be near the peak of the kinetic curve. So we dont see the nice clear wash in of the label as we did before. <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line867">
<h3 id="Exercise_2.2:_CBF_estimation">Exercise 2.2: CBF estimation</h3>
<span class="anchor" id="line-171"></span><p class="line874">We will do CBF estimation in a very similar way to the pASL data. However, this time we will: <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><ul><li><p class="line862">Use a cASL model with the <tt class="backtick">--casl</tt> option. <span class="anchor" id="line-174"></span></li><li><p class="line862">Set the bolus duration to 1.4 s - the length of labeling. Since the cASL label is well defined we wont try to estimate its duration, so we add the <tt class="backtick">--fixbolus</tt> option. <span class="anchor" id="line-175"></span></li><li><p class="line862">Supply a structural image, which means that <tt class="backtick">oxford_asl</tt> will try to register the ASL data to the structural image and give the CBF results in the same space at the structural. By default <tt class="backtick">oxford_asl</tt> will try to register the estimated CBF image to the structural, this can be problematic as there may not be excellent contrast for this. The raw ASL data is a much better basis for registration so we will instruct <tt class="backtick">oxford_asl</tt> to use this with the <tt class="backtick">--regfrom</tt> commmand. <span class="anchor" id="line-176"></span></li><li><p class="line862">Not supply a CSF mask. We will let <tt class="backtick">oxford_asl</tt> automatically identify the CSF using the structural image. <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></li></ul><p class="line874">Firstly we do a little pre-processing of the supporting images - mainly brain extraction <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line867"><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><pre><span class="anchor" id="line-1-11"></span>bet data_pcasl/struc struc_brain
<span class="anchor" id="line-2-2"></span>fslmaths data_pcasl/asl_raw_data -Tmean asl_raw
<span class="anchor" id="line-3-1"></span>bet asl_raw asl_raw_brain</pre><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><p class="line874">The full command we need is (again see if you can identify what each term does): <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><p class="line867"><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><pre><span class="anchor" id="line-1-12"></span>oxford_asl -i pcasl_diffdata -c data_pcasl/calibration_head --tis 1.6,1.8,2.0,2.2,2.4 -o ex2_2 --bolus 1.4 --bat 0.7 --t1 1.3 --t1b 1.66 --artoff --fixbolus --spatial --casl -s struc_brain --regfrom asl_raw_brain</pre><span class="anchor" id="line-192"></span><p class="line862">In the results directory, <tt class="backtick">ex2_2</tt>, you will find a <tt class="backtick">native_space</tt> set of results, but also the same results at the resolution of the structural image (<tt class="backtick">struct_space</tt>). As with the pASL results there are perfusion and bolus arrival time images. Since we only have 5 tightly spaced TIs we wont expect our arrival time images to be as good. You will also notice from the arrival time image that the mask generated by oxford_asl wasn't perfect - it includes all the brain, but some non brain too. We could have made our own mask and supplied it to oxford_asl with the <tt class="backtick">-m</tt> option if we had wanted to. It is also worth looking at <tt class="backtick">ex2_2/calib/refmask.nii.gz</tt> as this is the mask that was used to indentify the CSF in the calibration image, you should check that it looks like voxels within the ventricles have been indentified. <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line874">When we analysed the pASL data we also added a macro vascular component into the model. However, we wont do that here since all the TIs we have come quite late and we are likely to have missed most of the early arriving arterial based label. <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><p class="line867">
<h2 id="DATASET_3:_QUASAR">DATASET 3: QUASAR</h2>
<span class="anchor" id="line-199"></span><p class="line862">The QUASAR variant of ASL makes use of a combination of flow suppressed and non suppressed multi-TI data to allow for a better separation of the tissue and macro vascular signals. This aids model-based analysis and also permits 'model-free' analysis similar to that used in DSC-MRI. QUASAR data also has all the information within it to do the calibration step. Because the QUASAR sequence is well defined we dont have to worry about all the options in <tt class="backtick">oxford_asl</tt>, in fact there is a special version specifcally desgined for QUASAR data called <tt class="backtick">quasil</tt>. Again just trying the command brings up the usage - there are not many options this time! <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><p class="line867">
<h3 id="Exercise_3.1:_Model-based_analysis">Exercise 3.1: Model-based analysis</h3>
<span class="anchor" id="line-202"></span><p class="line874">Firstly we are going to do a model-based analysis, just like we did in exercise 2, but tailored for QUASAR data. The command we want is: <span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line867"><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><pre><span class="anchor" id="line-1-13"></span>quasil -i data_quasar/data -o ex3_1</pre><span class="anchor" id="line-207"></span><p class="line874">In the results directory, ex3_1, you should find perfusion and aCBV images to examine. <span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line867">
<h3 id="Exercise_3.2:_Model-free_analysis">Exercise 3.2: Model-free analysis</h3>
<span class="anchor" id="line-210"></span><p class="line862">Now we are going to compare the model-based results with numerical deconvolution (this is the method proposed in Petersen's original paper). <tt class="backtick">quasil</tt> will also do this using the <tt class="backtick">--mfree</tt> option: <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><p class="line867"><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><pre><span class="anchor" id="line-1-14"></span>quasil -i data_quasar/data -o ex3_2 --mfree</pre><span class="anchor" id="line-215"></span><p class="line874">Like the model-based analysis both perfusion and aCBV images are produced. Compare the model-based and model-free results, you should find that the model-free perfusion values are generally lower than the model-based results, primiarly due to the underestimation of the numerical deconvolution. <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line867">
<h1 id="Acknowledgments">Acknowledgments</h1>
<span class="anchor" id="line-220"></span><p class="line862">Thanks are due to Tom Okell, Brad <a class="nonexistent" href="./MacIntosh.html">MacIntosh</a>, Dan Gallichan, Michael Kelly, Esben Petersen and Xavier Golay for the provision of the ASL data used in these exercises. <span class="anchor" id="line-221"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:23
</body>
</html>
