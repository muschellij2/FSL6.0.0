<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>FslInstallation</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">FslInstallation</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li>Introduction<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Availability_of_FSL">Availability of FSL</a></li><li>
<a href="#Installing_FSL">Installing FSL</a></li><li>
<a href="#Patching_FSL">Patching FSL</a></li><li>
<a href="#Running_FSL">Running FSL</a><ol><li>
<a href="#Shell_setup">Shell setup</a></li><li>
<a href="#Starting_the_programs">Starting the programs</a></li></ol></li><li>
<a href="#Customising">Customising</a></li><li>
<a href="#Using_FSL_with_a_GridEngine_.28or_similar.29_computing_cluster">Using FSL with a GridEngine (or similar) computing cluster</a><ol><li>
<a href="#Cluster_aware_tools">Cluster aware tools</a></li><li>
<a href="#Running_bedpostX_on_a_GPU_or_GPU_cluster">Running bedpostX on a GPU or GPU cluster</a></li></ol></li></ol></div></div></li><li><a href="./FslInstallation(2f)MacOsX.html">Mac Os X</a></li><li><a href="./FslInstallation(2f)Linux.html">Linux</a></li><li><a href="./FslInstallation(2f)Windows.html">Windows</a></li><li><a href="./FslInstallation(2f)SourceCode.html">Source Code</a></li><li><a href="./FslInstallation(2f)ShellSetup.html">Shell Setup</a></li><li><a href="./FslInstallation(2f)Faq.html">FAQ</a></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h1 id="Availability_of_FSL">Availability of FSL</h1>
<span class="anchor" id="line-4"></span><p class="line874">FSL is available ready to run for Mac OS X and Linux (Centos or Debian/Ubuntu) - with Windows computers being supported with a Linux Virtual Machine. We also provide source code if you run an OS not directly supported by us. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h1 id="Installing_FSL">Installing FSL</h1>
<span class="anchor" id="line-7"></span><p class="line874">We strongly recommend that the FSL software is downloaded and installed using our new install script available from the link below: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><ul><li><p class="line891"><a class="http" href="http://fsl.fmrib.ox.ac.uk/fsldownloads">Download FSL</a> <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span></li></ul><p class="line862">Once you have downloaded the installer, <em>fslinstaller.py</em>, you can use it to install FSL on your computer by following these instructions: <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><ul><li><p class="line891"><a href="./FslInstallation(2f)MacOsX.html">Mac OS X</a> <span class="anchor" id="line-14"></span></li><li><p class="line891"><a href="./FslInstallation(2f)Linux.html">Linux</a> <span class="anchor" id="line-15"></span></li><li><p class="line891"><a href="./FslInstallation(2f)Windows.html">Windows</a> <span class="anchor" id="line-16"></span></li><li><p class="line891"><a href="./FslInstallation(2f)SourceCode.html">Source Compilation</a> <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span></li></ul><p class="line867">
<h1 id="Patching_FSL">Patching FSL</h1>
<span class="anchor" id="line-19"></span><p class="line874">After you have installed FSL for the first time, you can follow these instructions to apply upgrades/patches (e.g. from version 5.0.0 to 5.0.1): <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><ul><li><p class="line891"><a href="./FslInstallation(2f)Patches.html">Patches</a> <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-24"></span>
<h1 id="Running_FSL">Running FSL</h1>
<span class="anchor" id="line-25"></span><p class="line867">
<h2 id="Shell_setup">Shell setup</h2>
<span class="anchor" id="line-26"></span><p class="line862">The <a href="./FslInstallation(2f)FslInstaller.html">FSL Install script</a> will setup your computer such that you can run the FSL tools from a terminal. See our <a href="./FslInstallation(2f)ShellSetup.html">shell setup guide</a> for details on what this script does. On Linux computers it can also be used to configure FSL for all users on the computer. <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line867">
<h2 id="Starting_the_programs">Starting the programs</h2>
<span class="anchor" id="line-29"></span><p class="line862">Once your account is configured for FSL use, you can run the FSL tools from the command line; the tools are stored in <tt class="backtick">$FSLDIR/bin</tt> and this location will have been added to your terminal's search locations for ease of use. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">In general, command-line programs are lower case (e.g. <tt class="backtick">bet</tt>), with the GUI version capitalised (e.g. <tt class="backtick">Bet</tt>), except on Mac OS X, where you need to append <tt class="backtick">_gui</tt> because it can't tell the difference between upper and lower case filenames (e.g. <tt class="backtick">Bet_gui</tt>). <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">To bring up a simple GUI which is just a menu of the main individual FSL GUI tools, just type <tt class="backtick">fsl</tt>. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-36"></span>
<h1 id="Customising">Customising</h1>
<span class="anchor" id="line-37"></span><p class="line862">There are several options you can set to change the way FSL behaves. These options are set using <a class="http" href="http://en.wikipedia.org/wiki/Environment_variable">environment variables</a>, see our page on <a href="./FslEnvironmentVariables.html">FSL environment variables</a> for details on what can be configured, or look in the files <tt class="backtick">${FSLDIR}/etc/fslconf/fsl.sh</tt> (if you use BASH/DASH) or <tt class="backtick">${FSLDIR}/etc/fslconf/fsl.csh</tt> (if you use CSH/TCSH)(<a href="./WhatShellAmIRunning.html">what shell am I using?</a>). <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line862">When the shell <a href="./FslInstallation(2f)ShellSetup.html">setup commands</a> are sourced, default settings are applied. You can override these defaults by creating a folder <tt class="backtick">.fslconf</tt> in your home folder and creating a file <tt class="backtick">fsl.sh</tt> (BASH users) or <tt class="backtick">fsl.csh</tt> (TCSH users) within it. This file should contain new definitions for any settings you wish to change. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line874">For example, to change the output file format of the FSL tools to NIFTI pairs, do the following: <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><ol type="1"><li>Create the configuration folder <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-1-1"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a032b57523e1360b5544be0df3120f880b48d133" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span>mkdir ~/.fslconf</span>
<span class="line"><span class="anchor" id="line-2-1"></span><span class="ResWord">cd</span> ~/.fslconf</span>
</pre></div></div><span class="anchor" id="line-48"></span></li><li><p class="line862">Create the <tt class="backtick">fsl.sh</tt> (or <tt class="backtick">fsl.csh</tt>) file with the <tt class="backtick">FSLOUTPUTTYPE</tt> environment variable set to <tt class="backtick">NIFTI_PAIR</tt> For BASH users: <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-1-3"></span><div class="highlight bash"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-955c762a6fea0dc6417e6063ff801c8a2e07bbf3" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="ResWord">echo</span> <span class="String">&quot;FSLOUTPUTTYPE=NIFTI_PAIR&quot;</span> &gt; fsl.sh</span>
<span class="line"><span class="anchor" id="line-2-2"></span><span class="ResWord">echo</span> <span class="String">&quot;export FSLOUTPUTTYPE&quot;</span> &gt;&gt; fsl.sh</span>
</pre></div></div><span class="anchor" id="line-53"></span>For TCSH users: <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-1-5"></span><div class="highlight tcsh"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-66a06aa4d897eafdced33d436363e9b7eb0e3e22" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span><span class="ResWord">echo</span> <span class="String">&quot;setenv FSL_OUTPUTTYPE NIFTI_PAIR&quot;</span> &gt; fsl.csh</span>
</pre></div></div><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span></li></ol><p class="line862">Alternatively, if the <tt class="backtick">fsl.sh</tt> file already exists you can edit it with the text editor of your choice. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867"><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><div class="warning"><span class="anchor" id="line-1-7"></span><p class="line867"><strong>DO NOT copy the centrally installed files into ~/.fslconf</strong> <span class="anchor" id="line-2-3"></span><span class="anchor" id="line-3-1"></span><p class="line862">If you copy the <tt class="backtick">${FSLDIR}/etc/fslconf/fsl.sh</tt> or <tt class="backtick">${FSLDIR}/etc/fslconf/fsl.sh</tt> into <tt class="backtick">~/.fslconf</tt> you will cause a loop that will stop you from being able to log in! </div><span class="anchor" id="line-65"></span><p class="line862">We recommend that you only change the FSL settings that differ from the defaults in your <tt class="backtick">~/.fslconf/fsl.sh</tt> (or <tt class="backtick">fsl.csh</tt>) and nothing else. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line862">If you wish to change the settings for all users you can create the file <tt class="backtick">/etc/fslconf/fsl.sh</tt> (or <tt class="backtick">/etc/fslconf/fsl.csh</tt>) on a machine by machine basis. Where you wish to store the settings centrally, we also check the file <tt class="backtick">/usr/local/etc/fslconf/fsl.sh</tt> (or <tt class="backtick">fsl.csh</tt> equivalent) so you could perhaps NFS mount this folder. <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line867">
<h1 id="Using_FSL_with_a_GridEngine_.28or_similar.29_computing_cluster">Using FSL with a GridEngine (or similar) computing cluster</h1>
<span class="anchor" id="line-70"></span><p class="line862">Several of the more compute-intensive tools can take advantage of cluster computing, via <a class="https" href="https://arc.liv.ac.uk/trac/SGE">Son of Grid Engine</a> or <a class="http" href="http://gridscheduler.sourceforge.net/">http://gridscheduler.sourceforge.net/</a>| Open Grid Scheduler]] (both forks of Sun Grid Engine). We would largely recommend using Son of Grid Engine if you are building a cluster from scratch on a Centos system as they provide RPMs to ease installation. Debian/Ubuntu users should look to install the <a class="http" href="http://packages.ubuntu.com/source/oneiric/gridengine">gridengine</a> package. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-73"></span>
<h2 id="Cluster_aware_tools">Cluster aware tools</h2>
<span class="anchor" id="line-74"></span><ul><li><p class="line891"><a href="./FEAT.html">FEAT</a> will run multiple first-level analyses in parallel if they are setup all together in one GUI setup. At second level, if full FLAME (stages 1+2) is selected then all the slices are processed in parallel. <span class="anchor" id="line-75"></span></li><li><p class="line891"><a href="./MELODIC.html">MELODIC</a> will run multiple single-session analyses (or single-session preprocessing if a multi-session/subject analysis is being done) in parallel if they are setup all together in one GUI setup. <span class="anchor" id="line-76"></span></li><li><p class="line891"><a href="./TBSS.html">TBSS</a> will run all registrations in parallel. <span class="anchor" id="line-77"></span></li><li><p class="line891"><a href="./FDT.html">BEDPOSTX</a> (FDT) low-level diffusion processing will run all slices in parallel. <span class="anchor" id="line-78"></span></li><li><p class="line891"><a href="./FSLVBM.html">FSLVBM</a> will run all registrations in parallel, both at the template-creation stage and at the final registrations stage. <span class="anchor" id="line-79"></span></li><li><p class="line891"><a href="./POSSUM.html">POSSUM</a> will process all slices in parallel. <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></li></ul><p class="line862">All the above tools interact with a compute cluster via a single central script <tt class="backtick">fsl_sub</tt>; if no cluster is available then this script silently runs all the requested jobs in series. To customise FSL for your local compute cluster and clustering software, simply edit <tt class="backtick">${FSLDIR}/bin/fsl_sub</tt> - hopefully the comments in this file are sufficient to make this fairly painless, particularly for labs using a GE variant. For clustering software other than GE, note that <tt class="backtick">fsl_sub</tt> makes use of a GE feature allowing the submission of a text file containing a list of commands (one per line) to be run in parallel. <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-84"></span>
<h2 id="Running_bedpostX_on_a_GPU_or_GPU_cluster">Running bedpostX on a GPU or GPU cluster</h2>
<span class="anchor" id="line-85"></span><p class="line874">We now have a CUDA implementation of bedpostX which gives 100x speedup on a single GPU compared to a single CPU core. Running the CUDA version of bedpostX requires some special settings as explained below. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><ul><li>Requirements: <span class="anchor" id="line-88"></span><ul><li>Linux CentOS 6 or CentOS 6.5 <span class="anchor" id="line-89"></span></li><li>NVIDIA GPU with compute capability 2.0 or superior <span class="anchor" id="line-90"></span></li><li>(FSL version 5.0.6 and CUDA Toolkit 5.0) or (FSL version 5.0.7/5.0.8 and CUDA Toolkit 5.5) or (FSL version 5.0.9 and CUDA Toolkit 6.5) <span class="anchor" id="line-91"></span></li><li>SGE for multi-GPU (or optionally SGE for single-GPU) <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span></li></ul></li><li class="gap">Running: <span class="anchor" id="line-94"></span><ul><li><p class="line862">Without SGE (single GPU):  Simply run <tt class="backtick">bedpostx_gpu&nbsp;&lt;dataDirectory&gt;&nbsp;[options]</tt> <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span></li><li class="gap">With SGE: <span class="anchor" id="line-97"></span><ul><li><p class="line862">The environment variable <tt class="backtick">SGE_ROOT</tt> must be set <span class="anchor" id="line-98"></span></li><li><p class="line862">In addition, the variable <tt class="backtick">FSLGECUDAQ</tt> must be set with the name of your GPUs queue (which may have 1 or several GPUs) <span class="anchor" id="line-99"></span></li><li><p class="line862">Simply run bedpostx using the usual call: <tt class="backtick">bedpostx&nbsp;&lt;dataDirectory&gt;&nbsp;[options]</tt> <span class="anchor" id="line-100"></span></li><li><p class="line862">By default, bedpostx will divide the dataset into 4 parts submitted as 4 different jobs. Therefore, if there are 4 GPUs (4 slots in the CUDA queue), they can be processed in parallel. In order to use a different number of parts, use the <tt class="backtick">-NJOBS</tt> option. For instance, for using 8 GPUs, run as follows: <tt class="backtick">bedpostx&nbsp;&lt;dataDirectory&gt;&nbsp;-NJOBS&nbsp;8&nbsp;[options]</tt> <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span></li></ul></li></ul></li><li class="gap">Please reference the following paper when using the GPU version of bedpostx: <span class="anchor" id="line-103"></span><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/23658616">[Hernandez 2013</a>] Hernandez M, Guerrero GD, Cecilia JM, Garcia JM, Inuggi A, Jbabdi S, Behrens TEJ, Sotiropoulos SN, (2013) Accelerating Fibre Orientation Estimation from Diffusion Weighted Magnetic Resonance Imaging Using GPUs. PLoS ONE 8(4):e61892 <span class="anchor" id="line-104"></span></li></ul></ul><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
