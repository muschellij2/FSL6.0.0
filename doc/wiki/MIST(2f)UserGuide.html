<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>MIST/UserGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">MIST/UserGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><div class="caution"><span class="anchor" id="line-1-1"></span><p class="line867"><strong>BETA RELEASE</strong> <span class="anchor" id="line-2-1"></span><span class="anchor" id="line-3-1"></span><p class="line874">MIST is currently considered to be in testing, meaning that you will need to inspect its output a bit more carefully to see if you are happy with it. The current release segments a limited number of structures. The full set of structures that FIRST segments, as well as the brainstem nuclei described in [2], will be supported in an upcoming release. </div><span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line867">
<h1 id="Running_MIST">Running MIST</h1>
<span class="anchor" id="line-11"></span><p class="line874">Running MIST is a two-stage process: In the first step, the method is trained to learn about the appearance of a structure in your particular set of images and in the second step, the trained model is used to segment your images. No manual segmentations are required for the training stage. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">The current <strong>beta</strong> release supports these structures: <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><ul><li>Putamen <span class="anchor" id="line-16"></span></li><li>Globus pallidus <span class="anchor" id="line-17"></span></li><li>Caudate nucleus (including nucleus accumbens) <span class="anchor" id="line-18"></span></li><li>Thalamus <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span></li></ul><p class="line867">
<h1 id="Prerequisites">Prerequisites</h1>
<span class="anchor" id="line-21"></span><p class="line874">The distributed version of MIST is set up to work with the following types of images: <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><ul><li><p class="line891"><strong>T1-weighted</strong>. This type of image is <strong>required</strong>, as this is what the initial registration to standard space is based on. <span class="anchor" id="line-24"></span></li><li><p class="line891"><strong>T2-weighted</strong>. This includes T2*-weighted and fluid attenuated (FLAIR) scans. <span class="anchor" id="line-25"></span></li><li><p class="line891"><strong>Fractional anisotropy</strong> (FA). <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></li></ul><p class="line862">MIST assumes that these volumes have been registered, so you will need to do this using FLIRT before running the training stage. To register FA volumes to a T1-weighted volume, you can use <tt>mist_FA_reg</tt>. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line867">
<h1 id="Training">Training</h1>
<span class="anchor" id="line-30"></span><p class="line862">Prior to running the training stage, you will need to tell MIST about the types of images that you have. This is done using a text file called <tt>mist_config</tt>, which specifies for each modality: <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><ol type="1"><li>An arbitrary name for the modality (e.g. ‘T1’, ‘FLAIR’ or ‘Follow-up T1’). This name should be 'T1' for the volume that is to be used for standard space registration. <span class="anchor" id="line-33"></span></li><li>The type of the modality: One of T1, T2 or FA (see above). <span class="anchor" id="line-34"></span></li><li>The filename relative to the subject directory. <span class="anchor" id="line-35"></span></li><li>The original resolution of the scan. This cannot be determined from the input images as these will in general already have been resampled. This is a scalar value, so for anisotropic scans you will need to approximate this – a rough approximation is fine. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span></li></ol><p class="line862">An example <tt>mist_filenames</tt> file might read: <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><pre><span class="anchor" id="line-1"></span>”T1”,”T1”,”structural”,1.0
<span class="anchor" id="line-2"></span>”FLAIR”,”T2”,”FLAIR”,1.5
<span class="anchor" id="line-3"></span>”T2*”,”T2”,”FLASH”,1.0</pre><span class="anchor" id="line-44"></span><p class="line862">This specifies that for each subject, MIST can expect to find a T1-weighted scan called <tt>structural.nii.gz</tt> and two ’T2-weighted’ scans called <tt>FLAIR.nii.gz</tt> and <tt>FLASH.nii.gz</tt>. The automatic configuration can handle the contrast differences between the two 'T2' scans. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line862">A second configuration file called <tt>mist_subjects</tt> tells MIST the names of the subject folders that contain these images, for example: <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line867"><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><pre><span class="anchor" id="line-1-1"></span>/home/xyz/study/subject001
<span class="anchor" id="line-2-1"></span>/home/xyz/study/subject002
<span class="anchor" id="line-3-1"></span>...</pre><span class="anchor" id="line-53"></span><p class="line862">In this example both the <tt>mist_filenames</tt> and <tt>mist_subjects</tt> files would be located in <tt>/home/xyz/study</tt>. If you have many subjects, you can use a subset for training by creating an optional similar file called <tt>mist_training_subjects</tt> – this should contain a representative subset of the directories that are to be used for training. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line867"><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><div class="tip"><span class="anchor" id="line-1-2"></span><p class="line874">There are no hard rules for the number of training subjects required. For studies with fewer than 50 subjects, we we would normally recommend using all data for training. With more than 100, improvements will most likely be minimal and taking a subset is recommended to reduce runtime. </div><span class="anchor" id="line-58"></span><p class="line874">As a final check, your files should now be organised in the following way (for this example): <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867"><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><pre><span class="anchor" id="line-1-2"></span>/home/xyz/study/mist_filenames
<span class="anchor" id="line-2-2"></span>/home/xyz/study/mist_subjects
<span class="anchor" id="line-3-2"></span>/home/xyz/study/subject001/structural.nii.gz
<span class="anchor" id="line-4"></span>/home/xyz/study/subject001/FLAIR.nii.gz
<span class="anchor" id="line-5"></span>/home/xyz/study/subject001/FLASH.nii.gz
<span class="anchor" id="line-6"></span>/home/xyz/study/subject002/structural.nii.gz
<span class="anchor" id="line-7"></span>/home/xyz/study/subject002/FLAIR.nii.gz
<span class="anchor" id="line-8"></span>/home/xyz/study/subject002/FLASH.nii.gz
<span class="anchor" id="line-9"></span>...</pre><span class="anchor" id="line-71"></span><p class="line862">You are now ready to run training. This is done by running <tt>mist_1_train</tt> from within the <tt>/home/xyz/study</tt> directory. Note that this may take a long time if <tt>fsl_sub</tt> cannot submit to a cluster (hours to days, depending on image resolution and the number of training subjects). <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867"><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><div class="tip"><span class="anchor" id="line-1-3"></span><p class="line862">There is no requirement for the <tt class="backtick">mist_filenames</tt> and <tt class="backtick">mist_subjects</tt> files to be located within the directory structure containing the data. When using another location, <tt class="backtick">cd</tt> into that directory and call <tt class="backtick">mist_1_train</tt> from there. In this case, it is important that the paths in <tt class="backtick">mist_subjects</tt> are absolute or relative to this directory. </div><span class="anchor" id="line-76"></span><p class="line867"><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><div class="tip"><span class="anchor" id="line-1-4"></span><p class="line862">If you are only interested in a single structure (or a subset of structures), you can speed up training by specifying any of <tt class="backtick">putamen</tt>, <tt class="backtick">pallidum</tt>, <tt class="backtick">caudate_accumbens</tt> and <tt class="backtick">thalamus</tt> on the commmand line. For example, to only train the putamen and thalamus models, run <span class="anchor" id="line-2-2"></span><span class="anchor" id="line-3-2"></span><p class="line867"><tt class="backtick">mist_1_train&nbsp;putamen&nbsp;thalamus</tt> </div><span class="anchor" id="line-81"></span><p class="line867">
<h1 id="Segmenting_images">Segmenting images</h1>
<span class="anchor" id="line-82"></span><p class="line862">When training is complete, the <tt>mist_out</tt> folder should contain a number of files called <tt>mist_autosetup_&lt;structure&gt;.txt</tt>. To use these to segment your images, run <tt>mist_2_fit</tt> from the top-level directory for your study (e.g. <tt>/home/xyz/study</tt>). <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line874">When the segmentation step is finished, each of your subject folders should contain the following files for each structure (among other output files): <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><ul><li><p class="line891"><tt>mist_autosetup_&lt;structure&gt;_mask.nii.gz</tt>. The final segmentation as a voxel-based mask. <span class="anchor" id="line-87"></span></li><li><p class="line891"><tt>mist_autosetup_&lt;structure&gt;_shape.vtk</tt>. A mesh representing the final segmentation. This can be used for shape analysis (see below). <span class="anchor" id="line-88"></span></li><li><p class="line891"><tt>mist_autosetup_&lt;structure&gt;_shape_reg.vtk</tt>. The same mesh after affine registration to MNI coordinates. This can also be used for shape analysis. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span></li></ul><p class="line862">In addition, the file <tt>mist_nonoverlapping.nii.gz</tt> contains the segmentations of all structures in a single 3D volume. Voxels in which segmentations overlap have been assigned to the structure for which they were most interior in this file. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line867">
<h1 id="Volume_statistics">Volume statistics</h1>
<span class="anchor" id="line-93"></span><p class="line874">The volume of a mesh can be found using: <span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line867"><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><pre><span class="anchor" id="line-1-3"></span>mist_mesh_utils volume &lt;subject&gt;/mist_autosetup_&lt;structure&gt;_shape.vtk</pre><span class="anchor" id="line-98"></span><p class="line874">The obtained volumes can be analysed using any standard statistics package. You may want to take head size into account in your analysis. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867">
<h1 id="Shape_statistics">Shape statistics</h1>
<span class="anchor" id="line-101"></span><p class="line862">After running <tt>mist_2_fit</tt>, these files will have been created in the <tt>mist_out</tt> directory for each structure: <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><ul><li><p class="line891"><tt>&lt;structure&gt;_distances_native.csv</tt>. A table containing the distances of the original (native-space) segmentations to the reference mesh after rigid body registration. These distances include brain size related scaling; you may want to account for these in your analysis. <span class="anchor" id="line-104"></span></li><li><p class="line891"><tt>&lt;structure&gt;_distances_mni.csv</tt>. A similar table obtained by first applying the affine transformation to MNI space and then doing a 3 DOF (translation only) registration. This table does not include brain size-related scaling, as such scaling will have been accounted for by the affine transformation. <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li></ul><p class="line862">These tables can be used to perform shape analysis using <a href="./PALM.html">PALM</a>. To perform inference using 2D TFCE, use the options -T -tfce2D and specify the appropriate reference mesh using the -s option (use the <tt class="backtick">.gii</tt> file). For example, use the commands <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line867"><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><pre><span class="anchor" id="line-1-4"></span>design_ttest2 design 20 20
<span class="anchor" id="line-2-3"></span>palm -i left_putamen_distances_mni.csv -s $FSLDIR/data/meshes/left_putamen.gii -d design.mat -t design.com -T -tfce2D -o palm_left_putamen</pre><span class="anchor" id="line-112"></span><p class="line862">to do an unpaired t-test with 20 subjects in each group. See <a href="./GLM.html">GLM</a> for more information on how to set up your statistical model. <span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><p class="line867">
<h1 id="Visualisation">Visualisation</h1>
<span class="anchor" id="line-115"></span><p class="line874">A simple 3D visualisation of results can be obtained using a command such as <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line867"><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><pre><span class="anchor" id="line-1-5"></span>mist_display pvals $FSLDIR/data/meshes/left_putamen.gii palm_left_putamen_tfce_tstat_fwep_c1.csv palm_left_putamen_tfce_tstat_fwep_c2.csv</pre><span class="anchor" id="line-120"></span><p class="line862">where the first contrast is a positive effect and the second contrast the corresponding negative effect. Thresholding is fixed at <em>p</em>=0.05 for a single contrast or <em>p</em>=0.025 for two contrasts (i.e. a two-sided test). You can use the mouse to rotate and zoom. <span class="anchor" id="line-121"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
