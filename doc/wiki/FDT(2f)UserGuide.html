<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>FDT/UserGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">FDT/UserGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./FDT.html">Introduction</a></li><li>User Guide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Processing_pipeline">Processing pipeline</a></li><li>
<a href="#Eddy_Current_Correction">Eddy Current Correction</a></li><li>
<a href="#Registration_within_FDT">Registration within FDT</a></li><li>
<a href="#DTIFIT">DTIFIT</a></li><li>
<a href="#BEDPOSTX">BEDPOSTX</a></li><li>
<a href="#PROBTRACKX_-_probabilistic_tracking_with_crossing_fibres">PROBTRACKX - probabilistic tracking with crossing fibres</a><ol><li>
<a href="#Overview">Overview</a></li><li>
<a href="#Seed_specification">Seed specification</a><ol><li>
<a href="#Single_voxel">Single voxel</a></li><li>
<a href="#Single_mask">Single mask</a></li><li>
<a href="#Multiple_masks">Multiple masks</a></li></ol></li><li>
<a href="#Including_targets_for_tractography_-_rationale">Including targets for tractography - rationale</a><ol><li>
<a href="#Waypoint_masks">Waypoint masks</a></li><li>
<a href="#Exclusion_mask">Exclusion mask</a></li><li>
<a href="#Termination_mask">Termination mask</a></li><li>
<a href="#Classification_targets">Classification targets</a></li></ol></li><li>
<a href="#Options_Tab">Options Tab</a></li></ol></li><li>
<a href="#Using_surfaces">Using surfaces</a><ol><li>
<a href="#Switching_conventions">Switching conventions</a></li><li>
<a href="#Projecting_data_onto_the_surface">Projecting data onto the surface</a></li><li>
<a href="#Using_FreeSurfer_surfaces">Using FreeSurfer surfaces</a><ol><li>
<a href="#FreeSurfer_Registration">FreeSurfer Registration</a></li><li>
<a href="#Label_files">Label files</a></li></ol></li></ol></li><li>
<a href="#Utilities">Utilities</a><ol><li>
<a href="#proj_thresh">proj_thresh</a></li><li>
<a href="#find_the_biggest">find_the_biggest</a></li><li>
<a href="#vecreg_-_Registration_of_vector_images">vecreg - Registration of vector images</a></li><li>
<a href="#qboot_-_Estimation_of_fibre_orientations_using_q-ball_ODFs_and_residual_bootstrap">qboot - Estimation of fibre orientations using q-ball ODFs and residual bootstrap</a></li></ol></li><li>
<a href="#Fslview">Fslview</a><ol><li>
<a href="#Displaying_DWI_images_in_fslview">Displaying DWI images in fslview</a></li></ol></li></ol></div></div></li><li><a href="./FDT(2f)FAQ.html">FAQ</a></li></ol></div> <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867">
<h1 id="Processing_pipeline">Processing pipeline</h1>
<span class="anchor" id="line-5"></span><p class="line862">To call the FDT GUI, either run <tt class="backtick">Fdt</tt> (<tt class="backtick">Fdt_gui</tt> on a Mac), or run <tt class="backtick">fsl</tt> and press the <strong>FDT</strong> button. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">A typical processing pipeline (and approximate time required for each stage, based on an Intel 2.66GHz processor, and a 60-direction whole brain dataset of dimensions 128x128x70, at 2 mm isotropic resolution) would consist of: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><ol type="1"><li>Any study or scanner-specific pre-processing (e.g., conversion from DICOM to NIFTI, removal of images affected by large artifacts). This would be done manually by the user. <span class="anchor" id="line-10"></span></li><li><p class="line862">Brain extraction using <a href="./BET.html">BET</a>. <span class="anchor" id="line-11"></span></li><li><p class="line891"><tt class="backtick">dtifit</tt> - Preliminary data check: view the principal eigenvector (V1) to check the vectors are correctly oriented with respect to the anatomy.  If there is a problem then the <tt class="backtick">bvecs</tt> need to be modified (change signs and/or permute order of components) in order to get the V1 vectors correctly oriented (repeat <tt class="backtick">dtifit</tt> after modifying <tt class="backtick">bvecs</tt> and view V1 vectors again until they are correct) before proceeding with any further processing. (~1 minute) <span class="anchor" id="line-12"></span></li><li><p class="line862">Susceptibility-induced distortion correction (fieldmap estimation) using <a href="./topup.html">topup</a>. <span class="anchor" id="line-13"></span></li><li><p class="line862">Distortion correction using <a href="./eddy.html">eddy</a>. <tt class="backtick">eddy</tt> simultaneously corrects for eddy currents and subject motion. It can also use a fieldmap estimated by <tt class="backtick">topup</tt> and correct for susceptibility-induced distortions. Slice-wise outlier detection and replacement is also possible and recommended. <span class="anchor" id="line-14"></span></li><li><p class="line891"><tt class="backtick">dtifit</tt> - Revised fitting of diffusion tensors on eddy-corrected data (~1 minute) <span class="anchor" id="line-15"></span></li><li><p class="line891"><tt class="backtick">bedpostx</tt> - Fitting of the probabilistic diffusion model on corrected data (~15 hours single-threaded on CPU or less if multi-threaded or ~30 minutes run on GPU) <span class="anchor" id="line-16"></span></li><li>registration - (3-6 minutes) <span class="anchor" id="line-17"></span></li><li><p class="line891"><tt class="backtick">probtrackx</tt> - Probabilistic tractography run on the output of bedpostx (execution time depends very much on what the user wishes to do. Generating a connectivity distribution from a single voxel of interest takes about 1 second) <span class="anchor" id="line-18"></span></li><li><p class="line862">Further post-processing of <tt class="backtick">probtrackx</tt> outputs can be carried out if required using the command-line utilities <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span></li></ol><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-21"></span><span class="anchor" id="EddyCurrentCorrection"></span> <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h1 id="Eddy_Current_Correction">Eddy Current Correction</h1>
<span class="anchor" id="line-24"></span><p class="line874">Eddy currents in the gradient coils induce (approximate) stretches and shears in the diffusion weighted images. These distortions are different for different gradient directions. Eddy Current Correction corrects for these distortions, and for head motion. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867"><a href="./eddy.html">EDDY</a> offers a state of the art method for correcting eddy current distortions and subject motion. It can also use a fieldmap (estimated by <tt class="backtick">topup</tt>) to consider and correct susceptibility-induced distortions. It also allows detection of outliers, datapoints that have been corrupted by motion-induced signal dropout. Finally, it permits replacement of the outliers with distortion-free data. We refer the user to the detailed documentation page of <a href="./eddy.html">eddy</a> for further details. <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line862">Note: The old <tt class="backtick">eddy_correct</tt> tool has now been superceded by <tt class="backtick">eddy</tt> that offers substantially better distortion correction. <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-31"></span><span class="anchor" id="Registration"></span> <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line867">
<h1 id="Registration_within_FDT">Registration within FDT</h1>
<span class="anchor" id="line-34"></span><p class="line874">If tractography results are to be stored in any space other than diffusion space then registration must be run. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line862">Registration within FDT uses <a href="./FLIRT.html">FLIRT</a>, but there is also an option for using <a href="./FNIRT.html">FNIRT</a> nonlinear registration to standard space. When using the GUI, registration can only be applied after <tt class="backtick">bedpostx</tt> has been run. Typically, registration will be run between three spaces: <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><ul><li><p class="line862">Diffusion space (using the <tt class="backtick">nodif_brain</tt> image in the bedpostX directory.) <span class="anchor" id="line-39"></span></li><li>Structural space (using a structural image, e.g., the space of a high resolution T1-weighted image of the same subject) <span class="anchor" id="line-40"></span></li><li><p class="line862">Standard space (by default, the MNI152 brain stored within <tt class="backtick">$FSLDIR/data/standard</tt>) <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></li></ul><p class="line862">Note that the structural (T1-weighted) image must have had <a href="./BET.html">BET</a> applied. The nodif_brain image should be the brain extracted version of the <tt class="backtick">nodif&nbsp;image</tt> that is stored in the bedpostX directory. Create this image using <tt class="backtick">fslroi</tt> then <tt class="backtick">bet</tt> on the data if it does not already exist. (it is important that the user checks the quality of bet results on these images and adjust the settings in bet where appropriate). <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line862">Transformation matrices, and their inverses, will be derived from diffusion to structural space and from structural to standard space. Relevant matrices will be concatenated to produce transformation matrices between diffusion and standard space. The resulting matrices are stored within the <tt class="backtick">xfms</tt> subdirectory of the bedpostX directory and named as follows: <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><ul><li>diff2str.mat - from diffusion to structural space <span class="anchor" id="line-47"></span></li><li>str2diff.mat - from structural to diffusion space <span class="anchor" id="line-48"></span></li><li>diff2standard.mat - from diffusion to standard space <span class="anchor" id="line-49"></span></li><li>standard2diff.mat - from standard to diffusion space <span class="anchor" id="line-50"></span></li><li>str2standard.mat - from structural to standard space <span class="anchor" id="line-51"></span></li><li>standard2str.mat - from standard to structural space <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span></li></ul><p class="line874">By default, transformation matrices between diffusion and structural space are derived using 6 degrees of freedom, the correlation ratio cost function and normal search; transformation matrices between structural and standard space are derived using 12 degrees of freedom, the correlation ratio cost function and normal search. These parameters may be adjusted if required using the drop down menus in the registration panel. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line862">In the GUI, it is possible to use nonlinear <a href="./FNIRT.html">FNIRT</a> registration between structural and standard space. In this case, the user needs to provide a non-brain-extracted structural image, as this will make <a href="./FNIRT.html">FNIRT</a> more accurate. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line862">Note that diffusion images will typically have geometric distortions due to the effect of field inhomogeneities that are not affecting the structural image. Therefore, an affine <a href="./FLIRT.html">FLIRT</a> registration to structural space may not be accurate enough. We recommend that the user corrects for these distortions either using fieldmap acquisitions or using the <a class="nonexistent" href="./TOPUP.html">TOPUP</a> tool. This must be done in the pre-processing and prior to registration. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-60"></span><span class="anchor" id="Dtifit"></span> <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867">
<h1 id="DTIFIT">DTIFIT</h1>
<span class="anchor" id="line-63"></span><p class="line867"><strong>DTIFIT</strong> fits a diffusion tensor model at each voxel. You would typically run <tt class="backtick">dtifit</tt> on data that has been pre-processed and eddy current corrected. Note that <tt class="backtick">dtifit</tt> is not necessary in order to use the probabilistic tractography (which depends on the output of BEDPOSTX, not DTIFIT). <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line862">In the FDT GUI, use the top left drop down menu to select <strong>DTIFIT</strong>. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867"><strong>Input</strong>: You can specify an input directory containing all the required files with standardized filenames, or alternatively you can specify input files manually by turning on the <strong>specify input files manually</strong> switch. If an input directory is specified then all files must be named as shown in parentheses below. If input files are specified manually they can have any filename. Required files are: <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><ul><li>Diffusion weighted data (data): A 4D series of data volumes. This will include diffusion-weighted volumes and volume(s) with no diffusion weighting. <span class="anchor" id="line-70"></span></li><li><p class="line891"><a href="./BET.html">BET</a> binary brain mask (nodif_brain_mask): A single binarised volume in diffusion space containing ones inside the brain and zeroes outside the brain. <span class="anchor" id="line-71"></span></li><li><p class="line862">Output basename: User specifies a basename that will be used to name the outputs of dtifit. If the directory input option is used then the basename will be <tt class="backtick">dti</tt>. <span class="anchor" id="line-72"></span></li><li>Gradient directions (bvecs): An ASCII text file containing a list of gradient directions applied during diffusion weighted volumes. The order of entries in this file must match the order of volumes in the input data series. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></li></ul><p class="line874">The format is <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867"><tt class="backtick">x_1&nbsp;x_2&nbsp;x_3&nbsp;...&nbsp;x_n</tt><br>
 <tt class="backtick">y_1&nbsp;y_2&nbsp;y_3&nbsp;...&nbsp;y_n</tt><br>
 <tt class="backtick">z_1&nbsp;z_2&nbsp;z_3&nbsp;...&nbsp;z_n</tt><br>
 <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line862">Vectors are normalised to unit length within the dtifit code. For volumes in which there was no diffusion weighting, the entry should still be present, although the direction of the vector does not matter!  For technical details see this <a href="./FDT(2f)FAQ.html#What_conventions_do_the_bvecs_use.3F">FAQ</a> entry. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><ul><li>b values (bvals): An ASCII text file containing a list of b values applied during each volume acquisition. The b values are assumed to be in s/mm^2 units. The order of entries in this file must match the order of volumes in the input data and entries in the gradient directions text file. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span></li></ul><p class="line874">The format is <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line867"><tt class="backtick">b_1&nbsp;b_2&nbsp;b_3&nbsp;...&nbsp;b_n</tt> <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line867"><strong>Advanced options</strong> In addition to the required input above, the user can choose to apply a <tt class="backtick">weighted&nbsp;least-squares</tt> regression instead of the default standard linear regression. The user can also choose to save the tensor elements and/or the sum of squared error. This last output can be useful for detecting artefacts. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line867"><strong>Outputs of dtifit</strong> <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><ul><li><p class="line891"><tt class="backtick">&lt;basename&gt;_V1</tt> - 1st eigenvector <span class="anchor" id="line-91"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_V2</tt> - 2nd eigenvector <span class="anchor" id="line-92"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_V3</tt> - 3rd eigenvector <span class="anchor" id="line-93"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_L1</tt> - 1st eigenvalue <span class="anchor" id="line-94"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_L2</tt> - 2nd eigenvalue <span class="anchor" id="line-95"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_L3</tt> - 3rd eigenvalue <span class="anchor" id="line-96"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_MD</tt> - mean diffusivity <span class="anchor" id="line-97"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_FA</tt> - fractional anisotropy <span class="anchor" id="line-98"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_MO</tt> - mode of the anisotropy (oblate ~ -1; isotropic ~ 0; prolate ~ 1) <span class="anchor" id="line-99"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_S0</tt> - raw T2 signal with no diffusion weighting <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span></li></ul><p class="line867"><strong>optional output</strong> <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><ul><li><p class="line891"><tt class="backtick">&lt;basename&gt;_sse</tt> - Sum of squared error <span class="anchor" id="line-104"></span></li><li><p class="line891"><tt class="backtick">&lt;basename&gt;_tensor</tt> - tensor as a 4D file in this order: Dxx,Dxy,Dxz,Dyy,Dyz,Dzz <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li></ul><div><table><tbody><tr>  <td><p class="line862"> <img alt="fdt_lines_subs.gif" class="attachment" height="205" src="attachments/FDT(2f)UserGuide/fdt_lines_subs.gif" title="fdt_lines_subs.gif" /> </td>
  <td><p class="line862"> <img align="left" alt="fdt_rgb_subs.gif" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_rgb_subs.gif" title="fdt_rgb_subs.gif" /> </td>
  <td><p class="line862"> <img alt="fdt_l1.gif" class="attachment" height="205" src="attachments/FDT(2f)UserGuide/fdt_l1.gif" title="fdt_l1.gif" /> </td>
  <td><p class="line862"> <img alt="fdt_fa.gif" class="attachment" height="205" src="attachments/FDT(2f)UserGuide/fdt_fa.gif" title="fdt_fa.gif" /> </td>
</tr>
<tr>  <td><span class="anchor" id="line-107"></span><p class="line862">V1 Lines </td>
  <td><p class="line862">V1 RGB </td>
  <td><p class="line862">L1 </td>
  <td><p class="line862">FA </td>
</tr>
</tbody></table></div><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line867"><strong>command line utility</strong> <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line867"><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><pre><span class="anchor" id="line-1"></span>dtifit
<span class="anchor" id="line-2"></span>
<span class="anchor" id="line-3"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-4"></span>        -k,--data       dti data file
<span class="anchor" id="line-5"></span>        -o,--out        Output basename
<span class="anchor" id="line-6"></span>        -m,--mask       Bet binary mask file
<span class="anchor" id="line-7"></span>        -r,--bvecs      b vectors file
<span class="anchor" id="line-8"></span>        -b,--bvals      b values file
<span class="anchor" id="line-9"></span>
<span class="anchor" id="line-10"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-11"></span>        -V,--verbose    switch on diagnostic messages
<span class="anchor" id="line-12"></span>        -h,--help       display this message
<span class="anchor" id="line-13"></span>        --cni           Input confound regressors
<span class="anchor" id="line-14"></span>        --sse           Output sum of squared errors
<span class="anchor" id="line-15"></span>        -w,--wls        Fit the tensor with weighted least squares
<span class="anchor" id="line-16"></span>        --littlebit     Only process small area of brain
<span class="anchor" id="line-17"></span>        --save_tensor   Save the elements of the tensor
<span class="anchor" id="line-18"></span>        -z,--zmin       min z
<span class="anchor" id="line-19"></span>        -Z,--zmax       max z
<span class="anchor" id="line-20"></span>        -y,--ymin       min y
<span class="anchor" id="line-21"></span>        -Y,--ymax       max y
<span class="anchor" id="line-22"></span>        -x,--xmin       min x
<span class="anchor" id="line-23"></span>        -X,--xmax       max x</pre><span class="anchor" id="line-137"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-138"></span><span class="anchor" id="Bedpostx"></span> <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line867">
<h1 id="BEDPOSTX">BEDPOSTX</h1>
<span class="anchor" id="line-141"></span><p class="line867"><img align="right" alt="fdt_bedpostx2.gif" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_bedpostx2.gif" title="fdt_bedpostx2.gif" width="350" /> BEDPOSTX stands for Bayesian Estimation of Diffusion Parameters Obtained using Sampling Techniques. The X stands for modelling Crossing Fibres. <tt class="backtick">bedpostx</tt> runs Markov Chain Monte Carlo sampling to build up distributions on diffusion parameters at each voxel. It creates all the files necessary for running probabilistic tractography. For an overview of the modelling carried out within <tt class="backtick">bedpostx</tt> see this <a class="http" href="http://www.fmrib.ox.ac.uk/analysis/techrep/tr03tb1/tr03tb1/index.html">technical report</a>. <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line867"><tt class="backtick">bedpostx</tt> allows to model crossing fibres within each voxel of the brain. Crucially, <tt class="backtick">bedpostx</tt> allows to automatically determine the number of crossing fibres per voxel. For details on the model used in this case, see <a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/17070705">Behrens et al, NeuroImage 2007</a>. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867"><tt class="backtick">bedpostx</tt> takes about 15 hours to run but will automatically batch if run on an SGE-capable system. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">Note that <tt class="backtick">bedpostx</tt> is a wrapper script for a command-line tool called <tt class="backtick">xfibres</tt>. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line862">In the FDT GUI, use the top left drop down menu to select <strong>BEDPOSTX</strong>. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line867"><strong>Input directory</strong>: Use the browse button to select an input directory. That directory must contain the following files: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><ul><li><p class="line891"><strong>data</strong>: A 4D series of data volumes. This will include diffusion-weighted volumes and volume(s) with no  diffusion weighting. <span class="anchor" id="line-154"></span></li><li><p class="line862">nodif_brain_mask: 3D binary brain mask volume derived from running <a href="./BET.html">bet</a> on nodif (i.e. on a volume with no diffusion weighting). <span class="anchor" id="line-155"></span></li><li><p class="line862">bvecs (<strong>with no file extension</strong>): An ASCII text file containing a list of gradient directions applied during diffusion weighted volumes. The order of entries in this file must match the order of volumes in <strong>data</strong>. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span></li></ul><p class="line874">The format is <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><p class="line867"><tt class="backtick">x_1&nbsp;x_2&nbsp;x_3&nbsp;...&nbsp;x_n</tt><br>
 <tt class="backtick">y_1&nbsp;y_2&nbsp;y_3&nbsp;...&nbsp;y_n</tt><br>
 <tt class="backtick">z_1&nbsp;z_2&nbsp;z_3&nbsp;...&nbsp;z_n</tt><br>
 <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line862">Vectors are normalised to unit length within the <tt class="backtick">bedpostx</tt> code. For volumes in which there was no diffusion weighting, the entry should still be present, although the direction of the vector does not matter!   Run <tt class="backtick">dtifit</tt> and view the principal vectors to check if you have the bvecs correct. For technical details about the bvecs see this <a href="./FDT(2f)FAQ.html#What_conventions_do_the_bvecs_use.3F">FAQ</a> entry. <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><ul><li><p class="line862">bvals (<strong>with no file extension</strong>): An ASCII text file containing a list of bvalues applied during each volume acquisition. The order of entries in this file must match the order of volumes in the input data and entries in the gradient directions text file. <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span></li></ul><p class="line874">The format is <span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><p class="line867"><tt class="backtick">b_1&nbsp;b_2&nbsp;b_3&nbsp;...&nbsp;b_n</tt> <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line862">The order of <strong>bvals</strong> must match the order of <strong>data</strong>. <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line867"><strong>Tip: Run <tt class="backtick">bedpostx_datacheck</tt> in command line to check if your input directory contains the correct files required for <tt class="backtick">bedpostx</tt>. </strong> <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line867"><strong>Outputs of BEDPOSTX</strong> <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line867"><tt class="backtick">bedpostx</tt> creates a new directory at the same level as the input directory called &lt;indir&gt;.bedpostX which contains all the files you need for probabilistic tractography. Highlights are (&lt;i&gt; indicates the i-th fibre. It ranges from 1 to the maximum number of fibres set in the advanced options.): <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><ul><li><p class="line891"><tt class="backtick">merged_th&lt;i&gt;samples</tt> - 4D volume - Samples from the distribution on theta <span class="anchor" id="line-178"></span></li><li><p class="line891"><tt class="backtick">merged_ph&lt;i&gt;samples</tt> - 4D volume - Samples from the distribution on phi <span class="anchor" id="line-179"></span><ul><li><p class="line862">theta and phi together represent the principal diffusion direction in <a class="attachment" href="attachments/FDT(2f)UserGuide/fdt_spherical_polars.gif" title="spherical polar co-ordinates">spherical polar co-ordinates</a> <span class="anchor" id="line-180"></span></li></ul></li><li><p class="line891"><tt class="backtick">merged_f&lt;i&gt;samples</tt> - 4D volume - Samples from the distribution on anisotropic volume fraction (see <a class="http" href="http://www.fmrib.ox.ac.uk/analysis/techrep/tr03tb1/tr03tb1/">technical report</a>). <span class="anchor" id="line-181"></span></li><li><p class="line891"><tt class="backtick">mean_th&lt;i&gt;samples</tt> - 3D Volume - Mean of distribution on theta <span class="anchor" id="line-182"></span></li><li><p class="line891"><tt class="backtick">mean_ph&lt;i&gt;samples</tt> - 3D Volume - Mean of distribution on phi <span class="anchor" id="line-183"></span></li><li><p class="line891"><tt class="backtick">mean_f&lt;i&gt;samples</tt> - 3D Volume - Mean of distribution on f anisotropy <span class="anchor" id="line-184"></span><ul><li>Note that in each voxel, fibres are ordered according to a decreasing mean f-value <span class="anchor" id="line-185"></span></li></ul></li><li><p class="line891"><tt class="backtick">mean_dsamples</tt> - 3D Volume - Mean of distribution on diffusivity d <span class="anchor" id="line-186"></span></li><li><p class="line891"><tt class="backtick">mean_S0samples</tt> - 3D Volume - Mean of distribution on T2w baseline signal intensity S0 <span class="anchor" id="line-187"></span></li><li><p class="line891"><tt class="backtick">dyads&lt;i&gt;</tt> - Mean of PDD distribution in vector form. Note that this file can be loaded into fslview for easy <a href="./FDT(2f)UserGuide.html#Fslview">viewing of diffusion directions</a> <span class="anchor" id="line-188"></span></li><li><p class="line891"><tt class="backtick">dyads&lt;i&gt;_dispersion</tt> - 3D Volume - Uncertainty on the estimated fibre orientation. Characterizes how wide the orientation distribution is around the respective PDD.(<a class="attachment" href="attachments/FDT(2f)UserGuide/dyads.jpg" title="how is this calculated?">how is this calculated?</a>) <span class="anchor" id="line-189"></span></li><li><p class="line891"><tt class="backtick">nodif_brain_mask</tt> - binary mask created from nodif_brain - copied from input directory <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></li></ul><p class="line867"><strong>Advanced Options</strong> <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line862">You may change some options before running <tt class="backtick">bedpostx</tt>, depending on the questions you want to ask or the quality of your diffusion data. The default values of these parameters are the ones used in the corresponding paper (<a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/17070705">Behrens et al, NeuroImage 2007</a>). <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><ul><li>Fibres: Number of fibres modelled per voxel. <span class="anchor" id="line-196"></span></li><li>Weight: Multiplicative factor for the prior on the additional modelled fibres. A smaller factor means more weighting for the additional fibres. <span class="anchor" id="line-197"></span></li><li>Burnin: Number of iterations before starting the sampling. These might be increased if the data are noisy, and the MCMC needs more iterations to converge. <span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span></li></ul><p class="line874">Additionally, the following alternative models are available in the advanced options: <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><ul><li><p class="line862">Multi-Shell Model : Use this option if the data contain more than one non-zero bvalue. This will use the model described in <a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/22334356">Jbabdi et al. MRM 2012</a>, where the diffusion coefficient is modelled using a Gamma distribution. This option will output the posterior mean of a diffusivity variance parameter <tt class="backtick">mean_d_stdsamples</tt>. Command line argument: <tt class="backtick">--model=2</tt>. <span class="anchor" id="line-202"></span></li><li><p class="line862">Noise Floor Model : Use this option if (part of) the data is operating close to the noise floor. This will fit one extra parameter f0 that captures the noise floor. This is also described in <a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/22334356">Jbabdi et al. MRM 2012</a>. This option will output the posterior mean of the noise floor parameter <tt class="backtick">mean_f0samples</tt>. Command line argument: <tt class="backtick">--f0&nbsp;--ardf0</tt>. <span class="anchor" id="line-203"></span></li><li><p class="line862">Rician Noise      : Use this option to replace the default Gaussian noise assumption with Rician noise. This will output the posterior mean of a noise precision (i.e. inverse of variance) parameter <tt class="backtick">mean_tausamples</tt>. Command line argument: <tt class="backtick">--rician</tt>. <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span></li></ul><p class="line867"><strong>Command line utility</strong> <span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><p class="line867"><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><pre><span class="anchor" id="line-1-1"></span>Usage: bedpostx &lt;subject directory&gt; [options]
<span class="anchor" id="line-2-1"></span>
<span class="anchor" id="line-3-1"></span> expects to find bvals and bvecs in subject directory
<span class="anchor" id="line-4-1"></span> expects to find data and nodif_brain_mask in subject directory
<span class="anchor" id="line-5-1"></span>
<span class="anchor" id="line-6-1"></span> options (old syntax)
<span class="anchor" id="line-7-1"></span>
<span class="anchor" id="line-8-1"></span>  -n (number of fibres per voxel, default 2)
<span class="anchor" id="line-9-1"></span>  -w (ARD weight, more weight means less secondary fibres per voxel, default 1)
<span class="anchor" id="line-10-1"></span>  -b (burnin period, default 1000)
<span class="anchor" id="line-11-1"></span>  -j (number of jumps, default 1250)
<span class="anchor" id="line-12-1"></span>  -s (sample every, default 25)
<span class="anchor" id="line-13-1"></span>  -model (1 for monoexponential, 2 for multiexponential, default 1)
<span class="anchor" id="line-14-1"></span>
<span class="anchor" id="line-15-1"></span> ALTERNATIVELY: you can pass on xfibres options directly to bedpostx
<span class="anchor" id="line-16-1"></span>  For example:  bedpostx &lt;subject directory&gt; --noard --cnonlinear
<span class="anchor" id="line-17-1"></span>  Type 'xfibres --help' for a list of available options
<span class="anchor" id="line-18-1"></span>  Default options will be bedpostx default (see above), and not xfibres default.
<span class="anchor" id="line-19-1"></span>
<span class="anchor" id="line-20-1"></span> Note: Use EITHER old OR new syntax.</pre><span class="anchor" id="line-229"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-230"></span><span class="anchor" id="Probtrackx"></span> <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><p class="line867">
<h1 id="PROBTRACKX_-_probabilistic_tracking_with_crossing_fibres">PROBTRACKX - probabilistic tracking with crossing fibres</h1>
<span class="anchor" id="line-233"></span><p class="line862">For details about probabilistic tractography as implemented in FDT, see this <a class="http" href="http://www.fmrib.ox.ac.uk/analysis/techrep/tr03tb1/tr03tb1/">technical report</a>, and for details about crossing fibre modelling in FDT, see <a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/17070705">Behrens et al, NeuroImage 2007</a>. <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line862">After <tt class="backtick">bedpostx</tt> has been applied it is possible to run tractography analyses using <tt class="backtick">probtrackx</tt>. Briefly, <tt class="backtick">probtrackx</tt> repetitively samples from the distributions of voxel-wise principal diffusion directions, each time computing a streamline through these local samples to generate a <em>probabilistic streamline</em> or a <em>sample</em> from the distribution on the location of the true streamline. By taking many such samples FDT is able to build up the histogram of the posterior distribution on the streamline location or the <em>connectivity distribution</em>. <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><p class="line874">The following explains how to run probtrackx using the GUI. The command-line options (which are slightly more flexible than the GUI) can be obtained from a terminal window by running: <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line867"><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><pre><span class="anchor" id="line-1-2"></span>probtrackx2 --help</pre><span class="anchor" id="line-242"></span><p class="line874">Note that the GUI only runs the new version (probtrackx2). Users of the old version (probtrackx) can only run it from the command line. <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><p class="line874">PROBTRACKX GUI has two main sections: <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line867"><a href="./FDT(2f)UserGuide.html#Seed">Seed Space</a> <span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line867"><a href="./FDT(2f)UserGuide.html#Targets">Optional Targets</a> <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><p class="line874">PROBTRACKX requires the specification of a bedpostX directory. This directory must contain all the following images: <span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><ul><li><p class="line891"><tt class="backtick">merged_th&lt;i&gt;samples</tt> <span class="anchor" id="line-253"></span></li><li><p class="line891"><tt class="backtick">merged_ph&lt;i&gt;samples</tt> <span class="anchor" id="line-254"></span></li><li><p class="line891"><tt class="backtick">merged_f&lt;i&gt;samples</tt> <span class="anchor" id="line-255"></span></li><li><p class="line891"><tt class="backtick">nodif_brain_mask</tt> <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span></li></ul><p class="line862">As explained below, results from <tt class="backtick">probtrackx</tt> can be binned in any available space -e.g., diffusion space, structural space or standard space. Note, however, that tractography itself ALWAYS takes place in diffusion space - it is simply the results of <tt class="backtick">probtrackx</tt> that are stored in the required space. If <tt class="backtick">probtrackx</tt> results are to be stored in a space other than diffusion space then you will need transformations from this space back into the space of the diffusion data. <span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><p class="line862">You can use the <a href="./FDT(2f)UserGuide.html#Registration">FDT registration tab</a> to create the required transformations, which will all be stored in the <tt class="backtick">xfms</tt> subdirectory of the bedpostX directory. Probtrackx can take either linear (<a href="./FLIRT.html">FLIRT</a>) or nonlinear (<a href="./FNIRT.html">FNIRT</a>) transformations. In the latter case, both <em>forward</em> (diffusion to seed space) and <em>backward</em> (seed space to diffusion) transformations are needed. <span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><p class="line874">For example, for analyses in structural space: <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><ul><li><p class="line862">Linear: <tt class="backtick">xfms/str2diff.mat</tt> <span class="anchor" id="line-264"></span></li><li><p class="line862">Nonlinear: <tt class="backtick">xfms/str2diff_warp&nbsp;and&nbsp;xfms/diff2str_warp</tt> <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-267"></span>
<h2 id="Overview">Overview</h2>
<span class="anchor" id="line-268"></span><p class="line862">PROBTRACKX involves generating connectivity distributions from user-specified seed voxels or surface vertices (or both). The output will be a single image in the space of the specified seed like <a class="attachment" href="attachments/FDT(2f)UserGuide/fdt_simple_tract3.gif" title="this">this</a>. All brain voxels will have a value (though many of these will be zero) representing the connectivity value between that voxel and the seed voxel (i.e., the number of samples that pass through that voxel). Note that when connectivity distributions are generated from multiple seed points within a region of interest then the time required for the analysis to run will be approximately the number of seed points multiplied by the time taken to generate a distribution from a single point. <tt class="backtick">probtrackx</tt> also allows to specify targets for the tractography. These can either be inclusion/exclusion masks, or targets for seed classification based on connectivity. <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line867"><span class="anchor" id="Seed"></span> <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><p class="line867">
<h2 id="Seed_specification">Seed specification</h2>
<span class="anchor" id="line-273"></span><p class="line862">A common feature for all seed specification modes is the ability to provide the seed in another space than the diffusion space. If <strong>seed space is not diffusion</strong>, then check the corresponding button. Set the transformation matrix from seed space to diffusion space (or both forward and backward warpfields if using nonlinear registration). Note that, in all cases, the smaller the voxel size in your seed space image, the lower the resulting connectivity values will be to these voxels (This is intuitive - the smaller a voxel is, the less chance that the true streamline will pass through it). This highlights the problem with binning a continuous distribution into meaningless discrete bins. In order for the probability values to be truly meaningful, the discrete bins chosen should be anatomically meaningful, as is the case when using <a href="./FDT(2f)UserGuide.html#Targets">classification targets</a>. <span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><p class="line862">Seed can be specified either as a Single Voxel, a Single mask, or Multiple masks (see below for more details). When using masks, these can either be volume files or surface files (see below for supported surface formats). Check the <tt class="backtick">surface</tt> button if one or all of the masks are surfaces. When using surfaces, the user must set the surface coordinate convention and provide a surface reference volume. <span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><p class="line874">Streamlines are seeded from all non-zero voxels of the seed files, or all vertices of the surface files. In the case where the surface files contain numerical values associated with vertices, tractography is seeded from all non-zero vertices, unless all the numerical values are zero, in which case the whole surface is considered as an ROI. <span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><p class="line867">
<h3 id="Single_voxel">Single voxel</h3>
<span class="anchor" id="line-280"></span><p class="line874">Generates a connectivity distribution from a single, user-specified voxel. <span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><p class="line874">GUI Options: <span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><p class="line867"><strong>Seed reference image</strong> Use the browse button to locate a reference image (e.g., subject1.bedpostX/struct.nii.gz if seed space is structral space). <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867"><strong>Seeds</strong>: Enter the x,y,z co-ordinates of a single seed voxel. Use the buttons to the right to specify whether the coordinates are given in voxels or millimetres. <span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><p class="line867">
<h3 id="Single_mask">Single mask</h3>
<span class="anchor" id="line-289"></span><p class="line874">Generates a connectivity distribution from a user-specified region of interest. <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><p class="line862">GUI Options:  <strong>Seed image/surface</strong>: Use the browse button to locate the seed image/surface. Probabilistic tractography will be run from every point (voxel or vertex) with a value different than 0 in this mask. If a surface is used as an input, and if all vertices have zero scalar value, then all vertices of the surface will be seeded. <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><p class="line874">The output directory will contain: <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><ul><li><p class="line891"><tt class="backtick">probtrackx.log</tt> - a text record of the command that was run. <span class="anchor" id="line-296"></span></li><li><p class="line891"><tt class="backtick">fdt.log</tt> - a log of the setup of the FDT GUI when the analysis was run. To recover this GUI setup, type <tt class="backtick">Fdt&nbsp;fdt.log</tt> <span class="anchor" id="line-297"></span></li><li><p class="line891"><tt class="backtick">fdt_paths</tt> - a 3D image file containing the output connectivity distribution to the seed mask. <span class="anchor" id="line-298"></span></li><li><p class="line891"><tt class="backtick">waytotal</tt> - a text file containing a single number corresponding to the total number of generated tracts that have not been rejected by inclusion/exclusion mask criteria. <span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span></li></ul><p class="line867">
<h3 id="Multiple_masks">Multiple masks</h3>
<span class="anchor" id="line-301"></span><p class="line862">Generates a connectivity distribution between a group of seed masks. This option repeatedly samples tracts from every seed mask in a list, and retains only those tracts that pass through at least <strong>one of the other</strong> seed masks. The output is the sum of the connectivity distributions from each of the seed masks. <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line874">GUI Options: <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><p class="line867"><strong>Masks list</strong>: Use the add button to locate each seed mask. Seed masks should all be in the same space (e.g., diffusion, structural or standard space). Seed masks can be either image volumes or surfaces or both. When all masks are loaded you can press the save list button to save the list of masks as a text file. If you already have a text file list of required seed masks (including their path) then you can load it with the load list button. <span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><p class="line874">The output directory will contain: <span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><ul><li><p class="line891"><tt class="backtick">probtrackx.log</tt> - a text record of the command that was run. <span class="anchor" id="line-310"></span></li><li><p class="line891"><tt class="backtick">fdt.log</tt> - a log of the setup of the FDT GUI when the analysis was run. To recover this GUI setup, type <tt class="backtick">Fdt&nbsp;fdt.log</tt> <span class="anchor" id="line-311"></span></li><li><p class="line891"><tt class="backtick">fdt_paths</tt> - a 3D image file containing the output connectivity distribution. <span class="anchor" id="line-312"></span></li><li><p class="line891"><tt class="backtick">waytotal</tt> - a text file containing one number per seed mask (in the order that has been specified when listing them). These numbers correspond to the total number of generated tracts from each seed mask that have reached at least one of the other masks and have not been rejected by inclusion/exclusion mask criteria. <span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span></li></ul><p class="line867"><span class="anchor" id="Targets"></span> <span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><p class="line867">
<h2 id="Including_targets_for_tractography_-_rationale">Including targets for tractography - rationale</h2>
<span class="anchor" id="line-317"></span><p class="line867"><tt class="backtick">probtrackx</tt> allows you to include target masks for any tractography experiment. These masks can be image volumes and/or surfaces. When using surfaces, these should all be using the same convention (i.e. FreeSurfer/Caret/<a href="./FIRST.html">FIRST</a>/voxel - see below). <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line867"><strong>Very Important</strong>: Every target mask <strong>must be in the same space as the seed masks</strong> (or the <strong>reference image</strong> in the case of a single voxel mode). <span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><p class="line874">Targets can be waypoint masks (a.k.a. inclusion masks), for selecting only tracts passing through particular points in the brain; exclusion masks, for excluding tracts passing through parts of the brain; termination masks, for forcing tracts to stop whenever they reach a certain area; or classification target masks for connectivity-based seed classification. All these targets are optional. <span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><p class="line867">
<h3 id="Waypoint_masks">Waypoint masks</h3>
<span class="anchor" id="line-324"></span><p class="line862">Use inclusion masks in the tractography. If more than one mask is set, then by default probtrackx will perform an <tt class="backtick">AND</tt> operation. I.e. tracts that do not pass through ALL these masks will be discarded from the calculation of the connectivity distribution. You can set this to an <tt class="backtick">OR</tt> using the <tt class="backtick">Waypoint&nbsp;option</tt> drop down menu under the <tt class="backtick">Options</tt> tab. In this case, streamlines are only retained if they intersect at least one of the waypoint masks. <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><p class="line874">Use the add and remove buttons to make a list of waypoint masks. <span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><p class="line867">
<h3 id="Exclusion_mask">Exclusion mask</h3>
<span class="anchor" id="line-329"></span><p class="line862">If an <strong>exclusion mask</strong> is to be used then check the box and use the browse button to locate the mask file. Pathways will be discarded if they enter the exclusion mask. For example, an exclusion mask of the midline will remove pathways that cross into the other hemisphere. <span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><p class="line867">
<h3 id="Termination_mask">Termination mask</h3>
<span class="anchor" id="line-332"></span><p class="line862">If a <strong>termination mask</strong> is to be used then check the box and use the browse button to locate the mask file. Pathways will be terminated as soon as they enter the termination mask. The difference between an exclusion and a termination mask is that in the latter case, the tract is stopped at the target mask, but included in the calculation of the connectivity distribution, while in the former case, the tract is completely discarded. (Note that paths are always terminated when they reach the brain surface as defined by nodif_brain_mask) <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><p class="line867">
<h3 id="Classification_targets">Classification targets</h3>
<span class="anchor" id="line-335"></span><p class="line867"><img align="right" alt="quantitative targets" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_seeds2targets_quant_eg.gif" title="quantitative targets" width="152" /> When using classification targets, <tt class="backtick">probtrackx</tt> will quantify connectivity values between a seed mask and any number of user-specified target masks. This option is only active when the seed mask is a single mask. In the example on the right, seed voxels in the thalamus are classified according to the probability of connection to different cortical target masks. <span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><p class="line874">Use the add button to locate each target mask. Targets must be in the same space as the seed mask. When all targets are loaded you can press the save list button to save the list of targets as a text file. If you already have a text file list of required targets (including their path) then you can load it with the load list button. The output directory will contain a single volume for each target mask, named seeds_to_{target} where {target} is replaced by the file name of the relevant target mask. In these output images, the value of each voxel within the seed mask is the number of samples seeded from that voxel reaching the relevant target mask. The value of all voxels outside the seed mask will be zero. Note that the files seeds_to_{target} will have the same format (either volumes or surfaces) as the seed mask. <span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line867"><img align="right" alt="quantitative targets" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_seeds2targets_thal.gif" title="quantitative targets" width="304" /> <span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><p class="line874">There are command line utilities that can be run on these outputs: <span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><ul><li>proj_thresh - for thresholding some outputs of probtrackx <span class="anchor" id="line-344"></span></li><li>find_the_bigggest - for performing hard segmentation on the outputs of probtrackx, see example on the right <span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-347"></span>
<h2 id="Options_Tab">Options Tab</h2>
<span class="anchor" id="line-348"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-349"></span>Before running <tt class="backtick">probtrackx</tt>, the user is able to change the setting of certain parameters by clicking the <tt class="backtick">options</tt> tab. <span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><p class="line867"><strong>Basic Options</strong>: <span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><ul><li><p class="line891"><strong>Number of samples</strong> (default 5000): This determines the number of individual pathways (or samples) that are drawn through the probability distributions on principle fibre direction (see <a class="http" href="http://www.fmrib.ox.ac.uk/analysis/techrep/tr03tb1/tr03tb1/">appendix</a> for more details on the modelling and tractography methods). By default this is set to 5000 as we are confident that convergence is reached with this number of samples. However, reducing this number will speed up processing and can be useful for preliminary or exploratory analyses. <span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span></li><li class="gap"><p class="line891"><strong>Curvature Threshold</strong> (default 0.2): We limit how sharply pathways can turn in order to exclude implausible pathways. This number is the cosine of the minimum allowable angle between two steps. By default this is set to 0.2 (corresponding to a minimum angle of approximately ±80 degrees). Adjusting this number can enable pathways with sharper angles to be detected. <span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span></li><li class="gap"><p class="line891"><strong>Verbose</strong>: If this option is selected then FDT prints additional logging information to screen while it is running. <span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span></li><li class="gap"><p class="line891"><strong>Loopcheck</strong>: By default, we terminate pathways that loop back on themselves -i.e paths that travel to a point where they have already been. <span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span></li></ul><p class="line867"><strong>Advanced options</strong>: <span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><ul><li><p class="line891"><strong>Use modified Euler streamlining</strong>: Use modified Euler integration as opposed to simple Euler for computing probabilistic streamlines. More accurate but slower. <span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span></li><li class="gap"><p class="line891"><strong>Maximum number of steps</strong> (default 2000): By default, samples are terminated when they have travelled 2000 steps. Using a step length of 0.5mm this corresponds to a distance of 1m. These values can be adjusted if required. <span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span></li><li class="gap"><p class="line891"><strong>Step length</strong> (default 0.5mm): This determines the length of each step. This setting may be adjusted from default e.g., depending on the voxel size being used, or if tracking is being performed on different sized brains (e.g., infants or animals). <span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span></li><li class="gap"><p class="line891"><strong>Use anisotropy to constrain tracking</strong>: Use this option if you want the fractional anisotropic volumes (stored in merged_f&lt;i&gt;samples) to influence the tractography. The tracts stop if the anisotropy is lower than a random variable between 0 (low anisotropy) and 1 (high anisotropy). <span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span></li><li class="gap"><p class="line891"><strong>Use distance correction</strong>: This option corrects for the fact that connectivity distribution drops with distance from the seed mask. If this option is checked, the connectivity distribution is the expected length of the pathways that cross each voxel times the number of samples that cross it. <span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span></li><li class="gap"><p class="line891"><strong>Subsidiary fibre volume threshold</strong> (default=0.01): Threshold on the volume fraction of subsidiary fibres. Fibres with a lower volume fraction than this threshold (as given in the mean_f&lt;i&gt;samples file in the bedpostx directory) are discarded during tractography. <span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span></li><li class="gap"><p class="line891"><strong>Minimum length threshold</strong> (default=0): Discard streamlines that stop before reaching a length (in mm) bigger than this threshold. The default is to accept all lengths. <span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span></li><li class="gap"><p class="line891"><strong>Seed sphere sampling</strong> (default=0): When tracking from a volume-type seed, tracking is by default run from the centre of the voxels. Use this option to <tt class="backtick">jitter</tt> the starting point in a sphere of given radius (in mm). <span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span></li></ul><p class="line867"><strong>Waypoint options</strong> (only used if waypoint masks are set in the main tab): <span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><ul><li><p class="line891"><strong>Apply waypoint independently in both directions</strong>: Streamlines are run in both directions from the starting point. By default, the two halves are considered independently for the waypoint inclusion criterion. Untick this box if you want them to be considered together as one streamline. <span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span></li><li class="gap"><p class="line891"><strong>Force waypoint crossing in the listed order</strong>: Only accept streamlines that cross the waypoint mask in the order provided in the GUI. This is only used when the waypoint condition (below) is set to <tt class="backtick">AND</tt>. <span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span></li><li class="gap"><p class="line891"><strong>Waypoint condition</strong> (default=AND): By default, streamlines are only accepted if they intersect ALL waypoint masks. Change this to <tt class="backtick">OR</tt> and they will be accepted if they intersect at least one of the masks. <span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span></li></ul><p class="line867"><strong>Matrix Options</strong> The following set of options can be used to store a connectivity matrix between (1) all seed points and all other seed points, or (2) all seed points and all points in a target mask, or (3) all pairs of points in a target mask (or a pair of target masks).  All masks used here MUST BE IN SEED SPACE. These options can be used separately or in conjunction. <span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><p class="line874">Matrix1 and Matrix2 store the number of samples (potentially modulated by distance when distance correction is used) between the rows (seed points) and the columns of the matrix. <span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><p class="line874">Matrix3 stores the number of sample streamlines (potentially modulated by distance when distance correction is used) between each pair of points in a pair of target masks. In this case, when a streamline is sent from each seed point in both directions, if the streamline hits the two target masks at two locations along either sides of the streamline, the corresponding row and column of matrix3 is filled. <span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><p class="line874">Note on the ouput format: matrix1,2,3 are stored as 3 column ASCII coding of sparse matrices. These files can be loaded into matlab using e.g.: <span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><p class="line867"><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><pre><span class="anchor" id="line-1-3"></span>    x=load('fdt_matrix1.dot');
<span class="anchor" id="line-2-2"></span>    M=spconvert(x);</pre><span class="anchor" id="line-399"></span><div><table><tbody><tr>  <td><p class="line862"> <img alt="MatrixOptions.png" class="attachment" height="205" src="attachments/FDT(2f)UserGuide/MatrixOptions.png" title="MatrixOptions.png" /> </td>
</tr>
<tr>  <td><span class="anchor" id="line-400"></span><p class="line862">Summary of Matrix Options output </td>
</tr>
</tbody></table></div><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><p class="line867"><strong>Typical uses of Matrix options:</strong> <span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><ul><li>Matrix1:  The seed mask(s) can represent grey matter, so this would be all GM to GM connectivity. <span class="anchor" id="line-406"></span></li><li>Matrix2:  The seed can be a grey matter region, and mask2 the rest of the brain (can be low res). The results can then be used for blind classification of the seed mask. <span class="anchor" id="line-407"></span></li><li>Matrix3:  The 'target' masks can be the whole of grey matter, and the seed mask white matter. This option allows more sensitive reconstruction of grey-to-grey connectivity as pathways are seeded from all their constituting locations, rather than just their end-points as in Matrix1. <span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span></li></ul><p class="line867"><strong>Example use of Matrix2 for clustering:</strong> <span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><p class="line862">A typical use of Matrix2 is blind (i.e. hypothesis-free) classification. Say you have run probtrackx with a seed roi (e.g. thalamus) and the <tt class="backtick">--omatrix2</tt> option by setting the Matrix2 target mask to a whole brain mask (typically this mask would be lower resolution than the seed mask). The resulting Matrix2 can be used in Matlab to perform 'kmeans' classification. Below is an example Matlab code to do this (this example is only valid if the seed mask is a NIFTI volume, not a surface): <span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><p class="line867"><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><pre><span class="anchor" id="line-1-4"></span>   % Load Matrix2
<span class="anchor" id="line-2-3"></span>   x=load('fdt_matrix2.dot');
<span class="anchor" id="line-3-2"></span>   M=full(spconvert(x));
<span class="anchor" id="line-4-2"></span>   % Calculate cross-correlation
<span class="anchor" id="line-5-2"></span>   CC  = 1+corrcoef(M');
<span class="anchor" id="line-6-2"></span>   % Do kmeans with k clusters
<span class="anchor" id="line-7-2"></span>   idx = kmeans(CC,k);   % k is the number of clusters
<span class="anchor" id="line-8-2"></span>   % Load coordinate information to save results
<span class="anchor" id="line-9-2"></span>   addpath([getenv('FSLDIR') '/etc/matlab']);
<span class="anchor" id="line-10-2"></span>   [mask,~,scales] = read_avw('fdt_paths');
<span class="anchor" id="line-11-2"></span>   mask = 0*mask;
<span class="anchor" id="line-12-2"></span>   coord = load('coords_for_fdt_matrix2')+1;
<span class="anchor" id="line-13-2"></span>   ind   = sub2ind(size(mask),coord(:,1),coord(:,2),coord(:,3));
<span class="anchor" id="line-14-2"></span>   [~,~,j] = unique(idx);
<span class="anchor" id="line-15-2"></span>   mask(ind) = j;
<span class="anchor" id="line-16-2"></span>   save_avw(mask,'clusters','i',scales);
<span class="anchor" id="line-17-2"></span>   !fslcpgeom fdt_paths clusters</pre><span class="anchor" id="line-432"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-433"></span>
<h1 id="Using_surfaces">Using surfaces</h1>
<span class="anchor" id="line-434"></span><p class="line874">It is possible to use surface files in probtrackx. The preferred format is GIFTI. <span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><p class="line862">Surface files typically describe vertex coordinates in mm. Annoyingly, different softwares use different conventions to transform mm to voxel coordinates. Probtrackx can deal with the following conventions: <tt class="backtick">freesurfer</tt>, <tt class="backtick">caret</tt>, <tt class="backtick">first</tt> and <tt class="backtick">voxel</tt>. The latter convention simply means that mm and voxel coordinates are the same. <span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><p class="line867">
<h2 id="Switching_conventions">Switching conventions</h2>
<span class="anchor" id="line-439"></span><p class="line862">When using surfaces in probtrackx, all surfaces MUST use the same convention. However, we provide a command-line tool (<tt class="backtick">surf2surf</tt>) to transform between different conventions. This tool can also be used to convert between different surface file formats. <span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><p class="line867"><span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><pre><span class="anchor" id="line-1-5"></span>surf2surf - conversions between surface formats and/or conventions
<span class="anchor" id="line-2-4"></span>
<span class="anchor" id="line-3-3"></span>Usage:
<span class="anchor" id="line-4-3"></span>Usage: surf2surf -i &lt;inputSurface&gt; -o &lt;outputSurface&gt; [options]
<span class="anchor" id="line-5-3"></span>
<span class="anchor" id="line-6-3"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-7-3"></span>        -i,--surfin     input surface
<span class="anchor" id="line-8-3"></span>        -o,--surfout    output surface
<span class="anchor" id="line-9-3"></span>
<span class="anchor" id="line-10-3"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-11-3"></span>        --convin        input convention [default=caret] - only used if output convention is different
<span class="anchor" id="line-12-3"></span>        --convout       output convention [default=same as input]
<span class="anchor" id="line-13-3"></span>        --volin         input ref volume - Must set this if changing conventions
<span class="anchor" id="line-14-3"></span>        --volout        output ref volume [default=same as input]
<span class="anchor" id="line-15-3"></span>        --xfm           in-to-out ascii matrix or out-to-in warpfield [default=identity]
<span class="anchor" id="line-16-3"></span>        --outputtype    output type: ASCII, VTK, GIFTI_ASCII, GIFTI_BIN, GIFTI_BIN_GZ (default)</pre><span class="anchor" id="line-459"></span><p class="line867">
<h2 id="Projecting_data_onto_the_surface">Projecting data onto the surface</h2>
<span class="anchor" id="line-460"></span><p class="line862">It is often useful to project 3D data onto the cortical surface. We provide the following command-line tool (<tt class="backtick">surf_proj</tt>) to do exactly that: <span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><p class="line867"><span class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span><span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><pre><span class="anchor" id="line-1-6"></span>Usage: surf_proj [options]
<span class="anchor" id="line-2-5"></span>
<span class="anchor" id="line-3-4"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-4-4"></span>        --data  data to project onto surface
<span class="anchor" id="line-5-4"></span>        --surf  surface file
<span class="anchor" id="line-6-4"></span>        --out   output file
<span class="anchor" id="line-7-4"></span>
<span class="anchor" id="line-8-4"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-9-4"></span>        --meshref       surface volume ref (default=same as data)
<span class="anchor" id="line-10-4"></span>        --xfm   data2surf transform (default=Identity)
<span class="anchor" id="line-11-4"></span>        --meshspace     meshspace (default='caret')
<span class="anchor" id="line-12-4"></span>        --step  average over step (mm - default=1)
<span class="anchor" id="line-13-4"></span>        --direction     if&gt;0 goes towards brain (default=0 ie both directions)
<span class="anchor" id="line-14-4"></span>        --operation     what to do with values: 'mean' (default), 'max', 'median', 'last'
<span class="anchor" id="line-15-4"></span>        --surfout       output surface file, not ascii matrix (valid only for scalars)</pre><span class="anchor" id="line-479"></span><p class="line867">
<h2 id="Using_FreeSurfer_surfaces">Using FreeSurfer surfaces</h2>
<span class="anchor" id="line-480"></span><p class="line862">In order to use <a href="./FreeSurfer.html">FreeSurfer</a>-generated surfaces as masks in probtrackx, you need to add the following command line options (which can also be set in the GUI): <span class="anchor" id="line-481"></span><span class="anchor" id="line-482"></span><p class="line867"><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><pre><span class="anchor" id="line-1-7"></span>   --meshspace=freesurfer --seedref=orig.nii.gz</pre><span class="anchor" id="line-485"></span><p class="line862">Where the <tt class="backtick">orig.nii.gz</tt> file can be generated by converting the <tt class="backtick">orig.mgz</tt> file (found in the <a href="./FreeSurfer.html">FreeSurfer</a> output directories) using <a href="./FreeSurfer.html">FreeSurfer</a>'s <tt class="backtick">mri_convert</tt>. <span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><p class="line862">Additionally, using <a href="./FreeSurfer.html">FreeSurfer</a> with probtrackx requires a few specific steps that we describe below. <span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><p class="line867">
<h3 id="FreeSurfer_Registration">FreeSurfer Registration</h3>
<span class="anchor" id="line-490"></span><p class="line867"><a href="./FreeSurfer.html">FreeSurfer</a> operates in a <tt class="backtick">conformed</tt> space, which is different from the original structural image space that it has received as an input. When tracking from <a href="./FreeSurfer.html">FreeSurfer</a> surfaces, it is necessary to provide a transformation between conformed space and diffusion space. Below are a few steps that show how to achieve this. <span class="anchor" id="line-491"></span><span class="anchor" id="line-492"></span><p class="line862">We assume that you have ran dtifit on your diffusion data with an FA map called dti_FA.nii.gz (we recommend using an FA map to register to T1 structural images), and also that you have a file called struct.nii.gz that you have used as an input to <a href="./FreeSurfer.html">FreeSurfer</a> recon_all program. <span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span><p class="line862">We will carry on a few steps that aim at calculating the following transformations: fa&lt;-&gt;struct&lt;-&gt;freesurfer. Then we will concatenate these transformations to get fa&lt;-&gt;freesurfer. <span class="anchor" id="line-495"></span><span class="anchor" id="line-496"></span><p class="line862">Let us start with struct&lt;-&gt;freesufer (assuming <tt class="backtick">john</tt> is the subject's name): <span class="anchor" id="line-497"></span><span class="anchor" id="line-498"></span><p class="line867"><span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><pre><span class="anchor" id="line-1-8"></span>tkregister2 --mov $SUBJECTS_DIR/john/mri/orig.mgz --targ $SUBJECTS_DIR/john/mri/rawavg.mgz --regheader --reg junk --fslregout freesurfer2struct.mat --noedit
<span class="anchor" id="line-2-6"></span>convert_xfm -omat struct2freesurfer.mat -inverse freesurfer2struct.mat</pre><span class="anchor" id="line-502"></span><p class="line874">Now transforming FA to struct: <span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><p class="line867"><span class="anchor" id="line-505"></span><span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span><pre><span class="anchor" id="line-1-9"></span>flirt -in dti_FA -ref struct_brain -omat fa2struct.mat
<span class="anchor" id="line-2-7"></span>convert_xfm -omat struct2fa.mat -inverse fa2struct.mat</pre><span class="anchor" id="line-508"></span><p class="line874">The final stage is to concatenate these transformations: <span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span><p class="line867"><span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><pre><span class="anchor" id="line-1-10"></span>convert_xfm -omat fa2freesurfer.mat -concat struct2freesurfer.mat fa2struct.mat
<span class="anchor" id="line-2-8"></span>convert_xfm -omat freesurfer2fa.mat -inverse fa2freesurfer.mat</pre><span class="anchor" id="line-514"></span><p class="line867">
<h3 id="Label_files">Label files</h3>
<span class="anchor" id="line-515"></span><p class="line862">Label files from <a href="./FreeSurfer.html">FreeSurfer</a> are useful as cortical ROIs for tractography. In order to use a label file (or collection of labels) in probtrackx, you must first transform it (them) into a surface file, using the <tt class="backtick">label2surf</tt> command. <span class="anchor" id="line-516"></span><span class="anchor" id="line-517"></span><p class="line862">For instance, say you want to create a surface ROI for Brodmann areas 44 and 45. You must first decide which surface to use (pial, white) and which hemisphere (lh or rh). Say you want BA44/45 on the lh.white surface, then you must first transform the relevant surface file into an FSL-compatible format (ASCII or VTK or GIFTI), then use label2surf to transform the label files into a surface file. Below, the first command is a <a href="./FreeSurfer.html">FreeSurfer</a> command: <span class="anchor" id="line-518"></span><span class="anchor" id="line-519"></span><p class="line867"><span class="anchor" id="line-520"></span><span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span><span class="anchor" id="line-523"></span><pre><span class="anchor" id="line-1-11"></span>mris_convert lh.white lh.white.gii
<span class="anchor" id="line-2-9"></span>echo lh.BA44.label lh.BA45.label &gt; listOfAreas.txt
<span class="anchor" id="line-3-5"></span>label2surf -s lh.white.gii -o lh.BA44.gii -l listOfAreas.txt</pre><span class="anchor" id="line-524"></span><p class="line862">The full set of arguments for <tt class="backtick">label2surf</tt> is shown below: <span class="anchor" id="line-525"></span><span class="anchor" id="line-526"></span><p class="line867"><span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span><span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span><span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span><span class="anchor" id="line-534"></span><span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><pre><span class="anchor" id="line-1-12"></span>label2surf
<span class="anchor" id="line-2-10"></span>         Transforms a group of labels into a surface
<span class="anchor" id="line-3-6"></span>
<span class="anchor" id="line-4-5"></span>Usage:
<span class="anchor" id="line-5-5"></span>label2surf -s &lt;surface&gt; -o &lt;outputsurface&gt; -l &lt;labels&gt;
<span class="anchor" id="line-6-5"></span>
<span class="anchor" id="line-7-5"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-8-5"></span>        -s,--surf       input surface
<span class="anchor" id="line-9-5"></span>        -o,--out        output surface
<span class="anchor" id="line-10-5"></span>        -l,--labels     ascii list of label files
<span class="anchor" id="line-11-5"></span>
<span class="anchor" id="line-12-5"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-13-5"></span>        -v,--verbose    switch on diagnostic messages
<span class="anchor" id="line-14-5"></span>        -h,--help       display this message</pre><span class="anchor" id="line-542"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-543"></span>
<h1 id="Utilities">Utilities</h1>
<span class="anchor" id="line-544"></span><p class="line867">
<h2 id="proj_thresh">proj_thresh</h2>
<span class="anchor" id="line-545"></span><p class="line867"><tt class="backtick">proj_thresh</tt> is a command line utility that provides an alternative way of expressing connection probability in connectivity-based segmentation. It is run on the output of <a href="./FDT(2f)UserGuide.html#Probtrackx">probtrackx</a> when classification targets are used. <span class="anchor" id="line-546"></span><span class="anchor" id="line-547"></span><p class="line862">The output of <strong>Connectivity-based seed classification</strong> is a single volume for each target mask, named <tt class="backtick">seeds_to_{target}</tt> where {target} is replaced by the file name of the relevant target mask. In these output images, the value of each voxel within the seed mask is the number of samples seeded from that voxel reaching the target mask.  <tt class="backtick">proj_thresh</tt> is run as follows: <span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span><p class="line867"><span class="anchor" id="line-550"></span><span class="anchor" id="line-551"></span><pre><span class="anchor" id="line-1-13"></span>proj_thresh &lt;list of volumes/surfaces&gt; threshold</pre><span class="anchor" id="line-552"></span><p class="line862">Where the list of volumes is the outputs of <strong>Connectivity-based seed classification</strong> (i.e., files named seeds_to_target1 etc etc) and threshold is expressed as a number of samples  For each voxel in the seeds mask that has a value above threshold for at least one target mask, <tt class="backtick">proj_thresh</tt> calculates the number of samples reaching each target mask as a proportion of the total number of samples reaching any target mask. The output of <tt class="backtick">proj_thresh</tt> is a single volume for each target mask. <span class="anchor" id="line-553"></span><span class="anchor" id="line-554"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-555"></span>
<h2 id="find_the_biggest">find_the_biggest</h2>
<span class="anchor" id="line-556"></span><p class="line867"><tt class="backtick">find_the_biggest</tt> is a command line utility that performs hard segmentation of a seed region on the basis of outputs of <a href="./FDT(2f)UserGuide.html#Probtrackx">probtrackx</a> when <strong>classification targets</strong> are being used. <span class="anchor" id="line-557"></span><span class="anchor" id="line-558"></span><p class="line862">The output of <strong>Connectivity-based seed classification</strong> is a single volume for each target mask, named <tt class="backtick">seeds_to_{target}</tt> where {target} is replaced by the file name of the relevant target mask. In these output images, the value of each voxel within the seed mask is the number of samples seeded from that voxel reaching the target mask. <tt class="backtick">find_the_biggest</tt> classifies seed voxels according to the target mask with which they show the highest probability of connection. It is run as follows: <span class="anchor" id="line-559"></span><span class="anchor" id="line-560"></span><p class="line867"><span class="anchor" id="line-561"></span><span class="anchor" id="line-562"></span><pre><span class="anchor" id="line-1-14"></span>find_the_biggest &lt;list of volumes/surfaces&gt; &lt;output&gt;</pre><span class="anchor" id="line-563"></span><p class="line862">Where the list of volumes is the outputs of <strong>Connectivity-based seed classification</strong> (i.e., files named seeds_to_target1 etc etc). <span class="anchor" id="line-564"></span><span class="anchor" id="line-565"></span><p class="line862">The example below uses <a href="./FDT(2f)UserGuide.html#Probtrackx">probtrackx</a> and <tt class="backtick">find_the_biggest</tt> to perform hard segmentation of the thalamus on the basis of its connections to cortex. <span class="anchor" id="line-566"></span><span class="anchor" id="line-567"></span><p class="line867"><img alt="quantitative targets" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_seeds2targets_thal.gif" title="quantitative targets" width="600" /> <span class="anchor" id="line-568"></span><span class="anchor" id="line-569"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-570"></span>
<h2 id="vecreg_-_Registration_of_vector_images">vecreg - Registration of vector images</h2>
<span class="anchor" id="line-571"></span><p class="line867"><img align="right" alt="vector registration" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_vecreg.gif" title="vector registration" width="400" /> After running dtifit or bedpostx, it is often useful to register vector data to another space. For example, one might want to represent V1 for different subjects in standard space. <tt class="backtick">vecreg</tt> is a command line tool that allows to perform such registration. <span class="anchor" id="line-572"></span><span class="anchor" id="line-573"></span><p class="line862">Vector images cannot be registered by simply applying a transformation (as calculated by, say, <a href="./FLIRT.html">FLIRT</a>) to every voxel's coordinates. The corresponding vectors have to be reoriented accordingly (see D. Alexander 2001, IEEE-TMI 20:1131-39). <tt class="backtick">vecreg</tt> performs this operation for you. The image on the right shows the effect of applying vecreg (right) to the V1 image on the left, compared to simply applying voxelwise transformation (e.g. using applyxfm4D) to the vectors (centre). <span class="anchor" id="line-574"></span><span class="anchor" id="line-575"></span><p class="line867"><strong>Important</strong>: vecreg does not calculate a transformation, but simply applies a given transformation to the input vector field. vecreg can apply a linear transformation calculated with FLIRT, or a non-linear transformation calculated by FNIRT. <span class="anchor" id="line-576"></span><span class="anchor" id="line-577"></span><p class="line862">types of input that may be used for vecreg from <a href="./FDT(2f)UserGuide.html#DTIFIT">DTIFIT</a>: V1,V2,V3,tensor from <a href="./FDT(2f)UserGuide.html#BEDPOSTX">BEDPOSTX</a>: dyads1, dyads2, etc. <span class="anchor" id="line-578"></span><span class="anchor" id="line-579"></span><p class="line867"><strong>Command line options</strong> <span class="anchor" id="line-580"></span><span class="anchor" id="line-581"></span><p class="line867"><span class="anchor" id="line-582"></span><span class="anchor" id="line-583"></span><span class="anchor" id="line-584"></span><span class="anchor" id="line-585"></span><span class="anchor" id="line-586"></span><span class="anchor" id="line-587"></span><span class="anchor" id="line-588"></span><span class="anchor" id="line-589"></span><span class="anchor" id="line-590"></span><span class="anchor" id="line-591"></span><span class="anchor" id="line-592"></span><span class="anchor" id="line-593"></span><span class="anchor" id="line-594"></span><span class="anchor" id="line-595"></span><span class="anchor" id="line-596"></span><span class="anchor" id="line-597"></span><span class="anchor" id="line-598"></span><span class="anchor" id="line-599"></span><span class="anchor" id="line-600"></span><span class="anchor" id="line-601"></span><span class="anchor" id="line-602"></span><pre><span class="anchor" id="line-1-15"></span>vecreg -i &lt;input4D&gt; -o &lt;output4D&gt; -r &lt;refvol&gt; [-t &lt;transform&gt;]
<span class="anchor" id="line-2-11"></span>
<span class="anchor" id="line-3-7"></span>
<span class="anchor" id="line-4-6"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-5-6"></span>        -i,--input      filename for input vector or tensor field
<span class="anchor" id="line-6-6"></span>        -o,--output     filename for output registered vector or tensor field
<span class="anchor" id="line-7-6"></span>        -r,--ref        filename for reference (target) volume
<span class="anchor" id="line-8-6"></span>
<span class="anchor" id="line-9-6"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10-6"></span>        -v,--verbose    switch on diagnostic messages
<span class="anchor" id="line-11-6"></span>        -h,--help       display this message
<span class="anchor" id="line-12-6"></span>        -t,--affine     filename for affine transformation matrix
<span class="anchor" id="line-13-6"></span>        -w,--warpfield  filename for 4D warp field for nonlinear registration
<span class="anchor" id="line-14-6"></span>        --rotmat        filename for secondary affine matrix
<span class="anchor" id="line-15-5"></span>                        if set, this will be used for the rotation of the vector/tensor field
<span class="anchor" id="line-16-4"></span>        --rotwarp       filename for secondary warp field
<span class="anchor" id="line-17-3"></span>                        if set, this will be used for the rotation of the vector/tensor field
<span class="anchor" id="line-18-2"></span>        --interp        interpolation method : nearestneighbour, trilinear (default), sinc or spline
<span class="anchor" id="line-19-2"></span>        -m,--mask       brain mask in input space
<span class="anchor" id="line-20-2"></span>        --refmask       brain mask in output space (useful for speed up of nonlinear reg)</pre><span class="anchor" id="line-603"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-604"></span>
<h2 id="qboot_-_Estimation_of_fibre_orientations_using_q-ball_ODFs_and_residual_bootstrap">qboot - Estimation of fibre orientations using q-ball ODFs and residual bootstrap</h2>
<span class="anchor" id="line-605"></span><p class="line867"><img align="right" alt="qboot" class="attachment" src="attachments/FDT(2f)UserGuide/qboot.gif" title="qboot" width="400" /> <span class="anchor" id="line-606"></span><span class="anchor" id="line-607"></span><p class="line867"><strong>qboot</strong> is a command line tool that allows estimation of diffusion ODFs and fibre orientations from them. Its output can be used as an input for probtrackX in order to perform probabilistic tractography. <span class="anchor" id="line-608"></span><span class="anchor" id="line-609"></span><p class="line862">ODF estimation is performed using a real spherical harmonics basis. Fibre orientations are estimated as the local maxima of the ODFs. Both deterministic and probabilistic estimation can be performed. For the latter, residual bootstrap is performed to infer on the ODF shape and obtain a distribution of fibre orientations. For more details on the implementation see <a class="http" href="http://humanconnectome.org/hosted/posters/HCP-HBM%202011%20poster%20609%20-%20Sotiropolous%20et%20al.pdf">Sotiropoulos2011</a> (S.N. Sotiropoulos, I. Aganj, S. Jbabdi, G. Sapiro, C. Lenglet and T.E. Behrens, &quot;Inference on Constant Solid Angle Orientation Distribution Functions from Diffusion-Weighted MRI&quot;, p.609, Quebec, Canada, OHBM, 2011). <span class="anchor" id="line-610"></span><span class="anchor" id="line-611"></span><p class="line867"><strong>qboot</strong> allows reconstruction of q-ball ODFs (<a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/15562495">Tuch DS, MRM 2004</a>), CSA ODFs (<a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/20535807">Aganj I et al, MRM, 2010</a>) and variants of them, obtained via Laplacian sharpening and Laplace-Beltrami regularization (<a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/17763358">Descoteaux et al, MRM, 2007</a>). Both spherical harmonic coefficients of the reconstructed ODFs and fibre orientation estimates may be returned as output. A real spherical harmonic basis is employed (<a class="http" href="http://www.ncbi.nlm.nih.gov/pubmed/20535807">Aganj I et al, MRM, 2010</a>). <span class="anchor" id="line-612"></span><span class="anchor" id="line-613"></span><p class="line862">Input files for <strong>qboot</strong> : Similar to dtifit and bedpostx, qboot needs a 4D data file, a binary mask_file, a bvecs and a bvals file. <span class="anchor" id="line-614"></span><span class="anchor" id="line-615"></span><p class="line867"><strong>Command-line options</strong> <span class="anchor" id="line-616"></span><span class="anchor" id="line-617"></span><p class="line867"><span class="anchor" id="line-618"></span><span class="anchor" id="line-619"></span><span class="anchor" id="line-620"></span><span class="anchor" id="line-621"></span><span class="anchor" id="line-622"></span><span class="anchor" id="line-623"></span><span class="anchor" id="line-624"></span><span class="anchor" id="line-625"></span><span class="anchor" id="line-626"></span><span class="anchor" id="line-627"></span><span class="anchor" id="line-628"></span><span class="anchor" id="line-629"></span><span class="anchor" id="line-630"></span><span class="anchor" id="line-631"></span><span class="anchor" id="line-632"></span><span class="anchor" id="line-633"></span><span class="anchor" id="line-634"></span><span class="anchor" id="line-635"></span><span class="anchor" id="line-636"></span><span class="anchor" id="line-637"></span><span class="anchor" id="line-638"></span><span class="anchor" id="line-639"></span><span class="anchor" id="line-640"></span><span class="anchor" id="line-641"></span><span class="anchor" id="line-642"></span><span class="anchor" id="line-643"></span><span class="anchor" id="line-644"></span><pre><span class="anchor" id="line-1-16"></span>qboot -k data_file -m nodif_brain_mask -r bvecs -b bvals
<span class="anchor" id="line-2-12"></span>
<span class="anchor" id="line-3-8"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-4-7"></span>        -k,--data       Data file
<span class="anchor" id="line-5-7"></span>        -m,--mask       Mask file
<span class="anchor" id="line-6-7"></span>        -r,--bvecs      b vectors file
<span class="anchor" id="line-7-7"></span>        -b,--bvals      b values file
<span class="anchor" id="line-8-7"></span>
<span class="anchor" id="line-9-7"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10-7"></span>        --ld,--logdir   Output directory (default is logdir)
<span class="anchor" id="line-11-7"></span>        --forcedir      Use the actual directory name given - i.e. don't add + to make a new directory
<span class="anchor" id="line-12-7"></span>        --q             File provided with multi-shell data. Indicates the number of directions for each shell
<span class="anchor" id="line-13-7"></span>        --model         Which model to use. 1=Tuch's ODFs, 2=CSA ODFs (default), 3=multi-shell CSA ODFs
<span class="anchor" id="line-14-7"></span>        --lmax          Maximum spherical harmonic order employed (must be even, default=4)
<span class="anchor" id="line-15-6"></span>        --npeaks        Maximum number of ODF peaks to be detected (default 2)
<span class="anchor" id="line-16-5"></span>        --thr           Minimum threshold for a local maxima to be considered an ODF peak.
<span class="anchor" id="line-17-4"></span>                        Expressed as a fraction of the maximum ODF value (default 0.4)
<span class="anchor" id="line-18-3"></span>        --ns,--nsamples Number of bootstrap samples (default is 50)
<span class="anchor" id="line-19-3"></span>        --lambda        Laplace-Beltrami regularization parameter (default is 0)
<span class="anchor" id="line-20-3"></span>        --delta         Signal attenuation regularization parameter for model=2 (default is 0.01)
<span class="anchor" id="line-21-1"></span>        --alpha         Laplacian sharpening parameter for model=1 (default is 0, should be smaller than 1)
<span class="anchor" id="line-22-1"></span>        --seed          Seed for pseudo-random number generator
<span class="anchor" id="line-23-1"></span>        --gfa           Compute a generalised FA, using the mean ODF in each voxel
<span class="anchor" id="line-24"></span>        --savecoeff     Save the ODF coefficients instead of the peaks.
<span class="anchor" id="line-25"></span>        --savemeancoeff Save the mean ODF coefficients across all samples
<span class="anchor" id="line-26"></span>        -V,--verbose    Switch on diagnostic messages</pre><span class="anchor" id="line-645"></span><p class="line867"><strong>Possible Outputs of qboot</strong> <span class="anchor" id="line-646"></span><span class="anchor" id="line-647"></span><ul><li><p class="line862">qboot will by default return distributions of ODF peaks. Peaks are detected as local ODF maxima using a finite-difference scheme.  Setting <em>--ns=1</em> , will perform deterministic estimation of the ODFs and their peaks. <span class="anchor" id="line-648"></span></li><li><p class="line862">If <em>--savecoeff</em> is set, then only samples of the ODF coefficients will be saved, without any peaks. <span class="anchor" id="line-649"></span></li><li><p class="line862">If <em>--savecoeff --savemeancoeff</em> are set, then only the mean ODF coefficients (across the samples) will be saved for each voxel and again no peaks. <span class="anchor" id="line-650"></span></li><li><p class="line862">If <em>--savemeancoeff</em> is set, then the mean ODF coefficients (across the samples) will be saved for each voxel, along with the samples of the ODF peaks. <span class="anchor" id="line-651"></span></li><li>If none of the above is set, samples of the ODF peaks are saved. <span class="anchor" id="line-652"></span><span class="anchor" id="line-653"></span></li></ul><p class="line867"><strong>Running qboot on a cluster</strong> <span class="anchor" id="line-654"></span><span class="anchor" id="line-655"></span><p class="line862">Similar to <tt class="backtick">bedpostX</tt> qboot can be parallelised if run on an SGE-capable system. The <tt class="backtick">qboot_parallel</tt> script can be employed for this purpose. <span class="anchor" id="line-656"></span><span class="anchor" id="line-657"></span><p class="line867"><strong>Multi-shell data assumptions</strong> <span class="anchor" id="line-658"></span><span class="anchor" id="line-659"></span><p class="line874">The current implementation of qboot can estimate multi-shell ODFs, assuming the following for the data: <span class="anchor" id="line-660"></span><span class="anchor" id="line-661"></span><ul><li>Three non-zero shell data are assumed. The bvalues should form an arithmetic progression, e.g. 0, 1000, 2000, 3000 or 0, 2000, 4000, 6000. <span class="anchor" id="line-662"></span><span class="anchor" id="line-663"></span></li></ul><p class="line874">It is assumed that all data from each shell are grouped together and shells are one after the other in data, bvecs and bvals. So, if for example 3 directions are available for 3 shells these should appear as: dir1_shell1, dir2_shell1, dir3_shell1, dir1_shell2,dir2_shell2, dir3_shell2, dir1_shell3,dir2_shell3, dir3_shell3. <span class="anchor" id="line-664"></span><span class="anchor" id="line-665"></span><ul><li><p class="line862">There is no assumption on the number of directions in each shell. Each shell can have its own directions and number of directions. The minimum number of directions in a shell is dictated by the number of coefficients estimated, i.e. if lmax=4 =&gt; Num_of_coeff=15 =&gt; All shells should have at least 15 directions. This is because interpolation of the data occurs, when: i) different number of directions exist in different shells or ii) same number of directions, but corresponding directions between shells (e.g. dir1_shell1 vs dir1_shell2) differ more than 1 degree. In this case each shell is fitted with SH of the same order, which is by default 10, unless the number of directions in the shell with the less points is not enough (then order is decreased). <span class="anchor" id="line-666"></span></li><li>By default, same number of datapoints (including b=0's) are assumed for each shell acquisition. If this is not the case, a --q=qshells.txt file should be provided. The information in the qshells file is of the form N1 N2 N3 , each number indicating the number of datapoints (including b=0's) that correspond to each shell acquisition. <span class="anchor" id="line-667"></span><span class="anchor" id="line-668"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-669"></span>
<h1 id="Fslview">Fslview</h1>
<span class="anchor" id="line-670"></span><p class="line867"><img alt="FDT vectors" class="attachment" src="attachments/FDT(2f)UserGuide/fdt_vectorsx.jpg" title="FDT vectors" width="800" /> <span class="anchor" id="line-671"></span><span class="anchor" id="line-672"></span><p class="line867">
<h2 id="Displaying_DWI_images_in_fslview">Displaying DWI images in fslview</h2>
<span class="anchor" id="line-673"></span><p class="line862">Outputs of <a href="./FDT(2f)UserGuide.html#BEDPOSTX">bedpostx</a> or <a href="./FDT(2f)UserGuide.html#DTIFIT">dtifit</a> can be conveniently displayed in fslview. If you open an image of diffusion vectors (e.g., dtifit_V1 output of <tt class="backtick">dtifit</tt> or dyads&lt;i&gt; output of <tt class="backtick">bedpostx</tt>) then it is possible to display these vectors using <strong>RGB</strong> coding (where the colours red,green and blue represent diffusion in the x,y,z axes respectively) or using <strong>lines</strong> where a line at each voxel represents the principle diffusion direction at that voxel. <span class="anchor" id="line-674"></span><span class="anchor" id="line-675"></span><p class="line874">It is also possible to display multiple lines per voxel. Each line will be displayed in a different colour. In the example above, the red lines represent the main fibre orientation, and the blue lines represent the secondary fibre orientations (thresholded at an f-value of 0.05), as calculated by bedpostx. <span class="anchor" id="line-676"></span><span class="anchor" id="line-677"></span><p class="line862">If you only want to visualise fibres within voxels where multiple fibres are supported (e.g. above a certain threshold for the corresponding mean_f&lt;i&gt;samples), then you first have to create a vector file where the voxels below a certain f-threshold are zeroed. You may use the two following command for that: <span class="anchor" id="line-678"></span><span class="anchor" id="line-679"></span><p class="line867"><span class="anchor" id="line-680"></span><span class="anchor" id="line-681"></span><pre><span class="anchor" id="line-1-17"></span>maskdyads dyads&lt;i&gt; mean_f&lt;i&gt;samples 0.05</pre><span class="anchor" id="line-682"></span><p class="line862">For more details see the relevant fslview <a class="http" href="http://www.fmrib.ox.ac.uk/fsl/fslview/dti.html">tutorial</a>. <span class="anchor" id="line-683"></span><span class="anchor" id="line-684"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-685"></span><a href="./CategoryFDT.html">CategoryFDT</a> <span class="anchor" id="line-686"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
