<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>POSSUM/UserGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">POSSUM/UserGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./POSSUM.html">Introduction</a></li><li>User Guide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Running_POSSUM_is_done_in_four_main_steps:">Running POSSUM is done in four main steps:</a></li><li>
<a href="#Input_files">Input files</a><ol><li>
<a href="#Object">Object</a></li><li>
<a href="#MR_parameters">MR parameters</a></li><li>
<a href="#Pulse_sequence">Pulse sequence</a></li><li>
<a href="#Slice_profile">Slice profile</a></li><li>
<a href="#Motion_sequence">Motion sequence</a></li><li>
<a href="#B0_inhomogeneities">B0 inhomogeneities</a><ol><li>
<a href="#No_motion_case">No motion case</a></li><li>
<a href="#Motion_case">Motion case</a></li></ol></li><li>
<a href="#Activation">Activation</a></li></ol></li><li>
<a href="#Running_POSSUM">Running POSSUM</a><ol><li>
<a href="#Call_POSSUM_GUI">Call POSSUM GUI</a></li><li>
<a href="#Tab:_Object">Tab: Object</a></li><li>
<a href="#Tab:_Pulse_sequence">Tab: Pulse sequence</a></li><li>
<a href="#Tab:_Bo_field">Tab: Bo field</a></li><li>
<a href="#Tab:_Noise">Tab: Noise</a></li><li>
<a href="#Tab:_Output">Tab: Output</a></li><li>
<a href="#Run_POSSUM_Run">Run POSSUM Run</a></li></ol></li><li>
<a href="#POSSUM_Output">POSSUM Output</a><ol><li>
<a href="#Adding_white_.28thermal.29_noise">Adding white (thermal) noise</a></li></ol></li><li>
<a href="#POSSUM_Programs">POSSUM Programs</a></li></ol></div></div></li></ol></div> <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867">
<h1 id="Running_POSSUM_is_done_in_four_main_steps:">Running POSSUM is done in four main steps:</h1>
<span class="anchor" id="line-5"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/gui.png" title="gui" /> 1.<a href="./POSSUM(2f)UserGuide.html#Input_files">Input</a>: It is first necessary to create the input files. These files are: object, MR parameters, pulse sequence, slice profile, motion sequence, B0 field inhomogeneities, activation and noise. There is an example for each of these files in the folder $FSLDIR/data/possum. Note that the pulse sequence and the noise file are created within the POSSUM GUI. There is no need to create those in advance. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line862">2.<a href="./POSSUM(2f)UserGuide.html#Running_POSSUM">Run POSSUM</a>: To run POSSUM, call the POSSUM GUI. This is done with a command <tt class="backtick">Possum</tt> (or <tt class="backtick">Possum_gui</tt> on a MAC), or run <tt class="backtick">fsl</tt> and press the POSSUM button. After you have specified all of the input files in the GUI, press &quot;GO&quot;. POSSUM GUI will create a POSSUM directory and save all the ouput there. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">3. <a href="./POSSUM(2f)UserGuide.html#POSSUM_Output">Output</a>: You can, in addition to the main outputs in the POSSUM directory (MRI signal - raw data, not yet processed into a k-space or an image; and MRI image - magnitude and phase), generate a k-space or a complex version of the image. You can do this by the use of a command-line program <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">4. <a href="./POSSUM(2f)UserGuide.html#Adding_white_.28thermal.29_noise">Thermal noise</a>: You can also add various levels of white (thermal) noise to the output (next to the one you already specified in the GUI). To do this use a command-line <tt class="backtick">systemnoise</tt>. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">For other information on POSSUM and updated journal references, see the <a class="http" href="http://www.fmrib.ox.ac.uk/analysis/research/possum/">POSSUM research web page</a>. If you use POSSUM in your research, please quote the journal references listed there. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-16"></span>
<h1 id="Input_files">Input files</h1>
<span class="anchor" id="line-17"></span><p class="line867">
<h2 id="Object">Object</h2>
<span class="anchor" id="line-18"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/object.png" title="gui" /> The input object is a 4D volume where the fourth dimension is a tissue-type. The object can be a segmented anatomical voxel model from any source (with ideally voxel sizes of 1x1x1mm). For example, if the object is a brain, then a segmented anatomical voxel model would be a collection of tissue templates: three-dimensional anatomical images of distinct tissue types (e.g. one template of grey matter, another of white matter and a third of cerebro-spinal fluid (CSF)). The image on the right shows cross-sections of the tissue templates derived from the anatomical images of grey matter, white matter and CSF (ordered from left to right). The voxel values in these templates reflect the proportion of tissue present in that voxel, in the range [0,1]. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line862">An excellent input object is provided with POSSUM (<tt class="backtick">$FSLDIR/data/possum/brain.nii.gz</tt>). This is the BrainWeb digital brain phantom kindly provided by Alan Evans, Louis Collins et. al, McConnell Brain Imaging Centre, Montreal Neurological Institute, McGill University. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line874">Alternatively, you can supply your own input object. The most common way to do this is to use a segmented T1 weighted structural image of the subject's brain (desirably 1x1x1mm size voxels). Each segmentation volume can then be used as a tissue class. By merging them together, the required 4D digital phantom is obtained. An example of how this process might look is: <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line867"><tt class="backtick">bet&nbsp;structural&nbsp;structural_brain&nbsp;-f&nbsp;0.5&nbsp;-g&nbsp;0</tt><br>
 <tt class="backtick">fast&nbsp;-t1&nbsp;-c&nbsp;3&nbsp;-os&nbsp;-ob&nbsp;-od&nbsp;structural_brain&nbsp;struct_brain</tt><br>
 <tt class="backtick">fslmerge&nbsp;-t&nbsp;brain&nbsp;structural_brain_seg_1&nbsp;structural_brain_seg_2&nbsp;structural_brain_seg_0</tt> <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867"><strong>Important note</strong>: The order of tissue types in the 4D object volume needs to match the order of MR parameters for different tissues in the MR parameters matrix. An example shown above places tissues in the order: grey, white, CSF. This matches the MR parameters matrix below: grey (first row), white (second row), CSF (third row). <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line867">
<h2 id="MR_parameters">MR parameters</h2>
<span class="anchor" id="line-29"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/MRpar.png" title="gui" /> The MR parameters (relaxation times T1, T2*, spin density ρ, and chemical shift value δ) are specified using a text matrix. Some example matrices (for 1.5T and 3T scanners) with a set of parameter values for each of the tissue types are given with POSSUM: <tt class="backtick">$FSLDIR/data/possum/MRpar_1.5T</tt> and <tt class="backtick">$FSLDIR/data/possum/MRpar_3T</tt>. The values used in these example matrices were derived by McConnell Brain Imaging Centre and FMRIB centre respectively. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line874">You can specify your own MR parameters matrix. You can make it either using MATLAB or emacs or any other text editor. The matrix should contain only numbers and should have 4 columns and be of the same format as in the image above. The units also need to be as the one specified in the image above. It should have as many rows as there are tissue types. Use the POSSUM example matrices to get a feeling of how this matrix should look like. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line867"><strong>Important note</strong>: The order of tissue types in the 4D object volume needs to match the order of MR parameters for different tissues in the MR parameters matrix. An example shown in the Object section places tissues in the order: grey, white, CSF. This matches the MR parameters matrix shown in the image above: grey (first row), white (second row), CSF (third row). <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867">
<h2 id="Pulse_sequence">Pulse sequence</h2>
<span class="anchor" id="line-36"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/pulse.png" title="gui" /> The pulse sequence is in a matrix form and defines RF angle, RF frequency bandwidth, RF center frequency, read-out times, and gradient waveforms (as seen in the image on the right). The best way to generate the pulse sequence is within the POSSUM GUI. All the pulse sequence parameters can be specified there. Default values are given to make things easier for you. There are six files POSSUM expects to find: <tt class="backtick">pulse,&nbsp;pulse.info,&nbsp;pulse.readme,&nbsp;pulse.posx,&nbsp;pulse.posy,&nbsp;pulse.posz</tt>. All of these files are automatically generated by the GUI: <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><ul><li><p class="line891"><tt class="backtick">pulse</tt> is the pulse sequence matrix (in binary format). An easy way to view it is by using MATLAB functions <strong>read_pulse.m</strong> and <strong>write_pulse.m</strong>. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.info</tt> is a text file which contains the information about the pulse sequence which is passed into the POSSUM program. <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.readme</tt> is the same kind of file as pulse.info, but easy to read and for the use of the user as a log file. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.posx</tt>, <tt class="backtick">pulse.posy</tt> and <tt class="backtick">pulse.posz</tt> define a coordinate system of the input object. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></li></ul><p class="line862">If you want to generate a pulse sequence using a command-line and not the POSSUM GUI (not recommended) use the command-line <tt class="backtick">pulse</tt>: <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line867"><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><pre><span class="anchor" id="line-1"></span>pulse
<span class="anchor" id="line-2"></span>
<span class="anchor" id="line-3"></span>pulse -i object -o pulse [options]
<span class="anchor" id="line-4"></span>
<span class="anchor" id="line-5"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-6"></span>        -i,--inp        4D brain, resolution can be any.
<span class="anchor" id="line-7"></span>        -o,--out        output name for the pulse sequence matrix
<span class="anchor" id="line-8"></span>
<span class="anchor" id="line-9"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10"></span>        --seq           default=epi (epi OR ge OR none)
<span class="anchor" id="line-11"></span>        --angle         default=90  (flip angle in degrees)
<span class="anchor" id="line-12"></span>        --te            default=0.03s (echo time TE)
<span class="anchor" id="line-13"></span>        --tr            default=3s (repetition time TR)
<span class="anchor" id="line-14"></span>        --trslc         default=0.12s (the time that takes for the acquisition of one slice)
<span class="anchor" id="line-15"></span>        --nx            default=64 (resolution in x of the output image)
<span class="anchor" id="line-16"></span>        --ny            default=64 (resolution in y of the output image)
<span class="anchor" id="line-17"></span>        --dx            default=0.004m (image voxel x-dimension)
<span class="anchor" id="line-18"></span>        --dy            default=0.004m (image voxel y-dimension)
<span class="anchor" id="line-19"></span>        --maxG          default=0.055 T/m (maximum gradient strength)
<span class="anchor" id="line-20"></span>        --riset         default=0.00022s (time it takes for the gradient to reach its max value)
<span class="anchor" id="line-21"></span>        --bw            default=100000Hz (receiving bandwidth)
<span class="anchor" id="line-22"></span>        --numvol        default=1 (number of volumes)
<span class="anchor" id="line-23"></span>        --numslc        default=1 (number of slices)
<span class="anchor" id="line-24"></span>        --slcthk        default=0.006m (slice thickness)
<span class="anchor" id="line-25"></span>        --gap           default=0m (gap between the slices in m)
<span class="anchor" id="line-26"></span>        --zstart        default=0m (the lowest position in the slice direction in m)
<span class="anchor" id="line-27"></span>        --slcdir        default=z- (x+,x-, y+,y- or z+,or z- slice direction/orientation)
<span class="anchor" id="line-28"></span>        --phasedir      default=y  (x,y,or z phase encode direction)
<span class="anchor" id="line-29"></span>        --readdir       default=x  (x,y, or z read encode direction)
<span class="anchor" id="line-30"></span>        -v,--verbose    switch on diagnostic messages
<span class="anchor" id="line-31"></span>        -h,--help       display this message
<span class="anchor" id="line-32"></span>        -k,--kcoord     default=no (saving k-space coordinates)</pre><span class="anchor" id="line-82"></span><p class="line867">
<h2 id="Slice_profile">Slice profile</h2>
<span class="anchor" id="line-83"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/slcprof.png" title="gui" /> Slice profile is a property of RF pulses. It describes the shape of the RF pulse in the frequency space. The shape is important as it defines the &quot;amount&quot; of excitation for the spins precessing at different frequencies. Ideally, this shape should be rectangular (blue line in the image). However that is never the case as the RF pulses are not infinite, and a realistic profile looks more like the red line. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line862">An example of the slice profile is given with POSSUM: <tt class="backtick">$FSLDIR/data/possum/slcprof</tt>. This slice profile was derived from the Varian 3T scanner in FMRIB. The file <tt class="backtick">slcprof</tt> is given as a 2-column text matrix. The first column is the frequency and the second are the amplitude values which modify the RF flip angle. Both are normalised. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line874">You can make your own slice profile. It is scanner dependent so you can ask your radiologist to help you make it. Once you make one, you can use it for all your simulations. Alternatively you can always use the one provided with the POSSUM. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line867">
<h2 id="Motion_sequence">Motion sequence</h2>
<span class="anchor" id="line-90"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/motion.png" title="gui" /> The input motion sequence is defined in the simulator by an input file which specifies: time (s), Tx, Ty, Tz (characterising translations - in metres), Rx, Ry, Rz (characterising rotations about the center of the volume - in radians). Each of these parameters is one column of the 7 column text matrix. The rotations are specified using rotation angles often called pitch (rotation about the x-axis), roll (rotation about the y-axis) and yaw (rotation about the z-axis). All rotations are assumed to happen using the right hand rule, and in the order pitch-roll-yaw. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line874">A few examples of the motion matrix are given with POSSUM: <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line867"><tt class="backtick">$FSLDIR/data/possum/motionAllLarge_60s</tt> (shown in the image),<br>
 <tt class="backtick">$FSLDIR/data/possum/motionInPlaneLarge_12s</tt>,<br>
 <tt class="backtick">$FSLDIR/data/possum/motionRzLarge_0.12s</tt>,<br>
 <tt class="backtick">$FSLDIR/data/possum/motionRzMed_60s</tt>. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line874">You can easily make your motion file using either MATLAB or Emacs or any other editor. Note that the motion parameters can be specified at any time point. All you need to do is to specify the time in the first column. The motion values in between the two time points will be automatically interpolated within the POSSUM program. <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line862">Another way of making your own motion file is by using <tt class="backtick">mcflirt</tt> to extract the file from your subject's FMRI data set. You should take into account that POSSUM motion file and mcflirt motion file are different regarding a few things: 1) .par file that mcflirt outputs is in reversed order to the possum motion file (first rotations and then translations); 2) mcflirt file does not have the time-column which you will need to add yourself (motion specified at each TR); 3) translation units of .par files are in millimeters and translation units of POSSUM files are in meters; 4) center of rotations for the mcflirt par file is the centre of gravity of the image, whereas for the matrix files it is in the bottom left corner of the object, while for the POSSUM motion file it is in the center of the object. All of these changes can easily be done in MATLAB (the conversion scripts will be part of a future FSL release). <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867"><strong>Important note</strong>: The time length of the motion file (the time specified-in the last row of the matrix) should not exceed the time length of the pulse sequence (TR*NumVolumes). <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line867">
<h2 id="B0_inhomogeneities">B0 inhomogeneities</h2>
<span class="anchor" id="line-103"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/b0z_dz.png" title="gui" /> B0 inhomogeneities occur at interfaces of materials with different magnetic susceptibilities, such as tissue-air interfaces. These differences lead to distortion in the local magnetic field, as Maxwell’s equations need to be satisfied (an example of the distorted field is shown in the image on the right). <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line867">
<h3 id="No_motion_case">No motion case</h3>
<span class="anchor" id="line-106"></span><p class="line862">In POSSUM, when there is no motion, only one 3D image representing B0 inhomogeneities is needed (in Tesla or ppm). An example of this image is given with POSSUM. It is the first volume of the 4D volume <tt class="backtick">$FSLDIR/data/possum/b0_ppm.nii.gz</tt>. Note that in the GUI you can either specify a 4D volume in which case the first volume will only be used, or you can just specify directly your 3D volume. The B0 inhomogeneity volume provided with POSSUM was made from the original CT map of the same subject as the POSSUM example object ( <tt class="backtick">$FSLDIR/data/possum/brain.nii.gz</tt>). The values are in parts-per-million (ppm). <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line862">If you would like to make your own B0 inhomogeneity file, you can do it in two ways. The first way is if you have a good tissue/air segmentation, a 3D image with ones where there is tissue and zeros where there is air (the best one you can get is from a CT map). Once you have a tissue/air segmentation volume, you can run the command-line program <tt class="backtick">b0calc</tt>: <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line867"><tt class="backtick">b0calc&nbsp;-i&nbsp;tis_air_seg&nbsp;-o&nbsp;b0</tt> <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line862">The output volume of this program is in Teslas, and is generated for a field strength of 1T. In order to obtain B0 inhomogeneity file for any other magnetic field strength, just multiply the output of the b0calc with the desired field strength (e.g. with 3 if you need B0 inhomogeneities for the magnetic field of 3T). More information about the <tt class="backtick">b0calc</tt> is set out below. <span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><p class="line874">If you don't have a tissue/air segmented volume, you can use a field_map (2 complex images acquired with different echo times TE) and a structural image. These two images need to be of the same dimension and voxel size - the best is 1x1x1mm (if this is not the case you might need to register them). Then run the script: <span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><p class="line867"><tt class="backtick">generate_b0&nbsp;structural&nbsp;field_map&nbsp;TEdiff</tt> <span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><p class="line874">TEdiff is the difference between the two TE times. This script will generate the b0 inhomogeneities map for you. Always view the image before using it in the GUI to make sure it looks ok. <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line867">
<h3 id="Motion_case">Motion case</h3>
<span class="anchor" id="line-121"></span><p class="line862">If there is motion, POSSUM GUI requires the whole basis set consisting of nine 3D images: three (x-, y-, and z- projection) for each of the three main orientations of the B0 field (x-, y-, z- direction). An example of the B0 inhomogeneity basis set is given with POSSUM: <tt class="backtick">$FSLDIR/data/possum/b0_ppm.nii.gz</tt>. This file is a 4D volume and each of the nine volumes represents one projection of one of the three basis vectors. This basis set was made from the original CT map of the same subject as the POSSUM example object ( <tt class="backtick">$FSLDIR/data/possum/brain.nii.gz</tt>). The values in this basis set are in parts-per-million (ppm). <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line874">In order to calculate your own basis set you need to have a good tissue/air segmentation, a 3D image with ones where there is tissue and zeros where there is air (the best one is from a CT map). If you don't have one, you will have to improvise and possibly use the field_map to derive the air/tissue segmentation image. Once you have a tissue/air segmentation volume, run the following: <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line867"><tt class="backtick">b0calc&nbsp;-i&nbsp;tis_air_seg&nbsp;-o&nbsp;b0x&nbsp;--b0x=1&nbsp;--b0y=0&nbsp;--b0=0&nbsp;--xyz</tt><br>
 <tt class="backtick">b0calc&nbsp;-i&nbsp;tis_air_seg&nbsp;-o&nbsp;b0y&nbsp;--b0x=0&nbsp;--b0y=1&nbsp;--b0=0&nbsp;--xyz</tt><br>
  <tt class="backtick">b0calc&nbsp;-i&nbsp;tis_air_seg&nbsp;-o&nbsp;b0z&nbsp;--b0x=0&nbsp;--b0y=0&nbsp;--b0=1&nbsp;--xyz</tt> <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line874">The output of these command-lines will be nine volumes (values in Teslas). Once you generate them (note that it can take a few hours!) merge them into one 4D file. The order of the files needs to be as in the following example: <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line867"><tt class="backtick">fslmerge&nbsp;-t&nbsp;b0&nbsp;b0z_dz&nbsp;b0z_dy&nbsp;b0z_dx&nbsp;b0y_dz&nbsp;b0y_dy&nbsp;b0y_dx&nbsp;b0x_dz&nbsp;b0x_dy&nbsp;b0x_dx</tt> <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line874">as that is what the POSSUM GUI will expect to find. The basis set generated in this way is for the 1T magnetic field. In order to generate the basis set for any other magnetic field strength just multiply the whole 4D volume with the desired field strength. <span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line862">The details of the command line program <tt class="backtick">b0calc</tt> are: <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><pre><span class="anchor" id="line-1-1"></span>b0calc
<span class="anchor" id="line-2-1"></span>
<span class="anchor" id="line-3-1"></span>b0calc -i input -o output [options]
<span class="anchor" id="line-4-1"></span>
<span class="anchor" id="line-5-1"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-6-1"></span>        -i,--in       filename of input image
<span class="anchor" id="line-7-1"></span>        -o,--out      filename of B0 inhomogeneity output volume
<span class="anchor" id="line-8-1"></span>
<span class="anchor" id="line-9-1"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10-1"></span>        --gx                Value for zeroth-order x-gradient field (per mm): default=0
<span class="anchor" id="line-11-1"></span>        --gy                Value for zeroth-order y-gradient field (per mm): default=0
<span class="anchor" id="line-12-1"></span>        --gz                Value for zeroth-order z-gradient field (per mm): default=0
<span class="anchor" id="line-13-1"></span>        --b0x               Value for zeroth-order b0 field (x-component): default=0
<span class="anchor" id="line-14-1"></span>        --b0y               Value for zeroth-order b0 field (y-component): default=0
<span class="anchor" id="line-15-1"></span>        --b0                Value for zeroth-order b0 field (z-component): default=1
<span class="anchor" id="line-16-1"></span>        -d                  Delta value (chi_tissue - chi_air): default=-9.45e-6
<span class="anchor" id="line-17-1"></span>        --chi0              Value for susceptibility of air: default=+4e-7
<span class="anchor" id="line-18-1"></span>        --xyz               calculate and save all 3 field components (i.e. x,y,z)
<span class="anchor" id="line-19-1"></span>        --extendboundary    Relative proportion to extend voxels at boundary: default=1
<span class="anchor" id="line-20-1"></span>        --directconv        use direct (image space) convolution, not FFT
<span class="anchor" id="line-21-1"></span>        -v,--verbose        switch on diagnostic messages
<span class="anchor" id="line-22-1"></span>        -h,--help           display this message</pre><span class="anchor" id="line-159"></span><p class="line867">
<h2 id="Activation">Activation</h2>
<span class="anchor" id="line-160"></span><p class="line867"><img align="right" alt="gui" class="attachment" src="attachments/POSSUM(2f)UserGuide/activation.png" title="gui" /> Activation (BOLD signal) is defined in the simulator through the changes in the T2*. Each object voxel has its own time-series of T2* changes. These are user-defined and packed into massive four-dimensional volumes often called T2* maps. Instead of the 4D volumes it is also possible to define T2* maps with a 3D T2* map and an extra file providing the scaling parameter together with the time-points when the scaling parameter is applied. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line862">An example of the 3D T2* map and a modulation time course are provided with POSSUM (<tt class="backtick">$FSLDIR/data/possum/activation3D.nii.gz</tt> and <tt class="backtick">$FSLDIR/data/possum/activation3Dtimecourse</tt>). They were derived by fitting the equation S = S0 exp(-TE/T2* ) to an experimentally acquired FMRI data set (from Montreal Neurological Institute, McGill University), where S is the measured signal intensity, TE is the echo time and S0 is the baseline intensity (determined from the average value of S under baseline conditions). The experiment that the data was generated from involved auditory naming with the paradigm consisting of six blocks ‘on’, and six blocks ‘off’. During ‘on’ blocks, subjects heard a description of an object and had to think of the name of the object. <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><p class="line862">You can make your own files by drawing areas of interest in <tt class="backtick">fslview</tt> and then creating a modulation time-course file which matches your experimental paradigm. Another way of making the files is by using the already existing FMRI data to extract the T2* map as described above. <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-167"></span>
<h1 id="Running_POSSUM">Running POSSUM</h1>
<span class="anchor" id="line-168"></span><p class="line867">
<h2 id="Call_POSSUM_GUI">Call POSSUM GUI</h2>
<span class="anchor" id="line-169"></span><p class="line862">To call the POSSUM GUI, type <tt class="backtick">Possum</tt> in a terminal (type <tt class="backtick">Possum_gui</tt> on Mac), or run <tt class="backtick">fsl</tt> and press the POSSUM button. <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line867">
<h2 id="Tab:_Object">Tab: Object</h2>
<span class="anchor" id="line-172"></span><p class="line862">Now set the filename of the 4D input image (example in the GUI is <tt class="backtick">$FSLDIR/data/possum/brain.nii.gz</tt>). You can view the image by pressing the <strong>Preview image</strong> tab (you will see an image of only one tissue type, e.g. grey in the case of the example given in the GUI). <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line867">
<h2 id="Tab:_Pulse_sequence">Tab: Pulse sequence</h2>
<span class="anchor" id="line-175"></span><p class="line862">Now choose the tab <strong>Pulse sequence</strong>. Default values are set already. <strong>TE</strong> is the echo time (in seconds), <strong>TR</strong> is the repetition time between the RF pulses (in seconds) and <strong>TRslice</strong> is the time it takes to generate a single slice (in seconds). TRslice is set with the <strong>Autoset</strong> to be TR divided with the number of slices (<strong>Number of Voxels: Z</strong>). You can choose to unset the <strong>Autoset</strong> and to specify your own TRslice. <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line862">You can then choose the number of your in-plane image voxels by setting X and Y values in <strong>Number of Voxels</strong>. The number of slices in your simulation is chosen by setting Z. By changing these values you will notice that the <strong>Approximate run time</strong> of POSSUM changes. This is because as you are increasing the number of points in your image matrix or increasing the number of slices the number of calculations the program needs to do increases, so the run time increases (or the other way around). <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line862">You can also change the size of your in-plane image voxels by setting the X and Y values in <strong>Voxel Size</strong>. The slice thickness is chosen by setting Z. As you are changing this you will notice that the values in the <strong>Field of View</strong> are changing. This is because the field of view is equal to the product of the number of voxels and the voxel size. Both voxel sizes and the field of view are in millimetres. <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line862">Now specify the <strong>Number of Volumes</strong>, the size of the <strong>Gap</strong> (in millimetres) between the slices and the read-out bandwidth <strong>BW</strong>. <strong>Echo spacing</strong> is showing the time it takes between the centres of two neighbouring k-space lines. <span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><p class="line862">Now specify gradient directions for the <strong>Read gradient</strong>, <strong>Phase encode gradient</strong>, and the <strong>Slice select gradient</strong>. Direction of the acquisition during the slice selection is set by choosing an appropriate option from the <strong>Slice select direction</strong>. For scanning from the top to the bottom of the head choose &quot;-&quot; and for the scanning from the bottom to the top of the head choose &quot;+&quot; (this is when the slice selection gradient is Z). The images in both cases will be the same. The differences can occur in case the subject moves. The motion effects (including the spin history effects) if the subject is moving &quot;along&quot; the slice acquisition will be different from when the subject is moving &quot;against&quot; the slice acquisition. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line862">Now specify which area of the brain you want to image by setting the <strong>Starting slice position</strong>. You can click on the <strong>Preview slice prescription</strong> in order to see the extent of your chosen field of view (FOV). <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line862">Finally, when you finish all of the pulse sequence specifications, you can check if everything is consistent within the pulse sequence by using the button <strong>Consistency check</strong>. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><p class="line867">
<h2 id="Tab:_Bo_field">Tab: Bo field</h2>
<span class="anchor" id="line-190"></span><p class="line862">Now choose the tab <strong>B0 field</strong>. You can choose between the 1.5T and 3T <strong>Field strength</strong>. Then you can choose the input file for the MR parameters (default examples are <tt class="backtick">$FSLDIR/data/possum/MRpar_1.5T</tt> and <tt class="backtick">$FSLDIR/data/possum/MRpar_3T</tt>). <span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><p class="line862">Now choose if you want to have susceptibility induced <strong>B0 field inhomogeneities</strong> by selecting either &quot;None&quot; or &quot;Custom file&quot;. If you choose the &quot;Custom file&quot;, specify the base name for your B0 field inhomogeneities basis set (e.g. <tt class="backtick">$FSLDIR/data/possum/b0_ppm_</tt>), and choose the appropriate Units for your files. <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line862">Tab: Motion Now choose the tab <strong>Motion</strong>. Press button where it says <strong>None</strong> and choose if you want to have no motion or to specify a custom file (e.g. <tt class="backtick">$FSLDIR/data/possum/motionRzLarge_0.12s</tt>). <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line862">Tab: Activation Now choose the tab <strong>Activation</strong>. Press button where it says <strong>None</strong> and choose if you want to have no activation or to specify a custom file. When specifying the custom file, there are two files that need to be specified: T2* time course (e.g. <tt class="backtick">$FSLDIR/data/possum/activation3Dtimecourse</tt>) and T2* spatial modulation (e.g. <tt class="backtick">$FSLDIR/data/possum/activation3D.nii.gz</tt>). The second one can be viewed with the Preview image. <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><p class="line867">
<h2 id="Tab:_Noise">Tab: Noise</h2>
<span class="anchor" id="line-199"></span><p class="line862">Now choose the tab <strong>Noise</strong>. Press button where it says <strong>None</strong> and choose if you want to have no noise or to have Thermal (white) noise. When specifying the white noise you can do so by either specifying the SNR or the absolute intensity of the noise (standard deviation). <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><p class="line867">
<h2 id="Tab:_Output">Tab: Output</h2>
<span class="anchor" id="line-202"></span><p class="line862">Now choose the tab <strong>Output</strong> and specify the name of the simulation directory. This directory will contain all of the input, log and output files. <span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line874">If you have the SGE environment on your cluster (ask the IT officer about this) you can specify a number of processors POSSUM can run on. This will significantly reduce the time of running. If you do not have the SGE environment, the number of processors should be 1. <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><p class="line867">
<h2 id="Run_POSSUM_Run">Run POSSUM Run</h2>
<span class="anchor" id="line-207"></span><p class="line862">When POSSUM setup is complete press the <strong>Go</strong> button. The setup gets saved in a temporary POSSUM setup file. Then a script (called <tt class="backtick">possumX</tt>) is run which uses the setup file and carries out all the simulation steps asked for, starting by creating a POSSUM results directory, and copying the setup file into here, named <tt class="backtick">design.fsf</tt> (this setup file can be later loaded back into POSSUM using the <strong>Load</strong> button). You can create this file also by using the <strong>Save</strong> option. <span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line862">Once the script has started running you can <strong>Exit</strong> the POSSUM GUI. The analysis will continue until completion. Your result at the end is called <tt class="backtick">image_abs.nii.gz</tt> and you can see it by opening it in the fslview. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line862">If you need to see these documentation files press the <strong>Help</strong> button. <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-214"></span>
<h1 id="POSSUM_Output">POSSUM Output</h1>
<span class="anchor" id="line-215"></span><p class="line874">POSSUM creates the directory you have specified as your output directory. If you have not specified the name, POSSUM will create a directory called &quot;simdir&quot; in your current directory. If the directory with the name you have specified already exists , a &quot;-&quot; is added after the name of the old directory. Of course, all the above gets ignored if you explicitly set the output directory name. <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line874">There are two main outputs of POSSUM in the POSSUM directory: <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><ul><li><p class="line891"><tt class="backtick">image_abs.nii.gz</tt>: Output image (magnitude). The image can be seen in the fslview. It is obtained from the <em>signal</em> (see below) after reordering it into the k-space and then reconstructing using the Discrete Fourier Transform (which can be done using a command-line program <tt class="backtick">signal2image</tt>). This is already done for you within the GUI so there is no need to do it again. However, you can use <tt class="backtick">signal2image</tt> yourself if you would like to get your image in a complex form, or would like to get the k-space. <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span></li><li class="gap"><p class="line891"><tt class="backtick">signal</tt>: Binary 2-row matrix. The most important output of POSSUM. It takes the longest to generate. It represents a raw signal (k-space data) in a similar form as the MRI scanner ouput. The first row is the data from the real channel and the second row is the data from the imaginary channel. This matrix can be seen using a MATLAB command <tt class="backtick">read_pulse.m</tt>. <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span></li></ul><p class="line867"><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><pre><span class="anchor" id="line-1-2"></span>signal2image
<span class="anchor" id="line-2-2"></span>
<span class="anchor" id="line-3-2"></span>signal2image [options] -i signal -p pulse -o image
<span class="anchor" id="line-4-2"></span>signal2image -p pulse -c kcoord
<span class="anchor" id="line-5-2"></span>
<span class="anchor" id="line-6-2"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-7-2"></span>        -p,--pulse      pulse_sequence matrix (generated with the GUI)
<span class="anchor" id="line-8-2"></span>
<span class="anchor" id="line-9-2"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10-2"></span>        -i,--in         input signal (default name= signal)
<span class="anchor" id="line-11-2"></span>        -o,--out        outputs image (default name = image)
<span class="anchor" id="line-12-2"></span>        -c, --kcoord    kspace coordinates (default name = kcoord)
<span class="anchor" id="line-13-2"></span>        -k,--kout       outputs k-space (default name = kspace)
<span class="anchor" id="line-14-2"></span>        -a,--abs        save absolute magnitude and phase
<span class="anchor" id="line-15-2"></span>        -v,--verbose    switch on diagnostic messages
<span class="anchor" id="line-16-2"></span>        -h,--help       display this message</pre><span class="anchor" id="line-241"></span><p class="line874">The other outputs saved in the POSSUM directory are: <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><ul><li><p class="line891"><tt class="backtick">signal_nonoise</tt> the same as <tt class="backtick">signal</tt> just without any white (thermal) noise. <span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span></li><li class="gap"><p class="line891"><tt class="backtick">image_phase.nii.gz</tt> output image (phase). <span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span></li><li class="gap"><p class="line891"><tt class="backtick">image_real.nii.gz</tt> output image (real part). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span></li><li class="gap"><p class="line891"><tt class="backtick">image_imag.nii.gz</tt> output image (imaginary part). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span></li><li class="gap"><p class="line891"><tt class="backtick">kspace_abs.nii.gz</tt> output kspace (magnitude). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span></li><li class="gap"><p class="line891"><tt class="backtick">kspace_phase.nii.gz</tt> output kspace (phase). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span></li><li class="gap"><p class="line891"><tt class="backtick">kspace_real.nii.gz</tt> output kspace (real part). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span></li><li class="gap"><p class="line891"><tt class="backtick">kspace_imag.nii.gz</tt> output kspace (imaginary part). Can be obtained with <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span></li><li class="gap"><p class="line891"><tt class="backtick">brain.nii.gz</tt> input object. <span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span></li><li class="gap"><p class="line891"><tt class="backtick">T2.nii.gz</tt> input 3D activation image. <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span></li><li class="gap"><p class="line891"><tt class="backtick">T2timecourse</tt> input activation modulation file (in time). <span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span></li><li class="gap"><p class="line891"><tt class="backtick">b0A_dA.nii.gz</tt> input 3D B0 inhomogeneity basis set (A=x,y,z). <span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse</tt> pulse sequence matrix (binary). <span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.info</tt> file with parameters of the pulse sequence (used by POSSUM programs). <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.readme</tt> file with parameters of the pulse sequence (user friendly). <span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.posx</tt> coordinate system of the input object (x-coordinate). <span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.posy</tt> coordinate system of the input object (y-coordinate). <span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.posz</tt> coordinate system of the input object (z-coordinate). <span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse.com</tt> command used to generate the pulse sequence. <span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span></li><li class="gap"><p class="line891"><tt class="backtick">noise</tt> file describing the white (thermal) noise parameters with values of SNR and sigma used in the simulation (madde by the POSSUM GUI). <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span></li><li class="gap"><p class="line891"><tt class="backtick">motion</tt> input motion file. <span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span></li><li class="gap"><p class="line891"><tt class="backtick">slcprof</tt> input slice profile. <span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span></li><li class="gap"><p class="line891"><tt class="backtick">MRpar</tt> input MR parameters. <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span></li><li class="gap"><p class="line891"><tt class="backtick">possum.com</tt> commands used when running POSSUM (to generate <tt class="backtick">signal</tt>). <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span></li><li class="gap"><p class="line891"><tt class="backtick">possum.fsf</tt> POSSUM setup file, describing everything about the POSSUM setup. This can be loaded into the POSSUM GUI using the command &quot;Load&quot;. <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span></li><li class="gap"><p class="line891"><tt class="backtick">possum.log</tt> log file for everything that happened when you ran POSSUM GUI (except the generation of the <tt class="backtick">signal</tt> which is in the <tt class="backtick">logs</tt> directory). <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span></li><li class="gap"><p class="line891"><tt class="backtick">logs</tt> log directory which contains log files from each of the processors that generates the <tt class="backtick">signal</tt>. The commands used for this are in possum.com. Files with the extension &quot;.o&quot; are the log files showing the process, and the files with the extension &quot;.e&quot; are the log files showing if there are any errors. Note that this directory is empty when there is no SGE enviroment. <span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-298"></span>
<h2 id="Adding_white_.28thermal.29_noise">Adding white (thermal) noise</h2>
<span class="anchor" id="line-299"></span><p class="line874">POSSUM GUI adds any noise you have specified before running POSSUM. However, if you want to add different levels of noise to the same simulation you should do that by using two easy and quick command-line programs. <span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line862">Firstly, you should add thermal noise to your <strong>signal</strong> (or <strong>signal_nonoise</strong> if the <strong>signal</strong> is already generated with added thermal noise) by the use of a command-line program <tt class="backtick">systemnoise</tt>. If you type <tt class="backtick">systemnoise</tt> into your terminal you will get something similar to this: <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line867"><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><pre><span class="anchor" id="line-1-3"></span>systemnoise
<span class="anchor" id="line-2-3"></span>
<span class="anchor" id="line-3-3"></span>systemnoise [options] --in=signal_nonoise --out=signal_with_noise --sigma=value
<span class="anchor" id="line-4-3"></span>
<span class="anchor" id="line-5-3"></span>Compulsory arguments (You MUST set one or more of):
<span class="anchor" id="line-6-3"></span>        -i,--in         input signal
<span class="anchor" id="line-7-3"></span>        -o,--out        output signal
<span class="anchor" id="line-8-3"></span>
<span class="anchor" id="line-9-3"></span>Optional arguments (You may optionally specify one or more of):
<span class="anchor" id="line-10-3"></span>        -s,--sigma      set noise standard deviation (units of intensity)
<span class="anchor" id="line-11-3"></span>        --seed          input seed value for the sequence
<span class="anchor" id="line-12-3"></span>        -v,--verbose    switch on diagnostic messages
<span class="anchor" id="line-13-3"></span>        -h,--help       display this message</pre><span class="anchor" id="line-318"></span><p class="line874">Note that the output of this command-line should not be given the same name as the input because in that case you will lose your original signal file (which usually takes a long time to generate). <span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><p class="line862">After you have added thermal noise to the signal, you can reconstruct the image using a command line program <tt class="backtick">signal2image</tt>. <span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-323"></span>
<h1 id="POSSUM_Programs">POSSUM Programs</h1>
<span class="anchor" id="line-324"></span><ul><li><p class="line891"><tt class="backtick">Possum</tt> - the POSSUM GUI. <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span></li><li class="gap"><p class="line891"><tt class="backtick">pulse</tt> - the POSSUM command-line program which the GUI calls when the setup has been completed and <strong>GO</strong> is pressed. It generates the pulse sequence. <span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span></li><li class="gap"><p class="line891"><tt class="backtick">possumX</tt> - the POSSUM script which the GUI calls when the setup has been completed and GO is pressed. It generates the image after the pulse sequence is generated. <span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span></li><li class="gap"><p class="line891"><tt class="backtick">generate_brain</tt> - the POSSUM script which can be used to generate the input object. <span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span></li><li class="gap"><p class="line891"><tt class="backtick">generate_b0</tt> - the POSSUM script which can be used to generate the b0 inhomogeneity volume. <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span></li><li class="gap"><p class="line891"><tt class="backtick">possum</tt> - the POSSUM command-line program which possumX calls to generate the signal (k-space data, see <a href="./POSSUM(2f)UserGuide.html#POSSUM_Output">Possum Output</a>). <span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span></li><li class="gap"><p class="line891"><tt class="backtick">systemnoise</tt> - the POSSUM command-line program which possumX calls to add the noise to the signal (see <a href="./POSSUM(2f)UserGuide.html#Adding_white_.28thermal.29_noise">Adding noise</a>). <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span></li><li class="gap"><p class="line891"><tt class="backtick">signal2image</tt> - the POSSUM command-line program which possumX calls to convert the signal to the image (i.e. re-orders the signal into the k-space and then does the reconstruction). It can also just convert the signal into the k-space (i.e. just does the reordering without the reconstruction). See <a href="./POSSUM(2f)UserGuide.html#POSSUM_Output">Possum Output</a>. <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span></li><li class="gap"><p class="line891"><tt class="backtick">b0calc</tt> - the POSSUM command-line program which you can use to generate the B0 inhomogeneity basis set. See <a href="./POSSUM(2f)UserGuide.html#Input_files">Input files</a>. <span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span></li><li class="gap"><p class="line891"><tt class="backtick">read_pulse.m</tt> - the POSSUM MATLAB program which you can use to view binary files in MATLAB. <span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span></li><li class="gap"><p class="line891"><tt class="backtick">write_pulse.m</tt> - the POSSUM MATLAB program which you can use to save files you made in MATLAB into the binary form needed sometimes for POSSUM. <span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-347"></span><a href="./CategoryPOSSUM.html">CategoryPOSSUM</a> <span class="anchor" id="line-348"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
