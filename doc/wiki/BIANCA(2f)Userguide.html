<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>BIANCA/Userguide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">BIANCA/Userguide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./BIANCA.html">Introduction</a></li><li>Userguide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Data_preparation">Data preparation</a><ol><li>
<a href="#Images_preparation">Images preparation</a></li><li>
<a href="#Training_dataset_preparation">Training dataset preparation</a></li></ol></li><li>
<a href="#Running_BIANCA">Running BIANCA</a><ol><li>
<a href="#Master_file_preparation">Master file preparation</a></li><li>
<a href="#BIANCA_options">BIANCA options</a></li><li>
<a href="#BIANCA_example_call">BIANCA example call</a></li></ol></li><li>
<a href="#Post-processing">Post-processing</a><ol><li>
<a href="#Threshold">Threshold</a></li><li>
<a href="#Masking">Masking</a></li></ol></li><li>
<a href="#Performance_evaluation">Performance evaluation</a></li><li>
<a href="#Volume_extraction">Volume extraction</a></li></ol></div></div></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><div class="caution"><span class="anchor" id="line-1-1"></span><p class="line867"><strong>BETA RELEASE</strong> <span class="anchor" id="line-2-1"></span><span class="anchor" id="line-3-1"></span><p class="line874">BIANCA is currently considered to be in testing, meaning that you will need to inspect its output a bit more carefully to see if you are happy with it. The output will depend critically on the choice of options and the quality of the training data and manual segmentations. Further recommendations and automated tuning methods, will be supported in an upcoming release. </div><span class="anchor" id="line-8"></span><p class="line867">
<h1 id="Data_preparation">Data preparation</h1>
<span class="anchor" id="line-9"></span><p class="line867">
<h2 id="Images_preparation">Images preparation</h2>
<span class="anchor" id="line-10"></span><p class="line874">BIANCA works in single subject's space, but all the MRI modalities need to be registered to a common base image. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line874">Before running BIANCA you need to: <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><ol type="1"><li>Choose your base image. This will be your reference space for your input and output images. <span class="anchor" id="line-15"></span></li><li>Perform brain extraction on (at least) one modality to be able to derive a brain mask * <span class="anchor" id="line-16"></span></li><li>Register all the other modalities to your base image for each subject. <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span></li></ol><p class="line862">* If you want to further restrict the area were lesions will be detected (and reduce false positives) you can consider pre-masking as described in section on<strong> <a href="./BIANCA(2f)Userguide.html#BiancaMasking">Masking</a></strong>) <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line867">
<h2 id="Training_dataset_preparation">Training dataset preparation</h2>
<span class="anchor" id="line-21"></span><p class="line874">The algorithm requires a training set with pre-classified voxels (i.e. manually segmented images) that is used to create a set of feature vectors for lesion and non-lesion classes. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line874">The lesion masks to be used as training dataset need to be: <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><ul><li>binary (1=lesion; 0=non-lesion) <span class="anchor" id="line-26"></span></li><li>in nifti (nii.gz) format <span class="anchor" id="line-27"></span></li><li>in the same space as your base image. If the manual segmentation was done on an image that was not the base image, the lesion mask need to be registered and transformed to the base image space. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></li></ul><p class="line867">
<h1 id="Running_BIANCA">Running BIANCA</h1>
<span class="anchor" id="line-30"></span><p class="line867">
<h2 id="Master_file_preparation">Master file preparation</h2>
<span class="anchor" id="line-31"></span><p class="line874">The master file is a text file that contains a row per subject (training or query) and on each row a list of all files needed for that subject: <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><ul><li>The images you want to use for classification (e.g. T1 and FLAIR), all coregistered to the same base space (see above). <span class="anchor" id="line-34"></span></li><li>One brain extracted image to be able to derive a brain mask (see above) <span class="anchor" id="line-35"></span></li><li>The binary manual lesion mask (for query subjects use any &quot;placehold&quot; name to keep the same column order of the training subjects), coregistered to the base space (if needed). <span class="anchor" id="line-36"></span></li><li>[optional] The transformation matrix from subject space to standard space. Needed to calculate spatial features (from MNI coordinates) <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></li></ul><p class="line874">These can be in any (consistent) order, as the following options will specify the meaning of each column. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867"><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><pre><span class="anchor" id="line-1"></span>Example master file (masterfile.txt):
<span class="anchor" id="line-2"></span>subj01/FLAIR_brain.nii.gz subj01/T1_to_FLAIR.nii.gz subj01/FLAIR_to_MNI.mat subj01/WMHmask.nii.gz
<span class="anchor" id="line-3"></span>subj02/FLAIR_brain.nii.gz subj02/T1_to_FLAIR.nii.gz subj02/FLAIR_to_MNI.mat subj02/WMHmask.nii.gz
<span class="anchor" id="line-4"></span>...
<span class="anchor" id="line-5"></span>subj&lt;N&gt;/structural/FLAIR_brain.nii.gz subj&lt;N&gt;/T1_to_FLAIR.nii.gz subj&lt;N&gt;/FLAIR_to_MNI.mat subj&lt;N&gt;/WMHmask.nii.gz</pre><span class="anchor" id="line-47"></span><p class="line867">
<h2 id="BIANCA_options">BIANCA options</h2>
<span class="anchor" id="line-48"></span><p class="line867"><strong>Compulsory arguments:</strong> <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><ul><li><p class="line891"><tt class="backtick">--singlefile=&lt;masterfile&gt;</tt>    name of the master file (e.g. masterfile.txt) <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></li><li class="gap"><p class="line891"><tt class="backtick">--querysubjectnum=&lt;num&gt;</tt>     row number in the master file of the query subject (the one to be segmented) <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li><li class="gap"><p class="line891"><tt class="backtick">--brainmaskfeaturenum=&lt;num&gt;</tt>  column number in the master file containing the name of the image to derive non-zero (brain) mask from (1 in the example above). Note that this does not need to be a binary/mask image - it only needs to have zeros outside the brain (or ROI) and non-zeros inside. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></li><li class="gap">Training dataset specification: <span class="anchor" id="line-57"></span><ul><li style="list-style-type:none">If the training subjects to use are listed in the master file, the following arguments need to be specified: <span class="anchor" id="line-58"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">--labelfeaturenum=&lt;num&gt;</tt>  column number in the master file containing the name of the manual lesion mask files (labelled images; 4 in the example above) <span class="anchor" id="line-59"></span></li><li style="list-style-type:none">and <span class="anchor" id="line-60"></span><p class="line891"><tt class="backtick">--trainingnums=&lt;val&gt;</tt>       subjects to be used in training. List of row numbers (comma separated, no spaces) or <tt class="backtick">all</tt> to use all the subjects in the master file. If the query subject is also a training subject, it is automatically excluded from the training dataset and the lesions are estimated from the remaining training subjects <span class="anchor" id="line-61"></span></li></ul><p class="line862">Alternatively load from file (previously saved with <tt class="backtick">--saveclassifierdata</tt>, see below): <span class="anchor" id="line-62"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">--loadclassifierdata=&lt;name&gt;</tt>      load training data (and labels) from file <span class="anchor" id="line-63"></span></li></ul></li></ul>Note that all row and column numbers start counting from 1 (not zero). <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span></li></ul><p class="line867"><strong>Optional arguments</strong>: <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">-o</tt>    output (base) file name (default: bianca_output) <span class="anchor" id="line-68"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--featuresubset=&lt;num&gt;,&lt;num&gt;,...</tt>    list of column numbers (comma separated, no spaces) in the master file containing the name of the images to use as intensity features (1,2 in the example above to use FLAIR and T1)(default: use all modalities as features). The image used to specify the non-zero (brain) mask from <em>must</em> be part of the features subset. <span class="anchor" id="line-69"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--matfeaturenum=&lt;num&gt;</tt>            column number in masterlistfile of matrix files (transformation matrix from the base space to the MNI space). Needed to extract spatial features (MNI coordinates; 3 in the example above) <span class="anchor" id="line-70"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--spatialweight=&lt;value&gt;</tt>          weighting for spatial coordinates (default = 1, i.e. variance-normalised MNI coordinates). Requires <tt class="backtick">--matfeaturenum</tt> to be specified.  If set to <tt class="backtick">0</tt> the spatial coordinates will be ignored (no need to specify <tt class="backtick">--matfeaturenum</tt>). Higher value for spatial weighting leads to the neighbouring feature vectors being more likely to come from similar spatial locations (effectively making the training data more local). At present on linear transformations are supported, with non-linear transforms planned for a future release. <span class="anchor" id="line-71"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--patchsizes=&lt;num&gt;,&lt;num&gt;,...</tt>     list of patch sizes in voxels (comma separated, no spaces) for local averaging. <span class="anchor" id="line-72"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--patch3D</tt>                        use 3D patches (default is 2D) <span class="anchor" id="line-73"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--selectpts=&lt;val&gt;</tt>                where to select the non-lesion points from the training dataset. Options: <tt class="backtick">any</tt> (anywhere outside the lesion - default), <tt class="backtick">noborder</tt> (exclude voxels close to the lesion’s edge), <tt class="backtick">surround</tt> (preferably close to the lesion’s edge) <span class="anchor" id="line-74"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--trainingpts=&lt;val&gt;</tt>              number (max) of (lesion) points to use (per training subject) or <tt class="backtick">equalpoints</tt> to select all lesion points and equal number of non-lesion points (default: 2000) <span class="anchor" id="line-75"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--nonlespts=&lt;val&gt;</tt>                number (max) of non-lesion points to use (per training subject). If not specified will be set to the same amount of lesion points (specified in <tt class="backtick">--trainingpts</tt>) <span class="anchor" id="line-76"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">--saveclassifierdata=&lt;name&gt;</tt>      save training data to file. Two files will be saved: <tt class="backtick">&lt;name&gt;</tt> and <tt class="backtick">&lt;name&gt;_labels</tt>. When loading the training dataset with <tt class="backtick">--loadclassifierdata</tt>, just specify <tt class="backtick">&lt;name&gt;</tt> and both files will be loaded. <span class="anchor" id="line-77"></span></li><li style="list-style-type:none"><p class="line891"><tt class="backtick">-v</tt>                               use verbose mode <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span></li></ul><p class="line867">
<h2 id="BIANCA_example_call">BIANCA example call</h2>
<span class="anchor" id="line-80"></span><p class="line867"><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><pre><span class="anchor" id="line-1-1"></span>bianca --singlefile=masterfile.txt --labelfeaturenum=4 --brainmaskfeaturenum=1 --querysubjectnum=1 --trainingnums=1,2,3,4,5,6,7,8,9,10 --featuresubset=1,2 --matfeaturenum=3 --trainingpts=2000 --nonlespts=10000 --selectpts=noborder -o sub001_bianca_output –v</pre><span class="anchor" id="line-83"></span><p class="line874">With this command BIANCA will use data from masterfile.txt. It will look for information about pre-labelled images in the 4th column of the master file and will limit the search to the mask derived from the image in the 1st column. The subject to segment is the first subject of the master file (first row). Since this subject is also one of the training subjects, BIANCA will use only the remaining 9 for the training (like the LOO approach, to avoid bias and overfitting). BIANCA will use as spatial features the images in the 1st and 2nd columns of the master file. It will also extract the spatial features (MNI coordinate) using the transformation matrix listed in the 3rd column of the master file. For the training, BIANCA will use, for each training subject, (up to) 2000 points among the voxels labeled as lesion and (up to) 10000 points among the non-lesion voxels, excluding voxels close to the lesion’s edge. The output image will be called sub001_bianca_output. Verbose mode is on. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867">
<h1 id="Post-processing">Post-processing</h1>
<span class="anchor" id="line-86"></span><p class="line867">
<h2 id="Threshold">Threshold</h2>
<span class="anchor" id="line-87"></span><p class="line862">BIANCA’s output is a 'probability' map of voxels to be classified as lesions. In order to obtain a binary mask, a thresholding step is needed. This can be easily done with <tt class="backtick">fslmaths</tt> (e.g. to threshold at 0.9): <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">fslmaths&nbsp;sub001_bianca_output&nbsp;–thr&nbsp;0.9&nbsp;–bin&nbsp;sub001_bianca_output_thr09bin</tt> <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></li></ul><p class="line862">Check your own data to establish the best threshold (e.g. by evaluating the overlap with the manual mask – see section <a href="./BIANCA(2f)Userguide.html#Performance_evaluation">Performance Evaluation</a> for more details) <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line867"><span class="anchor" id="BiancaMasking"></span> <span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line867">
<h2 id="Masking">Masking</h2>
<span class="anchor" id="line-96"></span><p class="line874">If you see false positive hyperintensities due to artefacts such as CSF pulsation artefacts on FLAIR, it might be useful to apply a mask to exclude the affected region(s). Note that BIANCA is not optimized for segmentation of (juxta)cortical, cerebellar and subcortical lesions. <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line874">The script below creates an example of inclusion mask from T1 images, which excludes cortical GM and the following structures: putamen, globus pallidus, nucleus accumbens, thalamus, brainstem, cerebellum, hippocampus, amygdala. The cortical GM is excluded from the brain mask by extracting the cortical CSF from single-subject’s CSF pve map, dilating it to reach the cortical GM, and excluding these areas. The other structures are identified in MNI space, non-linearly registered to the single-subjects’ images, and removed from the brain mask. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867"><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><pre><span class="anchor" id="line-1-2"></span>make_bianca_mask &lt;structural_image&gt; &lt;CSF pve&gt; &lt;warp_file_MNI2structural&gt; &lt;keep_intermediate_files&gt;</pre><span class="anchor" id="line-103"></span><p class="line862">The first input is the basename of the structural image (e.g. T1_biascorr). The script works under the assumption that the brain extracted image would be called &lt;structural image&gt;_brain.nii.gz. The second input is the CSF pve map (e.g. output from FSL-FAST). The third input is the non-linear transformation warp file from standard space to structural image. If you ran fsl_anat, you can use the file <tt class="backtick">MNI_to_T1_nonlin_field.nii.gz</tt> in the fsl_anat output directory. If you have the warp file from structural to MNI, you can calculate the inverse with the command invwarp (<tt class="backtick">invwarp&nbsp;-w&nbsp;warpvol&nbsp;-o&nbsp;invwarpvol&nbsp;-r&nbsp;refvol</tt>) If you use 1 for the last command line argument (keep_intermediate_files), the folder containing temporary files will not be deleted. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line867"><strong>Main output file: </strong> <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><ul><li><p class="line891"><tt class="backtick">&lt;structural&nbsp;image&gt;_bianca_mask.nii.gz</tt>. Binary mask with 0 for regions to exclude and 1 to include. <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span></li></ul><p class="line874">In case T1 is not your base space, you need to register the mask to the base space. <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line862">This mask can be applied to the BIANCA <strong>output</strong> (either before or after thresholding): <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">fslmaths&nbsp;sub001_bianca_output&nbsp;–mas&nbsp;T1_bianca_mask_to_FLAIR&nbsp;sub001_bianca_output_masked</tt> <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span></li></ul><p class="line862">Alternatively, this can be used to mask the <strong>input</strong> image, creating a tighter brain mask: <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">fslmaths&nbsp;FLAIR&nbsp;–mas&nbsp;T1_bianca_mask_to_FLAIR&nbsp;FLAIR_masked</tt> <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span></li></ul><p class="line862">where <tt class="backtick">FLAIR_masked.nii.gz</tt> can be used instead of <tt class="backtick">FLAIR_brain.nii.gz</tt> in the master file and used for the <tt class="backtick">--brainmaskfeaturenum</tt> option. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line867"><strong>Additional output:</strong> <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><ul><li><p class="line891"><tt class="backtick">&lt;structural&nbsp;image&gt;_vent.nii.gz</tt>. Binary mask of segmented ventricles. This can be used to extract periventricular lesions (see <a href="./BIANCA(2f)Userguide.html#VolumeExtraction">Volume Extraction</a> for details) <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span></li></ul><p class="line867"><span class="anchor" id="PerformanceEvaluation"></span> <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line867">
<h1 id="Performance_evaluation">Performance evaluation</h1>
<span class="anchor" id="line-128"></span><p class="line874">The script below can be used to evaluate BIANCA performance against a manual (reference) segmentation: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><pre><span class="anchor" id="line-1-3"></span>bianca_overlap_measures &lt;lesionmask&gt; &lt;threshold&gt; &lt;manualmask&gt; &lt;saveoutput&gt;</pre><span class="anchor" id="line-133"></span><p class="line874">It extracts the following overlap measures (see reference paper for details): <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><ul><li>Dice Similarity Index (SI): calculated as 2*(voxels in the intersection of manual and BIANCA masks)/(manual mask lesion voxels + BIANCA lesion voxels). <span class="anchor" id="line-136"></span></li><li>Voxel-level false positive fraction (FPF): number of voxels incorrectly labelled as lesion divided by the total number of voxels labelled as lesion by BIANCA; also called False Discovery Rate <span class="anchor" id="line-137"></span></li><li>Voxel-level false negative ratio (FNR): number of voxels incorrectly labelled as non-lesion divided by the total number of voxels labelled as lesion in the manual mask <span class="anchor" id="line-138"></span></li><li>Cluster-level FPF: number of clusters incorrectly labelled as lesion divided by the total number of clusters found by BIANCA <span class="anchor" id="line-139"></span></li><li>Cluster-level FNR: number of clusters incorrectly labelled as non-lesion divided by the total number of lesions in the manual mask <span class="anchor" id="line-140"></span></li><li>Mean Total Area (MTA): average total WMH volume of the manual mask and BIANCA output. <span class="anchor" id="line-141"></span></li><li>Detection error rate (DER): sum of voxels (WMH volume) belonging to FP or FN clusters, divided by MTA. <span class="anchor" id="line-142"></span></li><li>Outline error rate (OER): sum of voxels belonging to true positive clusters (WMH clusters detected by both manual and BIANCA segmentation), excluding the overlapping voxels, divided by MTA <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span></li></ul><p class="line874">In addition it calculates: <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><ul><li>Volume of BIANCA segmentation (after applying the specified threshold) <span class="anchor" id="line-147"></span></li><li>Volume of manual mask <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span></li></ul><p class="line862">The first input is the lesion mask calculated by BIANCA (e.g. <tt class="backtick">sub001_bianca_output.nii.gz</tt>), the second input is the threshold that will be applied to <tt class="backtick">&lt;lesionmask&gt;</tt> before calculating the overlap measures (if you have already thresholded and binarised the lesion mask you can simply put 0), the third input is the manual mask, used as reference to calculate the overlap measures. If <tt class="backtick">&lt;saveoutput&gt;</tt> is set to 0 it will output the measures' names and values on the screen with the following order: SI, FPF, FNR, FPF(cluster-level), FNR(cluster-level), DER, OER, MTA, lesion mask's volume, manual mask's volume. If <tt class="backtick">&lt;saveoutput&gt;</tt> is set to 1 it will save only the values (in the same order) in a file called <tt class="backtick">Overlap_and_Volumes_&lt;lesionmask&gt;_&lt;threshold&gt;.txt</tt> in the same folder where the lesion mask is. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line867"><span class="anchor" id="VolumeExtraction"></span> <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867">
<h1 id="Volume_extraction">Volume extraction</h1>
<span class="anchor" id="line-154"></span><p class="line874">The script below can be used to extract number of clusters (lesions) and the volume of lesions in any BIANCA output image. <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><p class="line867"><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><pre><span class="anchor" id="line-1-4"></span>bianca_cluster_stats &lt;bianca_output_map&gt; &lt;threshold&gt; &lt;min_cluster_size&gt; [&lt;mask&gt;]</pre><span class="anchor" id="line-159"></span><ul><li style="list-style-type:none"><p class="line891"><strong>Total</strong> <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></li></ul><p class="line862">If only 3 inputs are provided it will output the total number of clusters and the total lesion volume after applying <tt class="backtick">&lt;threshold&gt;</tt> (if you have already thresholded and binarised the lesion mask you can simply put 0) and including clusters bigger than <tt class="backtick">&lt;min_cluster_size&gt;</tt>, where the size is expressed in number of voxels. <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><ul><li style="list-style-type:none"><p class="line891"><strong>Within a mask</strong> <span class="anchor" id="line-164"></span></li><li><p class="line862">If the optional <tt class="backtick">&lt;mask&gt;</tt> file is specified, it will also calculate the number of clusters and lesion volume within the specified mask. The mask needs to be in the same space as &lt;bianca_output_map&gt; <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span></li></ul><p class="line862">To extract WMH volumes <strong>within a certain distance from the ventricles</strong>, as a measure of periventricular (or deep) WMH, you can do the following: <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><ol type="1"><li><p class="line862">Generate a ventricle mask (<tt class="backtick">&lt;structural&nbsp;image&gt;_vent.nii.gz</tt>) from your T1 image with <tt class="backtick">make_bianca_mask</tt> (see section <a href="./BIANCA(2f)Userguide.html#BiancaMasking">Masking</a> for details) <span class="anchor" id="line-169"></span></li><li>(if needed) register it to your base image <span class="anchor" id="line-170"></span></li><li><p class="line862">Create a distance map from the ventricles using FSL function <tt class="backtick">distancemap</tt>, where the intensity of each voxel represent its distance in mm from the ventricles mask: <tt class="backtick">distancemap&nbsp;&lt;structural&nbsp;image&gt;_vent.nii.gz&nbsp;dist_to_vent</tt> <span class="anchor" id="line-171"></span></li><li><p class="line862">Threshold the distance map to obtain the region within <tt class="backtick">&lt;dist&gt;</tt> mm of the ventricles, <tt class="backtick">fslmaths&nbsp;dist_to_vent&nbsp;-uthr&nbsp;&lt;dist&gt;&nbsp;-bin&nbsp;dist_to_vent_periventricular</tt> or, alternatively, to look for deep WMH (more than <tt class="backtick">&lt;dist&gt;</tt> mm from the ventricles) <tt class="backtick">fslmaths&nbsp;dist_to_vent&nbsp;-thr&nbsp;&lt;dist&gt;&nbsp;-bin&nbsp;dist_to_vent_deep</tt> <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></li><li class="gap"><p class="line862">Use the obtained mask to calculate the volumes of WMH within that area with <tt class="backtick">bianca_cluster_stats</tt> or to mask BIANCA output with <tt class="backtick">fslmaths</tt>. <span class="anchor" id="line-174"></span></li></ol><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:23
</body>
</html>
