<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>PALM/JointInference</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">PALM/JointInference</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./PALM.html">Introduction</a></li><li><a href="./PALM(2f)UserGuide.html">User Guide</a></li><li><a href="./PALM(2f)ExchangeabilityBlocks.html">Exchangeability Blocks</a></li><li>Joint Inference<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Non-Parametric_Combination_.28NPC.29">Non-Parametric Combination (NPC)</a><ol><li>
<a href="#Overview">Overview</a></li><li>
<a href="#Combining_functions">Combining functions</a></li><li>
<a href="#How_to_run">How to run</a></li></ol></li><li>
<a href="#Classical_multivariate_tests_.28e.g..2C_MANOVA.2C_MANCOVA.29">Classical multivariate tests (e.g., MANOVA, MANCOVA)</a></li><li>
<a href="#References">References</a></li></ol></div></div></li><li><a href="./PALM(2f)MasksAndVoxelwiseRegressors.html">Masks And Voxelwise Regressors</a></li><li><a href="./PALM(2f)FasterInference.html">Faster Inference</a></li><li><a href="./PALM(2f)Examples.html">Examples</a></li><li><a href="./PALM(2f)FAQ.html">FAQ</a></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Non-Parametric_Combination_.28NPC.29">Non-Parametric Combination (NPC)</h1>
<span class="anchor" id="line-6"></span><p class="line867">
<h2 id="Overview">Overview</h2>
<span class="anchor" id="line-7"></span><p class="line862">The Non-Parametric Combination (NPC) is a way to perform joint inference on multiple data collected on the same experimental units (e.g., same subjects), with minimal assumptions. The NPC consists of, in a first phase, testing each hypothesis separately using permutations that are performed synchronously across datasets; these tests are termed <em>partial tests</em>. The resulting statistics for each and every permutation are recorded, allowing an estimate of the complete empirical null distribution to be constructed for each one. In a second phase, the empirical p-values for each statistic are combined, for each permutation, into a <em>joint statistic</em>. As such a combined joint statistic is produced from the previous permutations, an estimate of its empirical distribution function is immediately known, and so is the p-value of the joint test. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">As originally proposed, NPC cannot feasibly be used in brain imaging. As the statistics for all partial tests for all permutations need to be recorded, an enormous amount of space for data storage is necessary. Even if storage space were not a problem, the discreteness of the p-values for the partial tests is problematic when correcting for multiple testing, because with thousands of tests in an image, ties are likely to occur, further causing ties among the combined statistics, causing the test to be not powerful (although still valid). The most obvious workaround -- run an ever larger number of permutations to break the ties -- may not be possible for small sample sizes, or when possible, requires correspondingly larger data storage. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">The solution is to use a modified version of the NPC, starting from the principles that underlie direct combination of statistics, by computing for each partial test quantities that behave similarly as p-values; we call these as &quot;u-values&quot;, to emphasise that they are not meant to be read or interpreted as p-values, but rather as transitional values that allow combinations that otherwise would not be possible. The algorithm proceeds then in single phase, with permutations being performed on-the-fly, and with no need for storage of the complete permutation distribution at each voxel. Another modification needed for brain imaging refers to spatial statistics: the asymptotic distribution of the combined statistic is used, this time to produce a z-score, from which cluster extent, cluster mass, and TFCE can be computed. A flow chart showing both the original and the modified algorithm is shown below. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867"><img align="center" alt="NPC.png" class="attachment" src="attachments/PALM(2f)JointInference/NPC.png" title="NPC.png" /> <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h2 id="Combining_functions">Combining functions</h2>
<span class="anchor" id="line-18"></span><p class="line862">The joint null hypothesis of the NPC is that the null hypotheses for <em>all</em> partial tests are true, and the alternative is that <em>any</em> is false (that is, the same as a union-intersection test, UIT). This marks a sharp distinction versus a conjunction test, for which the joint null hypothesis is that the null hypotheses for <em>any</em> of the partial tests are true, and the alternative is that <em>all</em> are false (that is, the same as an intersection-union test, IUT). <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line874">The rejection region for the joint null hypothesis depends on how the combined statistic is produced. Various combining functions can be considered. Some of these were developed for applications such as meta-analyses. The figure below shows the rejection regions for four different popular combining functions, i.e., the ones attributed to Tippett, Fisher, Stouffer, and Mudholkar-George, and considering two partial tests, for which p-values (p1 and p2) are available. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867"><img align="center" alt="biv_rejection_simple.png" class="attachment" src="attachments/PALM(2f)JointInference/biv_rejection_simple.png" title="biv_rejection_simple.png" /> <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line874">In the NPC, these combining functions can be used even if the partial tests are not independent, as their dependence structure, whatever it might be, is implicitly accounted for during by synchronised permutation procedure. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line874">The simple combination as above implies a specific direction for each of the partial tests (e.g., positive or negative). If the hypotheses for the partial tests have mismatching directions, the imaging data for some of them can be multiplied by (-1), and the combination proceeds otherwise as usual. <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line874">Another situation arises if there is no a priori direction suspected for an effect, but concordant directions for the partial tests (either direction) are more relevant than mismatching. The rejection regions for these four examples of combining functions would then be as in the figure below: <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><p class="line867"><img align="center" alt="biv_rejection_concordant.png" class="attachment" src="attachments/PALM(2f)JointInference/biv_rejection_concordant.png" title="biv_rejection_concordant.png" /> <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line874">It might also be the case that both directions are equally interesting for each of the partial test. If that is the case, a two-tailed test for each partial test is ideal, and the rejection region for these four examples would be as below: <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867"><img align="center" alt="biv_rejection_twotailed.png" class="attachment" src="attachments/PALM(2f)JointInference/biv_rejection_twotailed.png" title="biv_rejection_twotailed.png" /> <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line874">One of the many reasons for the superiority of NPC when compared to classical multivariate tests, such as MANCOVA, refers to its finite sample consistency, that is, even with fixed sample size, as the number of modalities being combined increases, the power of the test also increases, as shown in the simulations in the reference below. The power of MANCOVA, however, increases up to a certain point, then begins to decrease, eventually reaching zero when the number of combining variables match the sample size. <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867">
<h2 id="How_to_run">How to run</h2>
<span class="anchor" id="line-41"></span><p class="line874">NPC can be performed across multiple modalities using a common design and set of contrasts, or for a single modality across multiple designs and contrasts, or across multiple modalities and multiple designs and contrasts. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">Running it in PALM is simple: <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><ol type="1"><li><p class="line862">Specify the modalities with the option <strong>-i</strong>, as many times as needed. <span class="anchor" id="line-46"></span></li><li><p class="line862">Specify designs and contrasts with the options <strong>-d</strong>, <strong>-t</strong>, and <strong>-f</strong>, as many times as needed. The contrasts can alternatively be specified with the option <strong>-con</strong> (.mset files), using just the &lt;file1&gt; (i.e., only the C contrasts, not the D contrasts; see below the section on MANCOVA). <span class="anchor" id="line-47"></span></li><li><p class="line862">[Optional] If the designs pair up with inputs, use <strong>-designperinput</strong>. <span class="anchor" id="line-48"></span></li><li><p class="line862">Use the option <strong>-npcmod</strong> to indicate that NPC should be performed across modalities, the option <strong>-npccon</strong> to indicate that NPC should be performed across all contrasts, or both <strong>-npcmod</strong> and <strong>-npccon</strong> to indicate that NPC should be done across all input modalities <em>and</em> all contrasts. <span class="anchor" id="line-49"></span></li><li><p class="line862">[Optional] Use the option <strong>-npcmethod &lt;method&gt; [parameters]</strong> to indicate which combining function should be used. The functions currently available are: Tippett, Fisher, Pearson-David, Stouffer, Wilkinson, Winer, Edgington, Mudholkar-George, Friston, Darlington-Hayes, Zaykin, Dudbridge-Koeleman (2 variants), Taylor-Tibshirani and Jiang. The methods of Darlington-Hayes and Dudbridge-Koeleman require that their parameter <em>r</em> is indicated. The methods of Wilkinson, Zaykin and Jiang require that their parameter <em>alpha</em> is indicated. The method Dudbridge-Koeleman2 requires both <em>r</em> and <em>alpha</em> (in this order). The other methods require no parameters. Consult the reference below for an overview of these combining functions and detailed references. If the option <strong>-npcmethod</strong> is omitted, the default is Fisher. <span class="anchor" id="line-50"></span></li><li><p class="line862">[Optional] If partial tests with concordant directions should be favoured, use the option <strong>-concordant</strong>. <span class="anchor" id="line-51"></span></li><li><p class="line862">[Optional] If the direction of the partial tests do not matter, use the option <strong>-twotail</strong>. <span class="anchor" id="line-52"></span></li><li>Specify all other options that you might need, such as whether to compute spatial statistics, output string, number of permutations, multi-level exchangeability blocks, permutations and/or sign-flippings, etc. <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li></ol><p class="line862">Note that the options <strong>-concordant</strong> and <strong>-twotail</strong> cannot be used simultaneously, otherwise the combined test becomes <em>inadmissible</em>, and an error will be printed. See the reference below for details. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line862">The option <strong>-npc</strong> (no parameters) is a shortcut to the options &quot;<strong>-npcmethod &lt;default method&gt; -npcmod</strong>&quot;. The default method is Fisher. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">The options <strong>-corrmod</strong> and <strong>-corrcon</strong>, to correct across modalities and contrasts, can be used with NPC. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867">
<h1 id="Classical_multivariate_tests_.28e.g..2C_MANOVA.2C_MANCOVA.29">Classical multivariate tests (e.g., MANOVA, MANCOVA)</h1>
<span class="anchor" id="line-63"></span><p class="line862">Although NPC is more powerful and entails fewer assumptions than classical multivariate tests, it might still be the case that these tests, that predate modern computers by decades, can be useful in some scenarios. The null hypothesis of MANCOVA is H0: <strong>C'*Beta*D</strong>, where C is a contrast of regression coefficients on independent variables, D is contrast of regression coefficients on response variables, and Beta are the (multivariate) regression coefficients of the general linear model. Often D is omitted, and implicitly assumed as an identity matrix of the same size as the number of dependent variables. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line874">To run a MANOVA/MANCOVA design, computing the p-values through permutations: <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><ol type="1"><li><p class="line862">Specify the multiple input modalities with the option <strong>-i</strong> multiple times. <span class="anchor" id="line-68"></span></li><li><p class="line862">Specify the designs with the option <strong>-d</strong>, and contrasts with <strong>-t</strong> and <strong>-f</strong>. Alternatively, enter the pairs of contrasts C and D with the option <strong>-con &lt;file1&gt; &lt;file2&gt;</strong>, where &lt;file1&gt; is a file with multiple contrasts C and &lt;file2&gt; with multiple contrasts D. Each contrast in C pairs with a contrast in D, and these must be in the .mset format. <span class="anchor" id="line-69"></span></li><li><p class="line862">Enable classical multivariate tests by including the option <strong>-mv &lt;statistic&gt;</strong>, where the statistic can be Wilks (for Wilks' lambda), Hotellingtsq (for Hotelling's <em>T</em><sup>2</sup>), Lawley (for Lawley-Hotelling's trace), Pillai (for Pillai's trace), Roy_ii or Roy_iii (for either of the two Roy's largest roots, as defined in items ii and iii of the Roy (1953) paper), or CCA (for Canonical Correlation Analysis). If the statistic is omitted, the default is Wilks' lambda. <span class="anchor" id="line-70"></span></li><li>Specify all other options that you might need, such as whether to compute spatial statistics, output string, number of permutations, multi-level exchangeability blocks, permutations and/or sign-flippings, etc. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></li></ol><p class="line862">The option <strong>-designperinput</strong> cannot be used together with <strong>-mv</strong>, as all inputs are used with each design. The option <strong>-corrcon</strong>, to correct across contrasts, can be used. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-75"></span>
<h1 id="References">References</h1>
<span class="anchor" id="line-76"></span><p class="line874">The methods used in PALM to handle joint inference (NPC and classical multivariate) are described in: <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867"><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><div class="references"><span class="anchor" id="line-1-1"></span><p class="line862">* Winkler AM, Webster MA, Brooks JC, Tracey I, Smith SM, Nichols TE. <a class="http" href="http://onlinelibrary.wiley.com/doi/10.1002/hbm.23115/epdf">Non-Parametric Combination and related permutation tests for neuroimaging.</a> Hum Brain Mapp. 2016 Apr;37(4):1486-511. (Open Access) </div><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line862">The general reference for the permutation tests used in PALM is the same as for <strong>randomise</strong>: <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line867"><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><div class="references"><span class="anchor" id="line-1-2"></span><p class="line862">* Winkler AM, Ridgway GR, Webster MA, Smith SM, Nichols TE. <a class="http" href="http://www.sciencedirect.com/science/article/pii/S1053811914000913">Permutation inference for the general linear model.</a> <a class="nonexistent" href="./NeuroImage.html">NeuroImage</a>, 2014;92:381-397 (Open Access) </div><span class="anchor" id="line-87"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2017-04-20 13:28
</body>
</html>
